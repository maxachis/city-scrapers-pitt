(window.wpSpeechstreamToolbar=window.wpSpeechstreamToolbar||[]).push([[3],{176:function(e,t,n){"use strict";n.d(t,"a",(function(){return ce}));var r=n(7);class i{constructor(e,t,n){this.node=e,this.offset=t,this.forwardBias=n,this.specialCase=!1}setSpecialCase(e){this.specialCase=e}isSpecialCase(){return this.specialCase}check(){var e=!0;return null==this.node||null==this.node.parentNode?e=!1:3!=this.node.nodeType?1==this.node.nodeType&&this.specialCase||(e=!1):(this.offset<0||this.offset>this.node.nodeValue.length)&&(e=!1),e}toString(){var e="THCaret ";return null!=this.node&&(3==this.node.nodeType?e+=this.node.nodeValue+" "+this.node.parentNode.tagName+" ":1==this.node.nodeType&&(e+=this.node.tagName+" ")),e+=this.offset}equals(e){return null!=e&&(this.node==e.node&&this.offset==e.offset&&this.forwardBias==e.forwardBias)}clone(){return new i(this.node,this.offset,this.forwardBias)}}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}String.prototype.trimTH=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")},String.prototype.trimSpaceTH=function(){return this.replace(/^[\t\r\n ]+/,"").replace(/[\t\r\n ]+$/,"")},String.prototype.trimSpaceStartTH=function(){return this.replace(/^[\t\r\n ]+/,"")},String.prototype.trimSpaceEndTH=function(){return this.replace(/[\t\r\n ]+$/,"")};class o{constructor(){this.extendedLetterPattern=/^[a-zA-Z\u00C6\u00D0\u018E\u018F\u0190\u0194\u0132\u014A\u0152\u1E9E\u00DE\u01F7\u021C\u00E6\u00F0\u01DD\u0259\u025B\u0263\u0133\u014B\u0153\u0138\u017F\u00DF\u00FE\u01BF\u021D\u0104\u0181\u00C7\u0110\u018A\u0118\u0126\u012E\u0198\u0141\u00D8\u01A0\u015E\u0218\u0162\u021A\u0166\u0172\u01AFY\u0328\u01B3\u0105\u0253\u00E7\u0111\u0257\u0119\u0127\u012F\u0199\u0142\u00F8\u01A1\u015F\u0219\u0163\u021B\u0167\u0173\u01B0y\u0328\u01B4\u00C1\u00C0\u00C2\u00C4\u01CD\u0102\u0100\u00C3\u00C5\u01FA\u0104\u00C6\u01FC\u01E2\u0181\u0106\u010A\u0108\u010C\u00C7\u010E\u1E0C\u0110\u018A\u00D0\u00C9\u00C8\u0116\u00CA\u00CB\u011A\u0114\u0112\u0118\u1EB8\u018E\u018F\u0190\u0120\u011C\u01E6\u011E\u0122\u0194\u00E1\u00E0\u00E2\u00E4\u01CE\u0103\u0101\u00E3\u00E5\u01FB\u0105\u00E6\u01FD\u01E3\u0253\u0107\u010B\u0109\u010D\u00E7\u010F\u1E0D\u0111\u0257\u00F0\u00E9\u00E8\u0117\u00EA\u00EB\u011B\u0115\u0113\u0119\u1EB9\u01DD\u0259\u025B\u0121\u011D\u01E7\u011F\u0123\u0263\u0124\u1E24\u0126I\u00CD\u00CC\u0130\u00CE\u00CF\u01CF\u012C\u012A\u0128\u012E\u1ECA\u0132\u0134\u0136\u0198\u0139\u013B\u0141\u013D\u013F\u02BCN\u0143N\u0308\u0147\u00D1\u0145\u014A\u00D3\u00D2\u00D4\u00D6\u01D1\u014E\u014C\u00D5\u0150\u1ECC\u00D8\u01FE\u01A0\u0152\u0125\u1E25\u0127\u0131\u00ED\u00ECi\u00EE\u00EF\u01D0\u012D\u012B\u0129\u012F\u1ECB\u0133\u0135\u0137\u0199\u0138\u013A\u013C\u0142\u013E\u0140\u0149\u0144n\u0308\u0148\u00F1\u0146\u014B\u00F3\u00F2\u00F4\u00F6\u01D2\u014F\u014D\u00F5\u0151\u1ECD\u00F8\u01FF\u01A1\u0153\u0154\u0158\u0156\u015A\u015C\u0160\u015E\u0218\u1E62\u1E9E\u0164\u0162\u1E6C\u0166\u00DE\u00DA\u00D9\u00DB\u00DC\u01D3\u016C\u016A\u0168\u0170\u016E\u0172\u1EE4\u01AF\u1E82\u1E80\u0174\u1E84\u01F7\u00DD\u1EF2\u0176\u0178\u0232\u1EF8\u01B3\u0179\u017B\u017D\u1E92\u0155\u0159\u0157\u017F\u015B\u015D\u0161\u015F\u0219\u1E63\u00DF\u0165\u0163\u1E6D\u0167\u00FE\u00FA\u00F9\u00FB\u00FC\u01D4\u016D\u016B\u0169\u0171\u016F\u0173\u1EE5\u01B0\u1E83\u1E81\u0175\u1E85\u01BF\u00FD\u1EF3\u0177\u00FF\u0233\u1EF9\u01B4\u017A\u017C\u017E\u1E93]+$/}trim(e){return e.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}trimEndTH(e){return e.replace(/[\s\xA0]+$/,"")}rw_filterForHtml(e){var t=e.replace(/\x26/g,"&amp;");return t=(t=t.replace(/\x3c/g,"&lt;")).replace(/\x3e/g,"&gt;")}rw_isTextChar(e){return e>47&&e<58||e>63&&e<91||e>94&&e<123}rw_isWhiteSpace(e){return e.search(/[\s\xa0]/)>-1}encodeForXML(e){return e=(e=(e=(e=(e=e.replace(/\x26/g,"&amp;")).replace(/\x3c/g,"&lt;")).replace(/\x3e/g,"&gt;")).replace(new RegExp('"'),"&quot;")).replace(new RegExp("'"),"&apos;")}isNumber(e){return e.length>1&&(e=e.trimTH()),""!=e&&" "!=e&&!isNaN(e)}isAlpha(e){return this.extendedLetterPattern.test(e)}filterId(e){var t,n,r,i=e.length;if(i>100)return hex_md5(e);for(t=0;t<i;t++)(n=e.charCodeAt(t))>47&&n<58||n>63&&n<92||n>94&&n<124||(n>126||92==n||47==n||58==n||59==n||42==n||63==n||34==n||60==n||62==n||124==n||35==n||37==n||43==n||38==n||94==n)&&(r="^"+d2h(n),i=(e=e.substr(0,t)+r+e.substr(t+1)).length,t+=r.length-1);return e}}class s{constructor(){this.TEXTHELP_PREFIX="texthelp-",this.IGNORE_ATTR="ignore",this.ALLOW_ATTR="allow",this.PRON_ATTR="pron",this.COMMAND_ATTR="texthelpCmd",this.ARIA_ROLE_ATTR="role",this.ARIA_LABEL_ATTR="aria-label",this.ARIA_HIDDEN_ATTR="aria-hidden",this.bTexthelpPrefix=!1,this.strPrefix=""}setUseTexthelpPrefix(e){this.bTexthelpPrefix=!("boolean"!=typeof e)||e,this.bTexthelpPrefix?this.strPrefix=this.TEXTHELP_PREFIX:this.strPrefix=""}getIgnoreAttr(){return this.strPrefix+this.IGNORE_ATTR}getAllowAttr(){return this.strPrefix+this.ALLOW_ATTR}getPronunceAttr(){return this.strPrefix+this.PRON_ATTR}getCommandAttr(){return this.strPrefix+this.COMMAND_ATTR}rw_getAttribute(e,t){if(null!=e&&1==e.nodeType&&"string"==typeof t){var n=null;return 0!=t.indexOf("data-texthelp-")&&(n=e.getAttribute("data-texthelp-"+t)),null==n&&0!=t.indexOf("data-")&&(n=e.getAttribute("data-"+t)),null==n&&(n=e.getAttribute(t)),n}return null}rw_setAttribute(e,t,n){null!=e&&1==e.nodeType&&"string"==typeof t&&"string"==typeof n&&(0!=t.indexOf("data-")&&"style"!=t&&(t="data-"+t),e.setAttribute(t,n))}rw_removeAttribute(e,t){if(null!=e&&1==e.nodeType&&"string"==typeof t){if(0!=t.indexOf("data-")&&null!=e.getAttribute("data-"+t))return void e.removeAttribute("data-"+t);null!=e.getAttribute(t)&&e.removeAttribute(t)}}}const l={ignoreHidden:!1,g_bAnnotationGlobalCheck:!1,g_bAnnotationGlobalUnknown:!1,g_nHighlightNotSyncedState:0,g_strStoredHighlightUnprocessedData:null,g_elemStoredHighlightLimitArea:null,bMathsSymbols:!1,mathWithContext:!1,overrideAriaHidden:!0,notesIdCounter:0,DynamicAnnotations:!0,IELoadedFlag:!1,tagPage:!1,styleHacks:!1,no_scroll:!1,mathSymbolMapping:null,useCommands:!1,strAnnounceLinksAsWords:null,inlineImages:!1,voiceFromLangFlag:!0,playStartPoint:null,paths:{strFileLoc:"https://toolbar.speechstream.net/SpeechStream/v217/"},mathSre:{mathSpeakLocation:"toolbar.speechstream.net",mathSpeakVersion:"3.0.0-beta.6",sreSettings:{semantics:!0,domain:"clearspeak",style:"short",markup:"ssml_step",xpath:"https://toolbar.speechstream.net/MathSpeak/3.0.0-beta.6/wgxpath.install.js"},removeList:["start fraction","end fraction","start frac","end frac","StartFraction","EndFraction","empezar fracción","finalizar fracción","EndRoot","Baseline"],correctList:["square =squared","cube =cubed","RootIndex 3 StartRoot=cube root of","RootIndex 4 StartRoot=fourth root of","RootIndex 5 StartRoot=fifth root of","RootIndex 6 StartRoot=sixth root of","RootIndex 7 StartRoot=seventh root of","RootIndex 8 StartRoot=eighth root of","RootIndex 9 StartRoot=nineth root of","RootIndex 10 StartRoot=tenth root of","RootIndex n StartRoot=n-th root of","StartRoot=square root of","divide symbol=divided by","division-sign=divided by","division sign=divided by","Superscript ring=degrees","Superscript=to the power of",{regex:/\bdot\b/gi,replacement:"times"}]},init(e){({tagPage:this.tagPage,styleHacks:this.styleHacks,no_scroll:this.no_scroll,bMathsSymbols:this.bMathsSymbols,mathWithContext:this.mathWithContext,useCommands:this.useCommands,inlineImages:this.inlineImages,overrideAriaHidden:this.overrideAriaHidden,playStartPoint:this.playStartPoint}=e)}};let h;class u{constructor(){l.mathSre.mathSpeakLocation?this.mathSpeakLocation=l.mathSre.mathSpeakLocation:this.mathSpeakLocation="toolbar.speechstream.net",l.mathSre.removeList?this.removeList=l.mathSre.removeList:this.removeList=["start fraction","end fraction","start frac","end frac","StartFraction","EndFraction","empezar fracción","finalizar fracción","EndRoot","Baseline"],l.mathSre.correctList?this.correctList=l.mathSre.correctList:this.correctList=["square =squared","cube =cubed","RootIndex 3 StartRoot=cube root of","RootIndex 4 StartRoot=fourth root of","RootIndex 5 StartRoot=fifth root of","RootIndex 6 StartRoot=sixth root of","RootIndex 7 StartRoot=seventh root of","RootIndex 8 StartRoot=eighth root of","RootIndex 9 StartRoot=nineth root of","RootIndex 10 StartRoot=tenth root of","RootIndex n StartRoot=n-th root of","StartRoot=square root of","divide symbol=divided by","division-sign=divided by","division sign=divided by","Superscript ring=degrees","Superscript=to the power of",{regex:/\bdot\b/gi,replacement:"times"}],l.mathSre.mathSpeakVersion?this.mathSpeakVersion=l.mathSre.mathSpeakVersion:this.mathSpeakVersion="3.0.0-beta.6",l.mathSre.sreSettings?this.sreSettings=l.mathSre.sreSettings:this.sreSettings={semantics:!0,domain:"clearspeak",style:"short",markup:"ssml_step",xpath:"https://"+this.mathSpeakLocation+"/MathSpeak/"+this.mathSpeakVersion+"/wgxpath.install.js"},this.mathObjectArray,h?this.instance=h:(sre.System.getInstance().setupEngine(this.sreSettings),this.instance=sre.System.getInstance())}loadNewSreInstance(){"undefined"==typeof sre||(sre.System.getInstance().setupEngine(this.sreSettings),this.instance=sre.System.getInstance())}getRawTextFromMathJax(e){if(e.isMathJax){for(var t=e;null!=t&&t.isMathJax&&!t.id;)t=t.parentNode;t&&t.id?"math:"+t.id+";":"math:none;"}let n=e.ownerDocument.defaultView.MathJax.Hub.getJaxFor(e);if(null!=n){var r=this.sreSettings.markup;"none"!=this.sreSettings.markup&&(this.sreSettings.markup="none",this.loadNewSreInstance());var i=null,a="";try{(null!=(i=n.root.toMathML(""))||i.length>0)&&(a=(a=(a=(a=(a=(a=(a=this.instance.processExpression(i,!1,!1)).replace(/BOOKMARK MARK/g,"bookmark mark")).replace(/<bookmark mark="0"\/>/g,"")).replace(/a\./g,"a")).replace(new RegExp("silence msec","gi"),(function(e){return e.toLowerCase()}))).replace(new RegExp("\\bbold\\b","gi")," ")).replace(new RegExp("\\s{2,}/g")," "),a=this.filterMathSpeakFixUndesiredMathSpeakOutput(a))}catch(e){console.log(e)}return this.sreSettings.markup!=r&&(this.sreSettings.markup=r,this.loadNewSreInstance()),a}return""}getSpeech(e){if("string"==typeof e){let t=document.getElementById(e);if(null!=t&&1==t.isMathJax){let n=this.getMathMLText(e),r=this.getMathMLObject(e);return this.mathObjectArray=new Array,n=n.replace(/<\/([^>]+)/g,"</mathml:$1>"),n=n.replace(/<([^>]+)/g,"<mathml:$1>"),this.instance.processExpression(this.getMathMLWithBookmarks(this.mathObjectArray,r,n,!1,t.ownerDocument))}}return""}getSpeechWithBookmarks(e){if("string"==typeof e){this.sreSettings.markup;g_bSSMLSpeechEnabled&&"ssml_step"!=this.sreSettings.markup&&(this.sreSettings.markup="ssml_step",this.loadNewSreInstance());let t=document.getElementById(e);if(null!=t&&1==t.isMathJax){let n=this.getMathMLText(e),r=this.getMathMLObject(e);this.mathObjectArray=new Array;let i=this.instance.processExpression(this.getMathMLWithBookmarks(this.mathObjectArray,r,n,!0,t.ownerDocument));return i=i.replace(/BOOKMARK MARK/g,"bookmark mark"),text=text.replace('<speak version="1.1" xmlns="http://www.w3.org/2001/10/synthesis">','<speak version="1.1" xmlns="http://www.w3.org/2001/10/synthesis"\n                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n                   xsi:schemaLocation="http://www.w3.org/2001/10/synthesis\n                             http://www.w3.org/TR/speech-synthesis11/synthesis.xsd"\n                   ">'),text=text.replace('<prosody rate="100%">','<prosody rate="0%">'),text=text.replace("</prosody>",'<mark name="0"/>'),i=i.replace(/a\./g,"a."),i=i.replace(new RegExp("silence msec","gi"),(function(e){return e.toLowerCase()})),i=i.replace(new RegExp("\\bbold\\b","gi")," "),i=i.replace(new RegExp("\\s{2,}/g")," "),this.filterMathSpeakFixUndesiredMathSpeakOutput(i)}}return""}getSpeechFromElement(e){if(null!=e&&1==e.isMathJax){this.sreSettings.markup;"none"!=this.sreSettings.markup&&(this.sreSettings.markup="none",this.loadNewSreInstance());let t=this.getMathMLText(e),n=self.instance.processExpression(t);return n=n.replace(new RegExp("silence msec","gi"),""),n=n.replace(new RegExp("\\bbold\\b","gi")," "),n=n.replace(new RegExp("\\s{2,}/g")," "),this.filterMathSpeakFixUndesiredMathSpeakOutput(n)}return""}getSpeechWithBookmarksFromElement(e){if(null!=e&&1==e.isMathJax){let t="";try{let n=this.sreSettings.markup;"ssml_step"!=this.sreSettings.markup&&(this.sreSettings.markup="ssml_step",this.loadNewSreInstance());let r=this.getMathMLText(e),i=this.getMathMLObject(e);this.mathObjectArray=new Array;let a=this.getMathMLWithBookmarks(this.mathObjectArray,i,r,!0,e.ownerDocument);""!=a&&(t=this.instance.processExpression(a),t=t.replace(/BOOKMARK MARK/g,"bookmark mark"),t=t.replace('<?xml version="1.0"?><speak version="1.1" xmlns="http://www.w3.org/2001/10/synthesis">',""),t=t.replace('<prosody rate="100%">','<prosody rate="0%">'),t=t.replace("</speak>",""),t=t.replace(new RegExp('interpret-as="character"',"g"),'interpret-as="spell"'),t=t.replace(new RegExp("silence msec","gi"),(function(e){return e.toLowerCase()})),t=t.replace(new RegExp("\\bbold\\b","gi")," "),t=t.replace(new RegExp("\\s{2,}/g")," "),t=this.filterMathSpeakFixUndesiredMathSpeakOutput(t),this.sreSettings.markup!=n&&(this.sreSettings.markup=n,this.loadNewSreInstance()))}catch(e){console.log(e)}return t}return""}getMathMLOriginalText(e){if("string"==typeof e){let t=document.getElementById(e);if(null!=t&&1==t.isMathJax){let t=document.getElementById(e);return t.ownerDocument.defaultView.MathJax.Hub.getJaxFor(t).originalText}}return""}getMathMLText(e){if(null!=e&&1==e.isMathJax){let t=e.ownerDocument.defaultView.MathJax.Hub.getJaxFor(e).root.toMathML(),n=(new DOMParser).parseFromString(t,"text/xml");return"parsererror"!=n.documentElement.nodeName&&"parsererror"!=n.documentElement.firstChild.nodeName||(t=""),t}return""}getMathMLObject(e){return null!=e&&1==e.isMathJax?e.ownerDocument.defaultView.MathJax.Hub.getJaxFor(e).root:""}isMathML(e){if("string"==typeof e){let t=document.getElementById(e);if(null!=t&&1==t.isMathJax)return!0}return!1}getMathMLWithBookmarks(e,t,n,r,i){if(null!=n&&(n=n.replace(/<mathml:math.*>/,'<math xmlns="http://www.w3.org/1998/Math/MathML">')),null!=t.data)for(let a=0;a<t.data.length;a++)if(null!=t.data[a]){let o=t.data[a].spanID?t.data[a].spanID:t.data[a].CHTMLnodeID;if(o=null!=o&&null!=o?o:t.data[a].PHTMLspanID,t.data[a].toMathML&&t.data[a].toMathML()&&null!=o&&null!=t.data[a].data[0]&&null!=t.data[a].data[0].data[0]&&null==t.data[a].data[0].data[0].toMathML){let s,l=new Object;l.data=t.data[a],l.span=t.data[a].toMathML(),l.jaxSpanid=o,l.htmlElem=i.getElementById("MathJax-Span-"+l.jaxSpanid),-1==n.indexOf(l.span)&&(l.span=l.span.replace(/>.*</,">"+t.data[a].data[0].data[0]+"<")),s=r?l.span.replace(">",' extid="'+o+'">'):l.span.replace(">",' nobookmark ="">'),n=n.replace(l.span,s),e.push(l)}n=this.getMathMLWithBookmarks(e,t.data[a],n,r,i)}return n}getMathMLTextWithBookmarks(e){if("string"==typeof e){let t=document.getElementById(e);if(null!=t&&1==t.isMathJax){let t=document.getElementById(e),n=this.getMathMLText(e),r=this.getMathMLObject(e),i=new Array;return this.getMathMLWithBookmarks(i,r,n,!0,t.ownerDocument)}}return""}filterMathSpeakFixUndesiredMathSpeakOutput(e){var t,n,r,i,a,o=e,s=this.removeList.length;for(t=0;t<s;t++)for(r=this.removeList[t],n=o.indexOf(r);n>-1;)n=(o=o.replace(r,"")).indexOf(r);for(s=this.correctList.length,t=0;t<s;t++){const e=this.correctList[t];if("string"==typeof e)a=this.correctList[t].split("="),r=new RegExp(a[0],"gi"),i=a[1];else{if(!e.regex)continue;r=e.regex,i=e.replacement}o=o.replace(r,i)}return o!=e?(console.log("Altered mathspeak output: "+o),o):e}}var d="texthelphighlightspan",g="thspan",c="thspan",f=["p","br","head","body","hr","div","h1","h2","h3","h4","h5","h6","blockquote","table","tbody","tr","td","th"],m=["em","strong","b","i","u","tt","font","kbd","dfn","cite","sup","sub","a","embed","span","small","nobr","wbr","acronym","abbr","code","s","chunk","th:pron","img","/th:pron","w","/w","lic/lic","break","silence","thspan","beelinereader",d,g];const p=/[\n\r\t ]{2,}/g;class v{constructor(e,t){if(this.CMD_LIST="list",this.CMD_STOP="stop",this.CMD_STOPAFTER="stopafter",this.CMD_JUMP="jump",this.CMD_JUMPBACK="jumpback",this.CMD_VOICE="voice",this.CMD_PAGEID="pageid",this.CMD_BOOKID="bookid",this.CMD_EXEC="exec",this.CMD_EXECAFTER="execafter",this.command=null,this.param=null,this.element=t,null!=e){var n=e.indexOf(":");n>-1?(this.command=e.substr(0,n).toLowerCase(),this.param=e.substr(n+1)):this.command=e.toLowerCase()}}}class S{constructor(){}getActualNextNodeIgnoreChildren(e,t){if(null==e||e==t)return null;if(null!=e.nextSibling)return e.nextSibling;for(var n=e;null!=n;){if(t==(n=n.parentNode))return null;if(null!=n.nextSibling)return n.nextSibling}return null}getActualNextNode(e,t){if(null==e)return null;if(null!=e.firstChild)return e.firstChild;if(e==t)return null;if(null!=e.nextSibling)return e.nextSibling;for(var n=e;null!=n;){if(t==(n=n.parentNode))return null;if(null!=n.nextSibling)return n.nextSibling}return null}getNodeFromPosition(e,t){var n=new s,r=e;if(t.lastIndexOf("*")>-1){var i=t.lastIndexOf("*");t=t.substring(i+1)}var a,o=t.split("~");for(a=o.length-2;a>-1;a--){if(null==(r=r.firstChild))return null;var l;l=0==o[a].length?0:parseInt(o[a],10);for(var h=!1,u=3==r.nodeType||1==r.nodeType&&r.tagName.toLowerCase()==d&&null!=n.rw_getAttribute(r,"rwstate");l>0;){if(null==(r=r.nextSibling))return null;(h=3==r.nodeType||1==r.nodeType&&r.tagName.toLowerCase()==d&&null!=n.rw_getAttribute(r,"rwstate"))&&u||(--l,u=h)}}return r}getTextFromNode(e){var t=new _,n=new s,r="";if(t.isInvalidNode(e)||t.isIgnored(e)||t.isAriaHidden(e))return r;if(3==e.nodeType)"textarea"!=e.parentNode.tagName.toLowerCase()&&("option"==e.parentNode.tagName.toLowerCase()?null==(r=t.getDropdownSelectedItem(e.parentNode.parentNode))||""==r?r=e.nodeValue:e.parentNode.selected||(r=""):r=e.nodeValue);else if(1==e.nodeType){var i=e.tagName.toLowerCase();if("img"==i)null==(a=n.rw_getAttribute(e,"msg"))&&(a=n.rw_getAttribute(e,"alt")),null!=a&&a.trimTH().length>0&&(r=" "+a.trimTH()+" ");else if("span"==i){if(null!=(a=n.rw_getAttribute(e,"pron"))&&a.trimTH().length>0&&(r=a.trimTH()),null!=(a=n.rw_getAttribute(e,"chunk"))&&"1"==a&&(r=e.innerHTML),a=e.isMathJax)r=(new u).getSpeechWithBookmarksFromElement(e)}else if("acronym"==i||"abbr"==i){var a=n.rw_getAttribute(e,"pron"),l=new o;(null!=a&&l.trim(a).length>0||null!=(a=e.getAttribute("title"))&&l.trim(a).length>0)&&(r=l.trim(a))}else"math"==i&&(r=this.getTextFromMathMl(e))}return r}getNextNodeAllowMoveToChild(e,t,n){return this.getNextNodeImpl(e,t,n,!0,!1)}getNextNodeIgnoreChildren(e,t,n){return this.getNextNodeImpl(e,t,n,!1,!0)}getLastChildTextNode(e,t){var n=new s,r=new _;if(null==e||null==e.lastChild||r.isInvalidNode(e))return e;if(r.isSpecialCaseWithIgnoredContent(e))return e;for(var i=e.lastChild;null!=i;){var a=r.isIgnored(e)||r.isAriaHidden(e);if(!a&&3==i.nodeType)return i;if(!a&&1==i.nodeType&&t&&"img"==i.tagName.toLowerCase()&&(null!=n.rw_getAttribute(i,"msg")&&n.rw_getAttribute(i,"msg").length>0||null!=n.rw_getAttribute(i,"alt")&&n.rw_getAttribute(i,"alt").length>0))return i;if(r.isInvalidNode(i)||null==i.lastChild||r.isSpecialCaseWithIgnoredContent(e))return t?this.getPreviousTextNode(i,!1,e):this.getPreviousTextNodeNoImg(i,!1,e,!0);i=i.lastChild}return e}getPreviousTextNodeNoImg(e,t,n,r){for(var i=r?this.getPreviousTextNode(e,t,n):this.getPreviousTextNodeNoBlank(e,t,n);null!=i&&3!=i.nodeType&&i!=n&&"math"!=i.tagName.toLowerCase()&&!i.isMathJax;)i=r?this.getPreviousTextNode(i,t,n):this.getPreviousTextNodeNoBlank(i,t,n);return i}getPreviousTextNodeNoBlank(e,t,n){for(var r=new s,i=new _,a=e;null!=a&&a!=n;)if(null!=(a=this.getPreviousTextNode(a,t,n))){var o;if(3==a.nodeType)o=a.nodeValue.trimTH();else if("img"!=a.tagName.toLowerCase()||null==r.rw_getAttribute(a,"alt")&&null==r.rw_getAttribute(a,"msg")){if("math"==a.tagName.toLowerCase())o=this.getTextFromMathMl(a);else if(a.isMathJax){o=(new u).getRawTextFromMathJax(a)}}else null==(o=r.rw_getAttribute(a,"msg").trimTH())&&(o=r.rw_getAttribute(a,"alt").trimTH());if(i.rw_isWordSpeakable(o))return a}return null}getPreviousTextNode(e,t,n){for(var r=new s,i=e,a=!1;null!=i&&i!=n;)if(null!=(i=this.getPreviousNode(i,t,n))){if(3==i.nodeType&&"textarea"!=i.parentNode.tagName.toLowerCase()&&i.nodeValue.length>0&&(a=!0),1==i.nodeType&&"math"==i.tagName.toLowerCase())a=!0;else if(1==i.nodeType&&i.isMathJax)a=!0;else if(1==i.nodeType&&"img"==i.tagName.toLowerCase()){var o=r.rw_getAttribute(i,"msg");null==o&&(o=r.rw_getAttribute(i,"alt")),null!=o&&o.length>0&&(a=!0)}if(a)return i}return null}getPreviousNode(e,t,n){var r=new _;if(null==e||e==n)return null;var i=e;if(null!=i.previousSibling){if(i=i.previousSibling,t&&!r.isStyleNode(i))return null;if(null!=i&&r.isInvalidNode(i)){if(n==i)return null;i=this.getPreviousNode(i,t,n)}else{for(;null!=i&&null!=i.lastChild&&!r.isSpecialCaseWithIgnoredContent(i);)if(i=i.lastChild,t&&(r.isStyleNode(i)||(i=null)),null!=i&&r.isInvalidNode(i)){if(n==i)return null;i=this.getPreviousNode(i,t,n);break}if(null!=i&&(r.isIgnored(i)||r.isAriaHidden(i))){if(i==n)return null;i=this.getPreviousNode(i,t,n)}}}else if(i=i.parentNode,t&&null!=i&&(r.isStyleNode(i)||(i=null)),null!=i&&(r.isIgnored(i)||r.isAriaHidden(i))){if(i==n)return null;i=this.getPreviousNode(i,t,n)}return i}getFirstChildTextNode(e,t){var n=new _,r=new s;if(null==e||null==e.firstChild||n.isInvalidNode(e))return e;if(n.isSpecialCaseWithIgnoredContent(e))return e;var i=e.firstChild;return 3==i.nodeType||1==i.nodeType&&t&&"img"==i.tagName.toLowerCase()&&(null!=r.rw_getAttribute(i,"msg")&&r.rw_getAttribute(i,"msg").length>0||null!=r.rw_getAttribute(i,"alt")&&r.rw_getAttribute(i,"alt").length>0)?i:t?this.getNextTextNode(i,!1,e):this.getNextTextNodeNoImg(i,!1,e,!0)}getNextTextNodeNoImg(e,t,n,r){for(var i=r?this.getNextTextNode(e,t,n):this.getNextTextNodeNoBlank(e,t,n);null!=i&&3!=i.nodeType&&i!=n&&"math"!=i.tagName.toLowerCase()&&!i.isMathJax;)i=r?this.getNextTextNode(i,t,n):this.getNextTextNodeNoBlank(i,t,n);return i}getNextTextNodeNoBlank(e,t,n){for(var r=new s,i=new _,a=e;null!=a&&a!=n;)if(null!=(a=this.getNextTextNode(a,t,n))){var o;if(3==a.nodeType)o=a.nodeValue.trimTH();else if("img"!=a.tagName.toLowerCase()||null==r.rw_getAttribute(a,"alt")&&null==r.rw_getAttribute(a,"msg")){if("math"==a.tagName.toLowerCase())o=this.getTextFromMathMl(a);else if(a.isMathJax){o=(new u).getRawTextFromMathJax(a)}}else null==(o=r.rw_getAttribute(a,"msg"))&&(o=r.rw_getAttribute(a,"alt")),null!=o&&o.trimTH();if(i.rw_isWordSpeakable(o))return a}return null}getTextFromMathMl(e){var t,n=new _;if(null!=e.previousSibling||null!=e.nextSibling){var r=n.createWrapperElement();e.parentNode.replaceChild(r,e),r.appendChild(e)}return null!=(t=e.parentNode.innerHTML)&&t.length>0?t:""}getNextTextNode(e,t,n){for(var r=new s,i=e,a=!1;null!=i&&i!=n;)if(null!=(i=this.getNextNode(i,t,n))){if(3==i.nodeType&&"textarea"!=i.parentNode.tagName.toLowerCase()&&i.nodeValue.length>0&&(a=!0),1==i.nodeType&&"math"==i.tagName.toLowerCase())a=!0;else if(1==i.nodeType&&i.isMathJax)a=!0;else if(1==i.nodeType&&"img"==i.tagName.toLowerCase()){var o=r.rw_getAttribute(i,"msg");null==o&&(o=r.rw_getAttribute(i,"alt")),null!=o&&o.length>0&&(a=!0)}if(a)return i}return null}getNextNode(e,t,n){return this.getNextNodeImpl(e,t,n,!1,!1)}getNextNodeImpl(e,t,n,r,i){var a=new _;if(null==e||e==n&&(i||!r))return null;var o=a.isInvalidNode(e);a.isSpecialCaseWithIgnoredContent(e)&&(o=!0);var s=null;if(e==n&&r){if(o||null==e.firstChild)return null;s=e.firstChild}else if(null==(s=e).firstChild||o||i){if(null!=s.firstChild&&i&&null!=n&&a.checkIfElementInsideElement(n,s))return null;if(null!=s.nextSibling)s=s.nextSibling;else{for(;null!=s&&null==s.nextSibling&&(s=s.parentNode,t&&(a.isStyleNode(s)||(s=null)),n!=s););null!=s&&n!=s&&(s=s.nextSibling)}}else s=s.firstChild;return null!=s&&t&&(a.isStyleNode(s)||(s=null)),null!=s&&(a.isInvalidNode(s)?s=this.getNextNodeImpl(s,t,n,!1,!0):(a.isIgnored(s)||a.isAriaHidden(s))&&(s=this.getNextNodeImpl(s,t,n,!1,!1)),r&&s==n&&e==n&&(s=null)),s}findCommands(e){var t=[];if(null!=e){let o=e.ownerDocument.body,l=e.getRootNode();l.mode&&"open"==l.mode&&(o=l);var n=e;if(3==n.nodeType&&null!=n.parentNode&&(n=n.parentNode),1!=n.nodeType)return t;for(var r=new s;null!=n&&n!=o;){if(null!=r.rw_getAttribute(n,"texthelpCmd")){var i=r.rw_getAttribute(n,"texthelpCmd").trimTH();if(i==this.CMD_LIST||i==this.CMD_LIST+":"){var a=1;for(i=r.rw_getAttribute(n,"texthelpCmd"+a);null!=i;)t.push(new v(i,n)),++a,i=r.rw_getAttribute(n,"texthelpCmd"+a)}else t.push(new v(i,n));break}n=n.parentNode}}return t}findCommandNode(e){if(null!=e){var t=e.ownerDocument.body,n=e;if(3==n.nodeType&&(n=n.parentNode),1!=n.nodeType)return null;for(var r=new s;null!=n&&n!=t;){if(null!=r.rw_getAttribute(n,"texthelpCmd"))return n;n=n.parentNode}}return null}actOnPageIDCommand(e){if(l.useCommands){var t=e.getCaretRange();if(null!=t){var n=this.findCommandsInRange(t);if(n.length>0){let t=new o;for(var r=0;r<n.length;r++){var i=n[r];i.command==i.CMD_PAGEID&&(e.pageId=t.filterId(i.param))}}}}}checkForCommandChange(e,t){var n=this.findCommandNode(e),r=e;for(r=this.getNextNodeAllowMoveToChild(r,!1,t);null!=r;){var a=this.findCommandNode(r);if(null==n)n=a;else if(a!=n){var o=this.getPreviousTextNodeNoBlank(r,!1,e);return null==o&&null==(o=this.getPreviousTextNode(r,!1,e))?null:3==o.nodeType?new i(o,o.nodeValue.length,!1):new i(o,0,!0)}r=this.getNextNode(r,!1,t)}return null}getLangAttr(e){for(var t=e;null!=t;){if(1==t.nodeType){var n=t.getAttribute("lang");if(null!=n&&n.length>0)return n;try{if(null!=(n=t.getAttribute("xml:lang"))&&n.length>0)return n}catch(e){}}t=t.parentNode}return null}checkForVoiceChange(e,t,n){var r=e;for(r=this.getNextNodeAllowMoveToChild(r,!1,t);null!=r;){if(this.getLangAttr(r)!=n){var a=this.getPreviousTextNodeNoBlank(r,!1,e);if(null==a&&null==(a=this.getPreviousTextNode(r,!1,e)))return null;if(3==a.nodeType)return new i(a,a.nodeValue.length,!1);var o=new i(a,0,!0);return o.setSpecialCase(!0),o}r=this.getNextNode(r,!1,t)}return null}}class w{constructor(e,t,n){this.body=e,this.startRef=t,this.endRef=n}equals(e){return this.body==e.body&&this.startRef.path==e.startRef.path&&this.startRef.offset==e.startRef.offset&&this.endRef.path==e.endRef.path&&this.endRef.offset==e.endRef.offset}toString(){return null!=this.getAsRange()?g_bIEOld?this.getAsRange().text:this.getAsRange().toString():""}getAsRange(){var e=null;void 0!==this.body&&null!=this.body||(this.body=document.body),e=this.body.ownerDocument.createRange();var t=new N(this.body,this.startRef.path,this.startRef.offset,this.endRef.path,this.endRef.offset),n=t.leftCaret,r=t.rightCaret;return null!=n&&null!=r?(e.setStart(n.node,n.offset),e.setEnd(r.node,r.offset)):e=null,e}clone(){return new w(this.body,this.startRef,this.endRef)}rw_getTHCaretRangeFromTHRange(){var e=new _;if(null==this.startRef||null==this.endRef)return null;var t=e.getCaretFromDomPosition(this.body,this.startRef.path,this.startRef.offset,!0),n=e.getCaretFromDomPosition(this.body,this.endRef.path,this.endRef.offset,!1);if(null!=t&&null!=n){var r=new N;return r.setCaretRange(t,n),r}return null}rw_getTHRangeFromElement(e){if(null==e)return null;var t=new _,n=new S;if(t.isSpecialCaseNested(e)){var r=t.checkForSpecialParent(e);return new w(r.ownerDocument.body,t.rw_getRefPt(r,0),t.rw_getRefPt(r,0))}if(3==e.nodeType)return new w(e.ownerDocument.body,t.rw_getRefPt(e,0),t.rw_getRefPt(e,e.nodeValue.length));var i=n.getFirstChildTextNode(e,!0),a=n.getLastChildTextNode(e,!0),o=3==a.nodeType?a.nodeValue.length:0;return new w(e.ownerDocument.body,t.rw_getRefPt(i,0),t.rw_getRefPt(a,o))}}//!*
//*! Used by safariReader
class b{constructor(e,t){this.path=e,this.offset=t}toString(){return"THDomRefPt "+this.path+" "+this.offset}getPath(){return this.path}getOffset(){return this.getOffset}}//!*
class y{constructor(){}getSentenceFromPoint(e){if(null!=e.node.tagName&&"img"==e.node.tagName.toLowerCase()){(t=new N).setCaretRange(e,e)}else{var t,n=this.getSentenceBreakToRight(e),r=this.getSentenceBreakToLeft(n);if(null==r||null==n)return null;(t=new N).setCaretRange(r,n)}return t}getNextSentence(e,t){var n=new S,r=new _;if(null==e)return null;void 0===t&&(t=null);var a,o,s=e.rightCaret.node,l=e.rightCaret.offset;if(r.rw_checkForHiddenParent(e.rightCaret.node))return null;for(e.rightCaret.isSpecialCase()&&(s=n.getNextNodeIgnoreChildren(s,!1,t),l=0);null!=s;){if(3==s.nodeType&&l<s.nodeValue.length){if(null==(a=this.getSentenceBreakToRight(new i(s,l,!1),t)))return null;if(a.node==s&&a.offset==l){if(null==(h=n.getNextTextNodeNoBlank(s,!1,t)))return null;a=this.getSentenceBreakToRight(new i(h,0,!1),t)}}else{var h;if(null==(h=n.getNextTextNodeNoBlank(s,!1,t)))return null;a=this.getSentenceBreakToRight(new i(h,0,!1),t)}if(null==(o=this.getSentenceBreakToLeft(a,null)))return null;if(e.leftCaret.node!=o.node||e.leftCaret.offset!=o.offset){var u=new N;if(u.setCaretRange(o,a),this.checkSentence(u)&&r.rw_caretRangeIsSpeakable(u))return u}if(3==(s=a.node).nodeType){var d=s.nodeValue.replace(/[\x21\x3f\x3a]/g,"."),g=d.indexOf(".",a.offset+1);l=-1==g?d.length:g}}return null}checkSentence(e){for(var t=new s,n=e.leftCaret.node,r=n.ownerDocument.body;null!=n&&n!=r;){if(1==n.nodeType){if("rwDictDefin"==n.className||"rwPopupContent"==n.className||"rwToolbarBarCollect"==n.className)break;if(null!=t.rw_getAttribute(n,"rwTHcomp"))return!1}n=n.parentNode}var i=e.rightCaret.node;if(i!=n)for(;null!=i&&i!=r&&"rwDictDefin"!=i.className&&"rwPopupContent"!=i.className&&"rwToolbarBarCollect"!=i.className;){if(1==i.nodeType&&null!=t.rw_getAttribute(i,"rwTHcomp"))return!1;i=i.parentNode}return!0}getPreviousSentence(e,t){var n=new S,r=new _;void 0===t&&(t=null);for(var a,o,s=e.leftCaret.node,l=e.leftCaret.offset;null!=s;){if(3==s.nodeType){var h,u=s.nodeValue.replace(/[\x21\x3f\x3a]/g,".");for(h=l>0?u.lastIndexOf(".",l):0==l?-1:u.lastIndexOf(".");h>-1;){if(l=h,null==(o=this.getSentenceBreakToRight(new i(s,l,!0),t)))return null;if(o.node!=e.rightCaret.node||o.offset!=e.rightCaret.offset){if(null==(a=this.getSentenceBreakToLeft(o,t)))return null;var d=new N;if(d.setCaretRange(a,o),this.checkSentence(d)&&r.rw_caretRangeIsSpeakable(d))return d}h=0==h?-1:u.lastIndexOf(".",h-1)}}if(l=-1,tmpNode=n.getPreviousTextNodeNoImg(s,!0,t,!1),null!=tmpNode)s=tmpNode;else if(null!=(s=n.getPreviousTextNodeNoBlank(s,!1,t))){if(null==(o=3==s.nodeType?this.getSentenceBreakToRight(new i(s,s.nodeValue.length,!1),t):this.getSentenceBreakToRight(new i(s,0,!1),t)))return null;if(o.node!=e.rightCaret.node||o.offset!=e.rightCaret.offset)return null==(a=this.getSentenceBreakToLeft(o,t))?null:new N(a,o)}}return null}getSentenceBreakToLeft(e,t){var n=new S,r=new _;if(void 0===t&&(t=null),null==e||null==e.node)return null;var a=e.node,s=e.offset;if(1==e.node.nodeType&&"math"==e.node.tagName.toLowerCase())return e;if(1==e.node.nodeType&&e.node.isMathJax)return e;if(e.forwardBias)3==a.nodeType&&s==a.nodeValue.length&&(s=0,null==(a=n.getNextTextNode(a,!0,t))&&(a=e.node,s=e.offset));else if(s>0)--s;else{if(null==(a=n.getPreviousTextNode(a,!0,t)))return e;if(3==a.nodeType)s=a.nodeValue.length-1;else{if(s=0,"math"==a.tagName.toLowerCase())return e;if(a.isMathJax)return e}}if(3==a.nodeType){var l=a.nodeValue.charAt(s);if("."==l||"!"==l||"?"==l||":"==l)if(s>0)--s;else{if(null==(a=n.getPreviousTextNode(a,!0,t)))return e;if(3==a.nodeType)s=a.nodeValue.length-1;else{if(s=0,"math"==a.tagName.toLowerCase())return e;if(a.isMathJax)return e}}}for(var h=a,u=s,d=a,g=s,c=!1,f=" ";!c;){if(r.isSpecialCaseNested(d)){if("math"==(d=r.checkForSpecialParent(d)).tagName.toLowerCase()){c=!0;break}if(d.isMathJax){c=!0;break}h=d,u=0}else if(3==d.nodeType){var m;if((m=d.nodeValue).length>0){-1==g&&(g=m.length);for(var p=(m=m.replace(/[\x21\x3f\x3a]/g,".")).lastIndexOf(".",g);p>-1;){if(r.rw_isFullStop(m,p,d)){if(p<m.length-1){h=d,u=p+1,c=!0;break}if(!r.rw_isTextChar(f)){c=!0;break}}p=0==p?-1:m.lastIndexOf(".",p-1)}if(c)break;(new o).trim(m).length>0&&(h=d,u=0),f=m.charAt(0)}}if(g=-1,null==(d=n.getPreviousNode(d,!0,t))){c=!0;break}if(3==d.nodeType&&r.isSpecialCaseNested(d)&&null==(d=r.checkForSpecialParent(d))){c=!0;break}}if(3==h.nodeType&&u<(m=h.nodeValue).length)for(;u<m.length&&r.rw_isWhiteSpace(m.charAt(u));)++u;return new i(h,u,!0)}getSentenceBreakToRight(e,t){var n=new S,r=new _;if(void 0===t&&(t=null),null==e||null==e.node)return null;for(var a=e.node,s=e.offset,l=a,h=s,u=!1,d=" ";!u;){if(r.isSpecialCaseNested(a)){if("math"==(a=r.checkForSpecialParent(a)).tagName.toLowerCase()){u=!0;break}if(a.isMathJax){u=!0;break}l=a,h=0,a=n.getNextNodeIgnoreChildren(a,!0,t)}else if(3==a.nodeType){if((f=a.nodeValue).length>0){if("."==d){var g=f.charAt(s);if(!r.rw_isTextChar(g)){u=!0;break}}for(var c=(f=f.replace(/[\x21\x3f\x3a]/g,".")).indexOf(".",s);c>-1;){if(r.rw_isFullStop(f,c,a)){c<f.length-1&&(l=a,h=c+1,u=!0);break}s=c+1,c=f.indexOf(".",s)}if(u)break;(new o).trim(f).length>0&&(l=a,h=f.length),"."==(d=f.charAt(f.length-1))&&(r.rw_isFullStop(f,f.length-1,a)||(d=" "))}a=n.getNextNode(a,!0,t)}else a=n.getNextNode(a,!0,t);if(s=0,null==a){u=!0;break}}if(3==l.nodeType){var f=l.nodeValue;if(h>0&&h<=f.length)for(;h>0&&r.rw_isWhiteSpace(f.charAt(h-1));)--h}return new i(l,h,!1)}tagSentences(e){if(null!=e){var t=new S,n=new _,r=new s;try{for(var i=t.getNextNodeAllowMoveToChild(e,!1,e);null!=i;)if(3==i.nodeType){if("textarea"==i.parentNode.tagName.toLowerCase()){i=t.getNextNode(i,!1,e);continue}var a,o=i.nodeValue;if(!(o.trimSpaceTH().length>0)){i=t.getNextNode(i,!1,e);continue}a=o.search("[\\x21\\x2E\\x3F\\x3A]");var l=null!=r.rw_getAttribute(i.parentNode,"texthelpSkip");if(a>-1&&a<o.length-1){for(var h=!0;;){if(n.rw_isFullStop(o,a,i))break;var u=o.substring(a+1).search("[\\x21\\x2E\\x3F\\x3A]");if(!(u>-1)){h=!1;break}a=a+1+u}if(h){var d=o.substring(0,a+1),g=o.substring(a+1),c=n.createWrapperElement();r.rw_setAttribute(c,"rwTHpgen","1");var f=document.createTextNode(d),m=document.createTextNode(g);(p=i.parentNode).insertBefore(m,i),p.insertBefore(c,m),c.appendChild(f),p.removeChild(i),i=m,f}else{if(null!=i.previousSibling||null!=i.nextSibling||l){c=n.createWrapperElement();r.rw_setAttribute(c,"rwTHpgen","1");f=document.createTextNode(o);(p=i.parentNode).insertBefore(c,i),c.appendChild(f),p.removeChild(i),i=f}i,i=t.getNextNode(i,!1,e)}}else{if(null!=i.previousSibling||null!=i.nextSibling||l){c=n.createWrapperElement();r.rw_setAttribute(c,"rwTHpgen","1");var p;f=document.createTextNode(o);(p=i.parentNode).insertBefore(c,i),c.appendChild(f),p.removeChild(i),i=f}i,i=t.getNextNode(i,!1,e)}}else if(1==i.nodeType){var v=r.rw_getAttribute(i,"rwTHcomp"),w=r.rw_getAttribute(i,"rwDontAlter"),b=r.rw_getAttribute(i,"rwstate");"pre"==i.tagName.toLowerCase()||"button"==i.tagName.toLowerCase()||null!=v&&v.length>0||null!=w&&w.length>0||null!=b&&b.length>0?(i=t.getNextNodeIgnoreChildren(i,!1,e),!0):i=t.getNextNode(i,!1,e)}else i=t.getNextNode(i,!1,e)}catch(e){}}}}const T={isIgnorePageDefault:()=>!1};class x{constructor(){this.hexcase=0,this.b64pad="",this.chrsz=8}hex_md5(e){return this.binl2hex(this.core_md5(this.str2binl(e),e.length*this.chrsz))}core_md5(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,r=-271733879,i=-1732584194,a=271733878,o=0;o<e.length;o+=16){var s=n,l=r,h=i,u=a;n=this.md5_ff(n,r,i,a,e[o+0],7,-680876936),a=this.md5_ff(a,n,r,i,e[o+1],12,-389564586),i=this.md5_ff(i,a,n,r,e[o+2],17,606105819),r=this.md5_ff(r,i,a,n,e[o+3],22,-1044525330),n=this.md5_ff(n,r,i,a,e[o+4],7,-176418897),a=this.md5_ff(a,n,r,i,e[o+5],12,1200080426),i=this.md5_ff(i,a,n,r,e[o+6],17,-1473231341),r=this.md5_ff(r,i,a,n,e[o+7],22,-45705983),n=this.md5_ff(n,r,i,a,e[o+8],7,1770035416),a=this.md5_ff(a,n,r,i,e[o+9],12,-1958414417),i=this.md5_ff(i,a,n,r,e[o+10],17,-42063),r=this.md5_ff(r,i,a,n,e[o+11],22,-1990404162),n=this.md5_ff(n,r,i,a,e[o+12],7,1804603682),a=this.md5_ff(a,n,r,i,e[o+13],12,-40341101),i=this.md5_ff(i,a,n,r,e[o+14],17,-1502002290),r=this.md5_ff(r,i,a,n,e[o+15],22,1236535329),n=this.md5_gg(n,r,i,a,e[o+1],5,-165796510),a=this.md5_gg(a,n,r,i,e[o+6],9,-1069501632),i=this.md5_gg(i,a,n,r,e[o+11],14,643717713),r=this.md5_gg(r,i,a,n,e[o+0],20,-373897302),n=this.md5_gg(n,r,i,a,e[o+5],5,-701558691),a=this.md5_gg(a,n,r,i,e[o+10],9,38016083),i=this.md5_gg(i,a,n,r,e[o+15],14,-660478335),r=this.md5_gg(r,i,a,n,e[o+4],20,-405537848),n=this.md5_gg(n,r,i,a,e[o+9],5,568446438),a=this.md5_gg(a,n,r,i,e[o+14],9,-1019803690),i=this.md5_gg(i,a,n,r,e[o+3],14,-187363961),r=this.md5_gg(r,i,a,n,e[o+8],20,1163531501),n=this.md5_gg(n,r,i,a,e[o+13],5,-1444681467),a=this.md5_gg(a,n,r,i,e[o+2],9,-51403784),i=this.md5_gg(i,a,n,r,e[o+7],14,1735328473),r=this.md5_gg(r,i,a,n,e[o+12],20,-1926607734),n=this.md5_hh(n,r,i,a,e[o+5],4,-378558),a=this.md5_hh(a,n,r,i,e[o+8],11,-2022574463),i=this.md5_hh(i,a,n,r,e[o+11],16,1839030562),r=this.md5_hh(r,i,a,n,e[o+14],23,-35309556),n=this.md5_hh(n,r,i,a,e[o+1],4,-1530992060),a=this.md5_hh(a,n,r,i,e[o+4],11,1272893353),i=this.md5_hh(i,a,n,r,e[o+7],16,-155497632),r=this.md5_hh(r,i,a,n,e[o+10],23,-1094730640),n=this.md5_hh(n,r,i,a,e[o+13],4,681279174),a=this.md5_hh(a,n,r,i,e[o+0],11,-358537222),i=this.md5_hh(i,a,n,r,e[o+3],16,-722521979),r=this.md5_hh(r,i,a,n,e[o+6],23,76029189),n=this.md5_hh(n,r,i,a,e[o+9],4,-640364487),a=this.md5_hh(a,n,r,i,e[o+12],11,-421815835),i=this.md5_hh(i,a,n,r,e[o+15],16,530742520),r=this.md5_hh(r,i,a,n,e[o+2],23,-995338651),n=this.md5_ii(n,r,i,a,e[o+0],6,-198630844),a=this.md5_ii(a,n,r,i,e[o+7],10,1126891415),i=this.md5_ii(i,a,n,r,e[o+14],15,-1416354905),r=this.md5_ii(r,i,a,n,e[o+5],21,-57434055),n=this.md5_ii(n,r,i,a,e[o+12],6,1700485571),a=this.md5_ii(a,n,r,i,e[o+3],10,-1894986606),i=this.md5_ii(i,a,n,r,e[o+10],15,-1051523),r=this.md5_ii(r,i,a,n,e[o+1],21,-2054922799),n=this.md5_ii(n,r,i,a,e[o+8],6,1873313359),a=this.md5_ii(a,n,r,i,e[o+15],10,-30611744),i=this.md5_ii(i,a,n,r,e[o+6],15,-1560198380),r=this.md5_ii(r,i,a,n,e[o+13],21,1309151649),n=this.md5_ii(n,r,i,a,e[o+4],6,-145523070),a=this.md5_ii(a,n,r,i,e[o+11],10,-1120210379),i=this.md5_ii(i,a,n,r,e[o+2],15,718787259),r=this.md5_ii(r,i,a,n,e[o+9],21,-343485551),n=this.safe_add(n,s),r=this.safe_add(r,l),i=this.safe_add(i,h),a=this.safe_add(a,u)}return Array(n,r,i,a)}md5_cmn(e,t,n,r,i,a){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(t,e),this.safe_add(r,a)),i),n)}md5_ff(e,t,n,r,i,a,o){return this.md5_cmn(t&n|~t&r,e,t,i,a,o)}md5_gg(e,t,n,r,i,a,o){return this.md5_cmn(t&r|n&~r,e,t,i,a,o)}md5_hh(e,t,n,r,i,a,o){return this.md5_cmn(t^n^r,e,t,i,a,o)}md5_ii(e,t,n,r,i,a,o){return this.md5_cmn(n^(t|~r),e,t,i,a,o)}safe_add(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}bit_rol(e,t){return e<<t|e>>>32-t}str2binl(e){for(var t=Array(),n=(1<<this.chrsz)-1,r=0;r<e.length*this.chrsz;r+=this.chrsz)t[r>>5]|=(e.charCodeAt(r/this.chrsz)&n)<<r%32;return t}binl2hex(e){for(var t=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",n="",r=0;r<4*e.length;r++)n+=t.charAt(e[r>>2]>>r%4*8+4&15)+t.charAt(e[r>>2]>>r%4*8&15);return n}$rw_hash(e){return this.hex_md5(e)}}class C{constructor(e,t,n,r){let a=e.getRootNode();this.body=e.ownerDocument.body,a.mode&&"open"==a.mode&&(this.body=a),this.startCaret=new i(e,t,!0),this.endCaret=new i(n,r,!1),this.startRef=this.rw_getRefPt(e,t),this.endRef=this.rw_getRefPt(n,r)}getPositionInDom(e){var t=new _,n=new s,r="",i=0,a="";if(null!=e&&null!=e.ownerDocument){var o=!1,l=!1,h=e.ownerDocument.body;let s=e;for(;null!=s.parentNode;)s=s.parentNode;for(s.mode&&"open"==s.mode&&(h=s);null!=e&&e!=h;){t.isSpecialCase(e)&&(r=""),o=3==e.nodeType||1==e.nodeType&&e.tagName.toLowerCase()==d&&null!=n.rw_getAttribute(e,"rwstate");for(var u=e.previousSibling;null!=u;)l=3==u.nodeType||1==u.nodeType&&u.tagName.toLowerCase()==d&&null!=n.rw_getAttribute(u,"rwstate"),o&&l||++i,u=u.previousSibling,o=l;if(r=r+i+"~",i=0,null!=(e=e.parentNode)&&null!=e.getAttribute&&null!=e.tagName){var g=n.rw_getAttribute(e,"chunk");if("span"==e.tagName.toLowerCase()&&"1"==g)a="#^th*"+n.getPositionInDom(e)+"#^th*"}}}return a+r}rw_getRefPt(e,t){var n=new _,r=new s;try{if(null==e)return null;if(1==e.nodeType||3==e.nodeType){var i,a,o=n.checkForSpecialParent(e);if(null!=o)return new b(this.getPositionInDom(o),t);1==e.nodeType?(i=0,a=e):(i=this.getNodeOffset_(e),a=e.parentNode);for(var l=r.rw_getAttribute(a,"rwstate"),h=r.rw_getAttribute(a,"rwTHgen");null!=l&&l.length>0||null!=h;)i+=this.getNodeOffset_(a),a=a.parentNode,l=r.rw_getAttribute(a,"rwstate"),h=r.rw_getAttribute(a,"rwTHgen");return-1==t&&(i=-1),new b(this.getPositionInDom(a),i+t)}return null}catch(e){return null}}getNodeOffset_(e){var t=new _;if(null==e)return 0;var n=0,r=e.previousSibling;return null!=r&&(n=t.rw_getNodeOffsetImpl(r)),n}refresh(){if(0==this.startCaret.check()||0==this.endCaret.check()){var e=new N(this.body,this.startRef.path,this.startRef.offset,this.endRef.path,this.endRef.offset);this.startCaret=e.leftCaret,this.endCaret=e.rightCaret,null==this.startCaret&&null==this.endCaret?(this.startCaret=new i(document.body,0,!0),this.endCaret=new i(document.body,0,!1)):null!=this.startCaret&&null!=this.endCaret||(null==this.startCaret?this.startCaret=new i(this.endCaret.node,this.endCaret.offset,!0):this.endCaret=new i(this.startCaret.node,this.startCaret.offset,!1))}}toString(){new _;if("INPUT"==this.startCaret.node.nodeName||"TEXTAREA"==this.startCaret.node.nodeName)return this.startCaret.node.value.substring(this.startCaret.node.selectionStart,this.startCaret.node.selectionEnd);this.refresh();let e=new N;return e.setCaretRange(this.startCaret,this.endCaret),e.getTextSpokenOverCaretRange(e)}getRangeObject(e){return void 0!==e&&null!=e||(e=document.body),e.ownerDocument.createRange()}getStartAsRange(){var e=this.getRangeObject(this.body);return e.setStart(this.startCaret.node,this.startCaret.offset),e.setEnd(this.startCaret.node,this.startCaret.offset),e}getEndAsRange(){var e=this.getRangeObject(this.body);return e.setStart(this.endCaret.node,this.endCaret.offset),e.setEnd(this.endCaret.node,this.endCaret.offset),e}equals(e){return this.startRef.path==e.startRef.path&&this.startRef.offset==e.startRef.offset&&this.endRef.path==e.endRef.path&&this.endRef.offset==e.endRef.offset}compareRange(e){if(this.equals(e))return 0;this.refresh(),e.refresh();var t=this.getStartAsRange(),n=this.getEndAsRange(),r=e.getStartAsRange(),i=e.getEndAsRange(),a=t.compareBoundaryPoints("START_TO_START",r),o=t.compareBoundaryPoints("START_TO_START",i),s=n.compareBoundaryPoints("START_TO_START",r),l=n.compareBoundaryPoints("START_TO_START",i);return o>-1?1:s<1?2:-1==a?-1==l?6:3:0==a?-1==l?7:0==l?0:3:-1==l?4:0==l?8:5}rw_getTextFromRange(){return this.text?this.text:this.toString()}rw_getTHCaretRangeFromTHDomRange(){var e=new _;if(null==this.startRef||null==this.endRef)return null;var t=e.getCaretFromDomPosition(this.body,this.startRef.path,this.startRef.offset,!0),n=e.getCaretFromDomPosition(this.body,this.endRef.path,this.endRef.offset,!1);if(null!=t&&null!=n){var r=new N;return r.setCaretRange(t,n),r}return null}getAsRange(){var e=null;e=this.getRangeObject(this.body);var t=new N(this.body,this.startRef.path,this.startRef.offset,this.endRef.path,this.endRef.offset),n=t.leftCaret,r=t.rightCaret;return null!=n&&null!=r?(e.setStart(n.node,n.offset),e.setEnd(r.node,r.offset)):e=null,e}}class _{constructor(){a(this,"hasAriaRoleMathWithLabel",(function(e){if(null!=e&&3==e.nodeType&&(e=e.parentNode),null==e)return!0;for(var t=new s,n=t.ARIA_ROLE_ATTR,r=t.ARIA_LABEL_ATTR,i=e.ownerDocument.body,a=e;null!=a&&1==a.nodeType;){var o=t.rw_getAttribute(a,n),l=t.rw_getAttribute(a,r);if(null!=o&&"math"==o&&null!=l)return!0;if(a==i)break;a=a.parentNode}return!1})),a(this,"getAriaRoleMathWithLabel",(function(e){if(null!=e&&3==e.nodeType&&(e=e.parentNode),null==e)return null;for(var t=new s,n=t.ARIA_ROLE_ATTR,r=t.ARIA_LABEL_ATTR,i=e.ownerDocument.body,a=e;null!=a&&1==a.nodeType;){var o=t.rw_getAttribute(a,n),l=t.rw_getAttribute(a,r);if(null!=o&&"math"==o&&null!=l)return l;if(a==i)break;a=a.parentNode}return null})),a(this,"isAriaHidden",(function(e){if(l.overrideAriaHidden)return!1;if(null!=e&&3==e.nodeType&&(e=e.parentNode),null==e)return!0;for(var t=new s,n=t.ARIA_HIDDEN_ATTR,r=e.ownerDocument.body,i=e;null!=i&&1==i.nodeType;){if("true"==t.rw_getAttribute(i,n))return!0;if(i==r)break;i=i.parentNode}return!1})),a(this,"isElementContainedByElement",(function(e,t){if(null==t||1!=t.nodeType||null==e||1!=e.nodeType&&3!=e.nodeType)return!1;if(e==t)return!0;for(var n=e,r=n.ownerDocument.body;null!=n&&n!=r;)if((n=n.parentNode)==t)return!0;return!1})),a(this,"getTargetElement",(function(e){return l.g_bIE?e.srcElement:(l.g_bSafari,e.target)})),a(this,"getClickPoint",(function(e){var t,n=null;if(l.g_bIE){if(1==(t=e.srcElement).nodeType&&"textarea"==t.tagName.toLowerCase());else if(null!=(n=this.rw_getTargetNodeAsCaretIE(e,!0))){if(null==n.node||null==n.node.parentNode||n.node.parentNode!=t)return n=null,null;3==n.node.nodeType&&(n.node=this.mergeTextNodes(n.node))}}else if(null!=(t=e.target))if(null!=t.firstChild&&3==t.firstChild.nodeType&&"textarea"!=t.tagName.toLowerCase()){t.firstChild.nodeValue.trimTH().length>0&&(t=t.firstChild)}else{if("thstickynote"==t.tagName.toLowerCase())return;if("textarea"!=t.tagName.toLowerCase()){var r=t.firstChild,a=this.getNextTextNodeNoImg(r,!1,t,!1);if(null!=a&&3==a.nodeType)a.nodeValue.trimTH().length>0&&(t=a)}}return null==n&&null!=t&&(n=new i(t,0,!0)),n})),a(this,"getListOfNodes",(function(e,t){let n=new S;var r=new Array;try{var i=e.node,a=t.node;if(i==a)r.push(i);else{r.push(i);for(var o=n.getNextTextNode(i,!1,a,!0);null!=o;)r.push(o),o=n.getNextTextNodeNoImg(o,!1,a,!0)}}catch(e){thLog("getListOfNodes error:"+e.message)}return r})),a(this,"getDropdownSelectedItem",(function(e){for(var t=0;t<e.childNodes.length;t++)if(e.childNodes[t].selected)return e.childNodes[t].textContent;return null}))}checkForSpecialParent(e){if(null!=e)for(var t=this.getBody(e),n=e;null!=n&&n!=t;){if(this.isSpecialCase(n))return n;n=n.parentNode}return null}getBody(e){if(e.document)return e.document.body;{let t=e.ownerDocument.body,n=e.getRootNode();return n.mode&&"open"==n.mode&&(t=n),t}}isSpecialCase(e){if(null==e)return!1;var t=new s;if((new _).hasAriaRoleMathWithLabel(e))return!0;if(1==e.nodeType){var n=e.tagName.toLowerCase();if(n==d||"span"==n){if(null!=(r=t.rw_getAttribute(e,"pron")))return!0;if(null!=(r=t.rw_getAttribute(e,"chunk")))return!0;if(null!=(r=e.isMathJax)&&r)return!0}else if("acronym"==n||"abbr"==n){if(null!=(r=e.getAttribute("title")))return!0}else{if("chunk"==n)return!0;var r;if("img"==n){if(null==(r=t.rw_getAttribute(e,"msg"))&&(r=t.rw_getAttribute(e,"alt")),null!=r)return!0}else if("math"==n)return!0}}return!1}isSpecialCaseHighlightable(e){var t=new s;if((new _).hasAriaRoleMathWithLabel(e))return!0;if(1==e.nodeType){var n=e.tagName.toLowerCase();if("span"==n){if(null!=(r=t.rw_getAttribute(e,"pron")))return!0;if(null!=(r=t.rw_getAttribute(e,"chunk"))&&"1"==r)return!0;if(null!=(r=e.isMathJax)&&r)if((new u).getMathMLText(e).length>0)return!0}else if("acronym"==n||"abbr"==n){var r;if(null!=(r=e.getAttribute("title")))return!0}else if("math"==n)return!1}return!1}checkIfElementInsideElement(e,t){if(null==e||null==t)return!1;for(var n=e.parentNode;null!=n;){if(n==t)return!0;n=n.parentNode}return!1}isSpecialCaseWithIgnoredContent(e){var t=new s;if(null==e)return!1;if(1==e.nodeType){var n=e.tagName.toLowerCase();if("span"==n){if(null!=(r=e.isMathJax)&&r)return!0}else{if("textarea"==n)return!0;var r;if("img"==n){if(null==(r=t.rw_getAttribute(e,"msg"))&&(r=t.rw_getAttribute(e,"alt")),null!=r)return!0}else if("math"==n)return!0}}return!1}rw_isWordSpeakable(e){if(null==e||0==e.length)return!1;var t=(new o).trim(e);if(1==t.length){var n=t.charCodeAt(0);if(96==n||180==n||8216==n||8217==n||8220==n||8221==n)return!1}var r,i=t.length,a=0;for(a=0;a<i;a++){if((r=t.charCodeAt(a))>63&&r<91||r>96&&r<123||r>127&&160!=r)return!0;if(r>46&&r<58)return!0;if(r>35&&r<39||43==r||61==r)return!0;if(42==r||45==r||92==r||r>93&&r<97)return!0}return!(!l.bMathsSymbols||"undefined"==typeof mathSymbolControl||"function"!=typeof mathSymbolControl.mathsSymbolCheck||!mathSymbolControl.mathsSymbolCheck(t))}createWrapperElement(){return this.createObject(g,null,null,c)}createObject(e,t,n,r){return this.createObjectForDoc(e,t,n,r,document)}createObjectForDoc(e,t,n,r,i){var a=i.createElement(e);if(null!=n&&(a.id=n),null!=r&&(a.className=r),null!=t)for(var o=t.length,s=0;s<o;s+=2)a.setAttribute(t[s],t[s+1]);return a}isStyleNode(e){var t=new s;if(null==e)return!1;if(1!=e.nodeType)return 3==e.nodeType||8==e.nodeType;var n=e.tagName.toLowerCase().trimTH();if(n==d){var r=t.rw_getAttribute(e,"started");if(null!=r&&"1"==r)return!1}return this.isInStyleList(n)}isInvalidNode(e){if(null==e)return!0;if(1!=e.nodeType)return 3!=e.nodeType||this.isInvalidNode(e.parentNode);var t=this.getComputedStyle(e);if(null!=t&&("hidden"==t.visibility||"none"==t.display))return!0;var n=e.tagName.toLowerCase();return"link"==n||"area"==n||"script"==n||"noscript"==n||"annotation"==n||"style"==n||"!--"==n||"title"==n||"html:script"==n}getComputedStyle(e){return null==e||3==e.nodeType&&null==(e=e.parentNode)?null:window.getComputedStyle(e,null)}isIgnored(e){var t=new s;if(l.bOverrideIgnore)return!1;if(null!=e&&3==e.nodeType&&(e=e.parentNode),null==e)return!0;for(var n=t.IGNORE_ATTR,r=t.ALLOW_ATTR,i=e.ownerDocument.body,a=e;null!=a&&1==a.nodeType;){if(null!=t.rw_getAttribute(a,n))return!0;if(null!=t.rw_getAttribute(a,r))return!1;if("button"==a.tagName.toLowerCase())return!1;if(a==i)break;a=a.parentNode}return!1}allTextFromNodeTH(e){var t="";if(3==e.nodeType)t=e.nodeValue;else if(1==e.nodeType)for(var n=e.firstChild;null!=n;)3==n.nodeType?t+=n.nodeValue:1==n.nodeType&&(t+=this.allTextFromNodeTH(n)),n=n.nextSibling;return t}mergeTextNodes(e){if(null==e)return e;var t=e.parentNode;if(null!=t&&3==e.nodeType){for(var n=e.ownerDocument;null!=e.previousSibling&&3==e.previousSibling.nodeType;){var r=e.previousSibling.nodeValue+e.nodeValue,i=n.createTextNode(r);t.removeChild(e.previousSibling),t.replaceChild(i,e),e=i}for(;null!=e.nextSibling&&3==e.nextSibling.nodeType;){r=e.nodeValue+e.nextSibling.nodeValue,i=n.createTextNode(r);t.removeChild(e.nextSibling),t.replaceChild(i,e),e=i}}return e}rw_reduceSelectionForNonSpeechChar(e){var t=new S,n=!1,r=e.rightCaret.node,a=e.rightCaret.offset,o=e.leftCaret.node,s=e.leftCaret.offset;try{var l,h;if(!e.rightCaret.isSpecialCase())for(var u=r.nodeValue;;){if(0==a){if(null==(l=t.getPreviousTextNode(r,!1,o)))break;if(1==l.nodeType){r=l,a=0,n=!0;break}a=(u=(r=l).nodeValue).length,n=!0}if(r==o&&a==s)break;if(!(a>0))break;if(h=u.charAt(a-1),!this.rw_isWhiteSpace(h))break;--a,n=!0}if(!e.leftCaret.isSpecialCase())for(var d=o.nodeValue,g=d.length;;){if(s==g){if(null==(l=t.getNextTextNode(o,!1,r)))break;if(1==l.nodeType){o=l,s=0,g=0,n=!0;break}d=(o=l).nodeValue,s=0,g=d.length,n=!0}if(r==o&&a==s)break;if(!(s<g))break;if(h=d.charAt(s),!this.rw_isWhiteSpace(h))break;++s,n=!0}}catch(e){}return n?new N(new i(o,s,!0),new i(r,a,!1)):e}rw_isWhiteSpace(e){return e.search(/[\s\xa0]/)>-1}getSentenceFromPointByLang(e){var t=new y,n=t.getSentenceBreakToRight(e),r=t.getSentenceBreakToLeft(n),i=new N;return i.setCaretRange(r,n),i}isSpecialCaseNested(e){if(null!=e)for(var t=this.getBody(e),n=e;null!=n&&n!=t;){if(this.isSpecialCase(n))return!0;n=n.parentNode}return!1}rw_isTextChar(e){return e>47&&e<58||e>63&&e<91||e>94&&e<123}rw_isFullStop(e,t,n){var r=new S,i=!0;if(e.length>t+1){var a=e.charCodeAt(t+1);this.rw_isTextChar(a)&&(i=!1),l.bMathsSymbols&&61==a&&mathsSymbolCheck("!=")&&null!=n&&"!"==n.nodeValue.charAt(t)&&(i=!1)}if(i&&null!=n&&"."!=n.nodeValue.charAt(t))return!0;if(i)if(t>1){var o=e.substring(t-2,t);if((" "==o.charAt(0)||"\n"==o.charAt(0)||"\r"==o.charAt(0)||"\t"==o.charAt(0))&&o.charCodeAt(1)>63&&o.charCodeAt(1)<91)i=!1;else if("."==o.charAt(0)&&this.rw_isTextChar(o.charCodeAt(1)))i=!1;else if("Dr"==o||"Mr"==o||"Ms"==o||"Av"==o||"St"==o||"eg"==o)i=!1;else if(t>2){var s=e.substring(t-3,t);if("Mrs"==s||"etc"==s||"i.e"==s||"P.O"==s||"PhD"==s)i=!1;else if(t>3){"Ph.D"==e.substring(t-4,t)&&(i=!1)}}}else try{if(null!=n&&0==t){var h=r.getPreviousTextNode(n,!0,null);if(null!=h&&3==h.nodeType&&h!=n)return!!this.rw_isFullStop(h.nodeValue+e,h.nodeValue.length,null)}}catch(e){}return i}rw_caretRangeIsSpeakable(e){var t=new S;try{if(null==e||null==e.leftCaret||null==e.rightCaret)return!1;if(this.rw_checkForHiddenParent(e.leftCaret.node))return!1;for(var n=e.leftCaret,r=e.rightCaret,i=n.node,a=r.node,o=!0,s=!1,l=i;null!=l;){if((s=this.isSpecialCase(l))||3==l.nodeType){var h=t.getTextFromNode(l);if(null!=h&&""!=h&&(s||(l==a&&r.offset>-1&&(h=h.substring(0,r.offset)),l==i&&n.offset>0&&(h=h.substring(n.offset))),this.rw_isWordSpeakable(h)))return!0}l=s?t.getNextNodeIgnoreChildren(l,!1,a):o?t.getNextNodeAllowMoveToChild(l,!0,a):t.getNextNode(l,!1,a),o=!1}}catch(e){}return!1}rw_checkForHiddenParent(e){try{var t=this.getComputedStyle(e);if(null!=t&&("none"==t.display||"hidden"==t.visibility))return!0;for(var n=e,r=n.ownerDocument.body;n!=r;)if(n=n.parentNode,"none"==this.getComputedStyle(n).display)return!0}catch(e){}return!1}rw_getRefPt(e,t){var n=new s;try{if(null==e)return null;if(1==e.nodeType||3==e.nodeType){var r,i,a=this.checkForSpecialParent(e);if(null!=a)return new b(this.getPositionInDom(a),t);1==e.nodeType?(r=0,i=e):(r=this.rw_getNodeOffset(e),i=e.parentNode);for(var o=n.rw_getAttribute(i,"rwstate"),l=n.rw_getAttribute(i,"rwTHgen");null!=o&&o.length>0||null!=l;)r+=this.rw_getNodeOffset(i),i=i.parentNode,o=n.rw_getAttribute(i,"rwstate"),l=n.rw_getAttribute(i,"rwTHgen");return-1==t&&(r=-1),new b(this.getPositionInDom(i),r+t)}return null}catch(e){return null}}rw_getNodeOffset(e){if(null==e)return 0;var t=0,n=e.previousSibling;return null!=n&&(t=this.rw_getNodeOffsetImpl(n)),t}getPositionInDom(e){var t=new s,n="",r=0,i="";if(null!=e&&null!=e.ownerDocument){var a=!1,o=!1,l=e.ownerDocument.body;let s=e.getRootNode();for(s.mode&&"open"==s.mode&&(l=s);null!=e&&e!=l;){this.isSpecialCase(e)&&(n=""),a=3==e.nodeType||1==e.nodeType&&e.tagName.toLowerCase()==d&&null!=t.rw_getAttribute(e,"rwstate");for(var h=e.previousSibling;null!=h;)o=3==h.nodeType||1==h.nodeType&&h.tagName.toLowerCase()==d&&null!=t.rw_getAttribute(h,"rwstate"),a&&o||++r,h=h.previousSibling,a=o;if(n=n+r+"~",r=0,null!=(e=e.parentNode)&&null!=e.getAttribute&&null!=e.tagName){var u=t.rw_getAttribute(e,"chunk");if("span"==e.tagName.toLowerCase()&&"1"==u)i="#^th*"+this.getPositionInDom(e)+"#^th*"}}}return i+n}rw_getBreakInCurrentWord(e){if(null==e||0==e.length)return-1;let t,n,r=this.extractProbablePhoneNumbers(e),i=this.extractProbablePostcode(e),a=e.search("["+String.fromCharCode(8212)+'\\s"]');if(null!=r&&r.length>0&&(t=e.indexOf(r[0])),null!=i&&i.length>0&&(n=e.indexOf(i[0])),null!=t||null!=n){let e,o;null!=t&&null!=n?t<n?(e=t,o=t+r[0].length):(e=n,o=n+i[0].length):null!=t?(e=t,o=t+r[0].length):(e=n,o=n+i[0].length),a>e&&a<o&&(a=o)}return a}rw_isLetter(e){return e>64&&e<91||e>96&&e<123}rw_getNodeOffsetImpl(e){for(var t=0,n=e;null!=n;)3!=n.nodeType||this.isIgnored(n)||this.isAriaHidden(n)?1==n.nodeType&&(this.isInvalidNode(n)||(this.isSpecialCase(n)?t+=1:"textarea"!=n.tagName.toLowerCase()?t+=this.rw_getNodeOffsetImpl(n.lastChild):t+=1)):t+=n.nodeValue.length,n=n.previousSibling;return t}rw_getCaretFromRefPt(e,t){return this.getCaretFromDomPosition(e,t.path,t.offset,!0)}getCaretFromDomPosition(e,t,n,r,a){var o=new S;void 0===a&&(a=!1);try{if(null==e)return null;var s=o.getNodeFromPosition(e,t);if(a){var l=new i(s,0,r);return l.setSpecialCase(!0),l}var h=this.checkForSpecialParent(s);if(null!=h){if(s=h,this.isSpecialCaseHighlightable(h)){if(r){var u=o.getFirstChildTextNode(s,!1);return new i(null!=u?u:s,0,r)}return null!=(c=o.getLastChildTextNode(s,!1))?3==c.nodeType?new i(c,c.length,r):new i(c,0,r):new i(s,0,r)}return new i(h,0,r)}var d=0;if(r||++d,n>-1){if(null==s)return null;for(var g=!1,c=s.parentNode,f=s;!g;){if(3==s.nodeType){if(n<d+s.nodeValue.length){g=!0;break}f=s,d+=s.nodeValue.length,s=o.getNextNode(s,!1,c)}else if(1==s.nodeType)if(null!=(h=this.checkForSpecialParent(s))){if(s=h,!(n-d>0)){g=!0;break}d+=1,s=o.getNextNodeIgnoreChildren(s,!1,c)}else s=o.getNextNode(s,!1,c);if(null==s||s==c){if(null!=f){d=3==(s=f).nodeType?n-s.nodeValue.length:0,r||++d;break}return null}}return new i(s,r?n-d:n-(d-1),r)}return new i(s,n,r)}catch(e){return null}}getNodesOverRange(e,t){var n=new S,r=[];if(null==e||null==t)return r;for(var i=e;i;)this.isInvalidNode(i)?i=n.getActualNextNodeIgnoreChildren(i,t):(this.isIgnored(i)||this.isAriaHidden(i)||r.push(i),i=n.getActualNextNode(i,t));return r}getWindow(e){try{if(null==e)return window;if(0===top.frames.length)return window;var t=e.ownerDocument.body;if(t===window.document.body)return window;var n,r=top.frames.length;for(n=0;n<r;n++)try{if(top.frames[n].document.body===t)return top.frames[n]}catch(e){}}catch(e){}return window}rw_getTextRangeAsTHRange(e,t){var n=t.duplicate();n.collapse(!0);var r=rw_getTextRangeAsRefPtIE(e,n);(n=t.duplicate()).collapse(!1);var i=rw_getTextRangeAsRefPtIE(e,n);return new w(e,r,i)}rw_getAsTextRange(e,t,n,r,i){var a=this.getRangeObject(e),o=new N(e,t,-1,r,-1),s=o.leftCaret,l=o.rightCaret;if(null!=s&&null!=s.node&&null!=l&&null!=l.node){var h=s.node;if(3==h.nodeType){var u=this.rw_getNodeOffset(h);h=h.parentNode,n+=u}var d=l.node;if(3==d.nodeType){u=this.rw_getNodeOffset(d);d=d.parentNode,i+=u}a.moveToElementText(h),a.collapse(),rw_moveEnd(a,n),a.collapse(!1),a.select();var g=this.getRangeObject(e);g.moveToElementText(d),g.collapse(),rw_moveEnd(g,i),g.collapse(!1),a.setEndPoint("EndToEnd",g)}else a=null;return a}rw_collapseSelection(){var e=this.getSelectionObject();null!=e&&(e.collapseToStart?e.collapseToStart():e.execCommand&&e.execCommand("UnSelect",!1,null))}getSelectionObject(){var e=null;if(window.getSelection)return null;if(document.selection){var t=document.selection.createRange();if(t.text.length>0)theWindow=window,e=t;else{var n=this.getFrameSelectionOldIE(window);n.theRange&&(e=n.theRange)}}return e}getFrameSelectionOldIE(e){var t,n={};if(e.frames&&e.length>0){var r,i=e.length;for(r=0;r<i;r++)try{var a=e[r];if(null!=(t=a.document.selection.createRange())&&null!=t.text&&t.text.length>0){n.theWindow=a,n.theRange=t;break}if(a.length>0){var o=this.getFrameSelectionOldIE(a);if(o.theRange){n=o;break}}}catch(e){}}return n}getFrameSelectionSFF(e){var t={},n=this.getFrameSelection(e);return null!=n&&(t.theWindow=n,t.foundSel=n.getSelection()),t}getFrameSelection(e){if(e.frames&&e.length>0){var t=e.length;for(i=0;i<t;i++)try{var n=e[i].getSelection();if(null!=n&&!n.isCollapsed)return e[i];if(e[i].getElementsByTagName("textarea").length>0)for(var r=e[i].getElementsByTagName("textarea"),i=0;i<r.length;i++)if(r[i].selectionStart!=r[i].selectionEnd)return e[i];if(e[i].length>0){var a=this.getFrameSelection(e[i]);if(a)return a}}catch(e){}}return null}getFrameSelectionInTextAreas(e){return this.getFrameSelectionInTextarea(e)}getFrameSelectionInTextarea(e){if(e.frames&&e.length>0){var t,n=e.length;for(t=0;t<n;t++)try{if(e[t].document.getElementsByTagName("textarea").length>0)for(var r=e[t].document.getElementsByTagName("textarea"),i=0;i<r.length;i++)if(r[i].selectionStart!=r[i].selectionEnd)return{frame:e[t],textArea:r[i]}}catch(e){}}return null}isLineBreakNode(e){if(1!=e.nodeType)return!1;var t=e.tagName.toLowerCase().trimTH();return this.isInBreakList(t)}isInBreakList(e){return f.includes(e)}isInStyleList(e){return m.includes(e)}isAriaHidden(e){let t=new s;if(l.overrideAriaHidden)return!1;var n=T.isIgnorePageDefault();if(null!=e&&3==e.nodeType&&(e=e.parentNode),null==e)return!0;for(var r=e.ownerDocument.body,i=e;null!=i&&1==i.nodeType;){if("true"==t.rw_getAttribute(i,"aria-hidden"))return!0;if(i==r)break;i=i.parentNode}return n}rw_getUniqueIdForTextNode(e){if(null!=e&&3==e.nodeType){var t=e.ownerDocument,n=t.body,r=e.nodeValue;if(null!=r){r=r.replace(/\s+/g,"");for(var i=e.parentNode;null!=i&&null!=i.parentNode;){if(null!=(i=i.parentNode).id&&i.id.length>0&&"rwTH"!=i.id.substr(0,4)){r=i.id+r;break}if(i==n)break}var a="rwTH"+(new x).hex_md5(r);if(null!=t.getElementById(a)){for(var o=1;null!=t.getElementById(a+o);)++o;a+=o}return a}}return null}rw_getElementById(e){var t=document.getElementById(e);if(null==t){if(!g_bIgnoreFrames){var n,r=top.frames.length;for(n=0;n<r;n++)try{var i=top.frames[n].document.getElementById(e);if(null!=i)return i}catch(e){}}return null}return t}rw_getSelection(){var e=null,t=null;if(l.g_bIEOld){if(null==(s=document.selection.createRange())||null==s.text||0==s.text.length)(o=this.getFrameSelectionOldIE(window)).theRange&&(e=o.theWindow,t=o.theRange);else e=window,t=s;if(null!=t){var n=t.duplicate();n.collapse();var r=n.parentElement();(this.isIgnored(r)||this.isAriaHidden(r))&&(t=null)}null!=t&&null!=t.parentElement()&&"input"==t.parentElement().tagName.toLowerCase()&&(t=new String(t.text))}else{null!=l.g_ipadSelectionRange&&l.g_ipadSelectionWindow.getSelection().addRange(l.g_ipadSelectionRange);var i=window.getSelection(),a=null;if(!i.isCollapsed&&i.toString().trimTH().length>0)e=window,a=i;else{if(l.g_lastInputSelectSFF&&l.g_lastInputSelectSFF.selectionStart!=l.g_lastInputSelectSFF.selectionEnd)return{frame:window,range:new String(l.g_lastInputSelectSFF.value.substring(l.g_lastInputSelectSFF.selectionStart,l.g_lastInputSelectSFF.selectionEnd))};var o;(o=this.getFrameSelectionSFF(window)).foundSel&&(e=o.theWindow,a=o.foundSel)}if(null==a)return null;if(a.anchorNode&&(this.isIgnored(a.anchorNode)||this.isAriaHidden(a.anchorNode)&&!a.anchorNode.parentNode.isMathJax))return null;if(a.focusNode&&a.focusNode.id&&"flashcontent"==a.focusNode.id)return null;if(null!=a.anchorNode&&a.anchorNode==a.focusNode&&a.anchorOffset==a.focusOffset)return null;var s,h=null;if(a.getRangeAt)h=a.getRangeAt(0);else null!=(s=this.getRangeObject())&&(a.anchorNode==a.focusNode&&a.anchorOffset==a.focusOffset?s=this.getRangeFromSelectionPoint(a):(s.setStart(a.anchorNode,a.anchorOffset),s.setEnd(a.focusNode,a.focusOffset),0==s.toString().length&&(s.setStart(a.focusNode,a.focusOffset),s.setEnd(a.anchorNode,a.anchorOffset))),h=s);if(null==h)return null;var u=h.startContainer,d=h.startOffset,g=h.endContainer,c=h.endOffset;if(3!=u.nodeType){if(1!=u.nodeType)return null;if(d>0&&u.hasChildNodes()&&u.childNodes.length>d)if(3==(u=u.childNodes[d]).nodeType)d=0;else if(d=0,"[object HTMLEmbedElement]"==u.toString())return null}if(3!=g.nodeType){if(1!=g.nodeType)return null;if(g.hasChildNodes()&&(g.childNodes.length>c?g=g.childNodes[c]:3!=(g=g.childNodes[c-1]).nodeType&&null!=(f=this.getLastChildTextNode(g,!0))&&(g=f)),3!=g.nodeType){var f,m=this.getPreviousNode(u,!0,null);null!=(f=this.getPreviousTextNode(g,!1,m))&&(g=f)}c=3==g.nodeType?g.nodeValue.length:0}t=new C(u,d,g,c)}return null!=e&&null!=t?{frame:e,range:t}:null}rw_replaceAll(e,t,n){if("string"==typeof e)for(var r=e.indexOf(t);r>-1;)r=(e=e.substring(0,r)+n+e.substring(r+t.length)).indexOf(t,r+n.length);return e}rw_checkIfCanHaveStickys(e){let t=new s;if(null!=(i=e.previousSibling)&&1==i.nodeType&&("img"==i.tagName.toLowerCase()||"thstickynote"==i.tagName.toLowerCase())&&null!=t.rw_getAttribute(i,"texthelpnoteid"))return!1;var n=e;if(3==n.nodeType&&(n=n.parentNode),null!=t.rw_getAttribute(n,"rwthgen")||null!=t.rw_getAttribute(n,"rwstate"))for(var r=!0;r;){var i;if(null!=(i=n.previousSibling)&&1==i.nodeType&&"img"==i.tagName.toLowerCase()&&null!=t.rw_getAttribute(i,"texthelpnoteid"))return!1;n=n.parentNode,r=null!=t.rw_getAttribute(n,"rwthgen")||null!=t.rw_getAttribute(n,"rwstate")}if(1==e.nodeType){if(null!=t.rw_getAttribute(e,"texthelpnoteid"))return!1;var a=e.tagName.toLowerCase();if("input"==a||"textarea"==a||"img"==a||"label"==a||"button"==a||"nobr"==a);else if("span"==a){if(null==(l=t.rw_getAttribute(e,"pron")))return!1}else{if("acronym"!=a&&"abbr"!=a)return!1;if(null==(l=e.getAttribute("title")))return!1}}if(this.isInvalidNode(e)||this.isIgnored(e)||this.isAriaHidden(e))return!1;for(var o=document.body;null!=e&&e!=o;){if(1==e.nodeType){var l;if(null!=(l=t.rw_getAttribute(e,"rwTHcomp"))&&"1"==l)return!1;if(null!=t.rw_getAttribute(e,"ignorenote"))return!1}e=e.parentNode}return!0}addEvent(e,t,n){return e.addEventListener?(l.g_bChromeExtension?e.addEventListener(t,n,!0):e.addEventListener(t,n,!1),!0):!!e.attachEvent&&e.attachEvent("on"+t,n)}createPlainSpan(){return this.createObject("span",null,null,l.g_bOverrideSpan?"thspan":null)}splitText(e,t){let n=new s;if(null==e||3!=e.nodeType||null==e.parentNode)return e;var r=0,i=e.parentNode,a=i.parentNode;if(null==a||"thspan"!=i.tagName.toLowerCase()||"thspan"!=a.tagName.toLowerCase()||null==n.rw_getAttribute(i,"rwTHgen")||null==n.rw_getAttribute(a,"rwTHgen")&&null==n.rw_getAttribute(a,"rwTHpgen")?"thspan"!=i.tagName.toLowerCase()||null==n.rw_getAttribute(i,"rwTHgen")&&null==n.rw_getAttribute(i,"rwTHpgen")||(r=1):(r=2,null==e.nextSibling&&null==e.previousSibling||(r=1)),0==e.nodeValue.length||t<=0||t>=e.nodeValue.length){if(0==r){var o=this.createWrapperElement();n.rw_setAttribute(o,"rwTHgen","1");var l=this.createWrapperElement();n.rw_setAttribute(l,"rwTHgen","1"),i.insertBefore(o,e),o.appendChild(l),l.appendChild(e)}else if(1==r){o=this.createWrapperElement();n.rw_setAttribute(o,"rwTHgen","1"),i.insertBefore(o,e),o.appendChild(e)}return e}var h=e.nodeValue,u=h.substring(0,t),d=h.substring(t),g=(l=this.createWrapperElement(),this.createWrapperElement()),c=document.createTextNode(u),f=document.createTextNode(d);if(l.appendChild(c),g.appendChild(f),n.rw_setAttribute(l,"rwTHgen","1"),n.rw_setAttribute(g,"rwTHgen","1"),2==r)a.insertBefore(g,i),a.insertBefore(l,g),a.removeChild(i);else if(1==r)i.insertBefore(l,e),i.insertBefore(g,e),i.removeChild(e);else{o=this.createWrapperElement();n.rw_setAttribute(o,"rwTHgen","1"),o.appendChild(l),o.appendChild(g),i.insertBefore(o,e),i.removeChild(e)}return f}rw_isSpan(e){return"span"==e||"thspan"==e}moveCaret(e,t,n){var r,a=e.node,o=e.offset,s=e.forwardBias,l=new S;if(3!=a.nodeType)return null;for(;a;){var h=a.nodeValue.length;if(0==h)if(t>0||0==t&&s){if(null==(r=l.getNextTextNodeNoImg(a,n,null,!0)))return 0==t?new i(a,a.nodeValue.length,s):null;a=r,o=0}else{if(null==(r=l.getPreviousTextNodeNoImg(a,n,null,!0)))return 0==t?new i(a,0,s):null;o=(a=r).nodeValue.length}else if((o+=t)<0||0==o&&!s){if(t=o,null==(r=l.getPreviousTextNodeNoImg(a,n,null,!0)))return 0==t?new i(a,0,s):null;o=(a=r).nodeValue.length}else{if(!(o>h||o==h&&s))return new i(a,o,s);if(t=o-h,null==(r=l.getNextTextNodeNoImg(a,n,null,!0)))return 0==t?new i(a,a.nodeValue.length,s):null;a=r,o=0}}return null}getPhoneNumbersFromString(e){var t=[];return this.containsDigitAndSpace(e)&&(t=this.extractProbablePhoneNumbers(e)),t}getPostcodesFromString(e){var t=[];return this.containsDigitAndSpace(e)&&(t=this.extractProbablePostcode(e)),t}extractProbablePhoneNumbers(e){var t=new RegExp("[a-zA-Z]+","g"),n=new Array;if(!t.test(e)){var r,i,a,s,l,h,u,d,g=[],c=[],f=!1,m=!1,p=e.length;let t=new o;for(a=0;a<p;a++)l=(s=e[a]).charCodeAt(0),f=t.rw_isWhiteSpace(s),a>0&&a<e.length-1&&(r=e[a-1],i=e[a+1]),!m&&this.isStartTelSymbol(l)?(c.push(a),m=!0):(m&&!this.containsTelSymbol(l)&&!f||this.isSpacePaddingTelChar(s,r,i))&&(h=this.getLastValidTelChar(e.substring(0,a)),c.push(h>-1?h:a),m=!1);for(c.push(e.length),a=1;a<c.length;a++)u=c[a-1],d=c[a],g.push(e.substring(u,d));var v;for(a=0;a<g.length;a++)v=this.cleanTelFormat(g[a].trim()),this.isTelFormat(v)&&n.push(v)}return n.length>0?n:null}getLastValidTelChar(e){var t,n=-1;for(t=e.length-1;t>-1;t--)if(!isNaN(e[t])){n=t+1;break}return n}cleanTelFormat(e){var t=e.indexOf("("),n=e.indexOf(")");return t>-1&&-1===n?e=e.substring(0,t).trim():-1===t&&n>-1?e=e.substring(n+1).trim():t>n&&(e=e.substring(n+1,t).trim()),e}isTelFormat(e){var t,n=!1;return(n=(t=e.replace(/[^0-9]/g,"").length)>=7&&t<=25&&/\d+/.test(e))&&e.lastIndexOf("+")>-1&&(n=e.lastIndexOf("+")<=1),n}isSpacePaddingTelChar(e,t,n){var r=!1;if(t&&n){r=/\s+(\-|\(|\)|\.|\+|\/)\s+/.test(t+e+n)}return r}isStartTelSymbol(e){return(new o).isNumber(e)||40===e||43===e}containsTelSymbol(e){return(new o).isNumber(e)||e>39&&e<42||43===e||e>44&&e<48}extractProbablePostcode(e){return e.match(/(GIR 0AA)|((([ABCDEFGHIJKLMNOPRSTUWYZ][0-9][0-9]?)|(([ABCDEFGHIJKLMNOPRSTUWYZ][ABCDEFGHKLMNOPQRSTUVWXY][0-9][0-9]?)|(([ABCDEFGHIJKLMNOPRSTUWYZ][0-9][ABCDEFGHJKSTUW])|([ABCDEFGHIJKLMNOPRSTUWYZ][ABCDEFGHKLMNOPQRSTUVWXY][0-9][ABEHMNPRVWXY])))) [0-9][ABDEFGHJLNPQRSTUWXYZ]{2})/gi)}containsDigitAndSpace(e){return!(!(new o).rw_isWhiteSpace(e)||!/\d/g.test(e))}wrapText(e,t,n,r){let i=e.parentNode;if(3!=e.nodeType&&null!=i)return null;let a,o,l,h=i.ownerDocument,u=this.createWrapperElementForDoc(h),d=e.nodeValue,g=new s;if("span"!=i.tagName.toLowerCase()&&"thspan"!=i.tagName.toLowerCase()||null==g.rw_getAttribute(i,"pron"))a=d.substring(0,t),o=d.substring(t,n),l=d.substring(n);else{if(null!=r&&"pron"==r[0])return null;a="",o=d,l=""}if(null!=r)for(var c=0;c<r.length;c+=2)g.rw_setAttribute(u,r[c],r[c+1]);let f,m=null,p=null;if(a.length>0&&(m=h.createTextNode(a)),f=h.createTextNode(o),l.length>0&&(p=h.createTextNode(l)),u.appendChild(f),i.replaceChild(u,e),null!=m){let e=this.createWrapperElementForDoc(h);e.appendChild(m),i.insertBefore(e,u)}if(null!=p){let e=this.createWrapperElementForDoc(h);e.appendChild(p),null==u.nextSibling?i.insertBefore(e,null):i.insertBefore(e,u.nextSibling)}return u}createWrapperElementForDoc(e){return this.createObjectForDoc("thspan",null,null,null,e)}createObjectForDoc(e,t,n,r,i){var a=i.createElement(e);if(null!=n&&(a.id=n),null!=r&&(a.className=r),null!=t)for(var o=t.length,s=0;s<o;s+=2)a.setAttribute(t[s],t[s+1]);return a}}class N{constructor(e,t,n,r,i){this.leftCaret=null,this.rightCaret=null,null!=e&&null!=t&&null!=n&&null!=r&&null!=i&&this.getCaretPairFromDomPosition(e,t,n,r,i)}setCaretRange(e,t){this.leftCaret=e,this.rightCaret=t}equals(e){return null!=e&&(this.leftCaret.equals(e.leftCaret)&&this.rightCaret.equals(e.rightCaret))}toString(){return this.getTextOverCaretRange()}checkIfImage(){return null!=this.leftCaret&&null!=this.rightCaret&&(!(!this.leftCaret.specialCase||1!=this.leftCaret.node.nodeType||"img"!=this.leftCaret.node.tagName.toLowerCase())||!(!this.rightCaret.specialCase||1!=this.rightCaret.node.nodeType||"img"!=this.rightCaret.node.tagName.toLowerCase()))}getTextOverCaretRange(){var e=new _,t=new s;try{if(null==this.leftCaret||null==this.rightCaret)return"";var n,r=this.leftCaret,i=this.rightCaret,a=r.node,o=i.node,l="",h=e.getNodesOverRange(a,o);if(null!=h&&h.length>0)for(var u=0;u<h.length;u++){var d=h[u];if(3==d.nodeType&&"textarea"!=d.parentNode.tagName.toLowerCase())n=d.nodeValue,o==a?l+=n.substring(r.offset,i.offset):d==a&&r.offset>0?l+=n.substr(r.offset):d==o&&i.offset>-1?l+=n.substring(0,i.offset):l+=n;else if(1==d.nodeType){if("img"==d.tagName.toLowerCase()&&t.rw_getAttribute(d,"msg")){l=t.rw_getAttribute(d,"msg");continue}"img"==d.tagName.toLowerCase()&&t.rw_getAttribute(d,"alt")&&(l=t.rw_getAttribute(d,"alt"))}}return l.trimTH()}catch(e){return""}}rw_getTHRangeFromTHCaretRange(){return null==this||null==this.leftCaret||null==this.rightCaret?null:new THRange(this.leftCaret.node.ownerDocument.body,this.rw_getRefPt(this.leftCaret.node,this.leftCaret.offset),this.rw_getRefPt(this.rightCaret.node,this.rightCaret.offset))}getCaretPairFromDomPosition(e,t,n,r,i){var a=new _;this.leftCaret=a.getCaretFromDomPosition(e,t,n,!0),this.rightCaret=t==r&&n>=i?this.leftCaret:a.getCaretFromDomPosition(e,r,i,!1)}getTextSpokenOverCaretRange(e){let t=new S,n=new _;try{if(null==e||null==e.leftCaret||null==e.rightCaret)return"";var r=e.leftCaret,a=e.rightCaret,o=r.node,s=a.node,l=n.isSpecialCaseNested(o);l&&(o=n.checkForSpecialParent(o),r=new i(o,0,!0));for(var h=o,u="";null!=h;){if((l=n.isSpecialCase(h))||3==h.nodeType){var d=t.getTextFromNode(h);null!=d&&""!=d&&(l||(h==s&&a.offset>-1&&(d=d.substring(0,a.offset)),h==o&&r.offset>-1&&(d=d.substring(r.offset))),u+=d)}h=l?t.getNextNodeIgnoreChildren(h,!1,s):t.getNextNode(h,!1,s)}return u.trimTH()}catch(e){return""}}}class A{constructor(){}clearSelection_(){this.clearBrowserSelection()}clearBrowserSelection(){if(window.getSelection){for(let e=0;e<window.frames.length;e++)try{window.getSelection().empty?window.frames[e].getSelection().empty():window.getSelection().removeAllRanges&&window.frames[e].getSelection().removeAllRanges()}catch(e){}window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges()}else document.selection&&document.selection.empty()}getSelectionRange(){}hasSelection(){}}class E extends A{constructor(){super(),this.g_ipadSelectionRange=null,this.lastInputSelect=null;for(var e=document.getElementsByTagName("input"),t=0;t<e.length;t++){null!=(r=(n=e.item(t)).type)&&"text"==r&&n.addEventListener("mouseup",e=>{this.inputHandler(e)},!0)}for(e=document.getElementsByTagName("textarea"),t=0;t<e.length;t++){var n,r;null!=(r=(n=e.item(t)).type)&&"textarea"==r&&n.addEventListener("mouseup",e=>{this.inputHandler(e)},!0)}}inputHandler(e){this.lastInputSelect=e.currentTarget}getSelectionRange(){var e=this.getSelection_();return e?e.range:null}getElementRangeById(e){let t=this.getSelectionById(e);return t?t.range:null}getSelectionObject(){var e=this.getSelection_();return this.clearBrowserSelection(),e}isMathJax(e){if(void 0!==e.startCaret.node.ownerDocument.defaultView.MathJax){if(e.startCaret.node.isMathJax)return!0;if(e.startCaret.node.parentNode.isMathJax)return!0}return!1}hasSelection(){var e=this.getSelection_();return null!=e&&null!=e}getSelectionString(){return this.getSelection_().range.toString()}getSelectionTextById(e){return this.getSelectionById(e).range.toString()}getSelection_(){var e=new _,t=new S,n=null,r=null;null!=this.g_ipadSelectionRange&&g_ipadSelectionWindow.getSelection().addRange(this.g_ipadSelectionRange);var i=window.getSelection(),a=null,s=new o;if(!i.isCollapsed&&s.trim(i.toString()).length>0)n=window,a=i;else{if(this.lastInputSelect&&this.lastInputSelect.selectionStart!=this.lastInputSelect.selectionEnd)return r=new C(this.lastInputSelect,0,this.lastInputSelect,0),{frame:window,range:r};var l=e.getFrameSelectionSFF(window);l.foundSel&&(n=l.theWindow,a=l.foundSel);var h=e.getFrameSelectionInTextAreas(window);if(null!=h)return r=new C(h.textArea,0,h.textArea,0),{frame:h.frame,range:r}}if(i.anchorNode&&i.anchorNode.children&&i.anchorNode.children[0]&&i.anchorNode.children[0].shadowRoot)try{n=(i=i.anchorNode.children[0].shadowRoot.getSelection()).anchorNode.getRootNode(),a=i}catch(e){}if(null==a)return null;if(a.anchorNode&&(e.isIgnored(a.anchorNode)||e.isAriaHidden(a.anchorNode)&&!a.anchorNode.parentNode.isMathJax))return null;if(a.focusNode&&a.focusNode.id&&"flashcontent"==a.focusNode.id)return null;if(null!=a.anchorNode&&a.anchorNode==a.focusNode&&a.anchorOffset==a.focusOffset)return null;var u=null;if(a.getRangeAt)u=a.getRangeAt(0);else{var d=e.getRangeObject();null!=d&&(a.anchorNode==a.focusNode&&a.anchorOffset==a.focusOffset?d=e.getRangeFromSelectionPoint(a):(d.setStart(a.anchorNode,a.anchorOffset),d.setEnd(a.focusNode,a.focusOffset),0==d.toString().length&&(d.setStart(a.focusNode,a.focusOffset),d.setEnd(a.anchorNode,a.anchorOffset))),u=d)}if(null==u)return null;var g=u.startContainer,c=u.startOffset,f=u.endContainer,m=u.endOffset;if(3!=g.nodeType){if(1!=g.nodeType)return null;if(c>0&&g.hasChildNodes()&&g.childNodes.length>c)if(3==(g=g.childNodes[c]).nodeType)c=0;else if(c=0,"[object HTMLEmbedElement]"==g.toString())return null}if(3!=f.nodeType){if(1!=f.nodeType)return null;if(f.hasChildNodes()&&(f.childNodes.length>m?f=f.childNodes[m]:3!=(f=f.childNodes[m-1]).nodeType&&null!=(p=t.getLastChildTextNode(f,!0))&&(f=p)),3!=f.nodeType){var p,v=t.getPreviousNode(g,!0,null);null!=(p=t.getPreviousTextNode(f,!1,v))&&(f=p)}m=3==f.nodeType?f.nodeValue.length:0}return r=new C(g,c,f,m),null!=n&&null!=r?{frame:n,range:r}:null}getSelectionById(e){let t,n=new _,r=new S;t="string"==typeof e?document.getElementById(e):e;let i=t.getRootNode(),a=window;if(i.mode&&"open"==i.mode&&(a=i),null!=t){if(1==t.nodeType&&"img"==t.tagName&&null==t.getAttribute("alt")&&null==t.getAttribute("msg"))return{frame:a,range:o};let e=t.innerHTML;if(e.length>0){let i=r.getFirstChildTextNode(t,!0);if(null==i||3!=i.nodeType&&!i.isMathJax){if(null==i||1!=i.nodeType||"img"!=i.tagName)return null;{let e=i.getAttribute("msg");if(null==e&&(e=i.getAttribute("alt")),!(null!=e&&e.length>0))return null}}let s=r.getLastChildTextNode(t,!0);if(null==s||3!=s.nodeType&&!s.isMathJax){if(null==s||1!=s.nodeType||"img"!=s.tagName)return null;{let e=s.getAttribute("msg");if(null==e&&(e=s.getAttribute("alt")),!(null!=e&&e.length>0))return null}}n.rw_getRefPt(i,0),3==s.nodeType?n.rw_getRefPt(s,s.nodeValue.length):n.rw_getRefPt(s,0);var o=new C(i,0,s,e.length);return null!=a&&null!=o?{frame:a,range:o}:null}}return null}}class k{constructor(e){this.no_scroll=e}rw_scrollToObject(e){var t=new _,n=!1;if(!this.no_scroll)try{var r=t.getWindow(e);if(null==r||null==e||null==e.parentNode)return;var i=0,a=0,o=e;3==o.nodeType&&(o=o.parentNode);for(var s,l,h,u,d=null,g=o,c=o.ownerDocument.body,f=null;null!=g&&g!=c;)"div"!=g.tagName.toLowerCase()&&"form"!=g.tagName.toLowerCase()||this.rw_isDivScrollable(g)&&(!0,d=this.rw_scrollToObjectDivCheck(o,g,d),f=g,o=g),g=g.parentNode;for(null!=f&&(o=f);null!=o;)i+=o.offsetLeft,a+=o.offsetTop,o=o.offsetParent;null!=d&&(a+=d.y,i+=d.x);var m,p,v=30;if(3==e.nodeType&&(v=10+5*e.nodeValue.length)>60&&(v=60),s=this.rw_getScreenOffsetLeft(r),l=this.rw_getScreenOffsetTop(r),"number"==typeof r.innerWidth?(h=r.innerWidth,u=r.innerHeight):r.document.documentElement.clientHeight>0&&r.document.documentElement.clientWidth>0?(h=r.document.documentElement.clientWidth,u=r.document.documentElement.clientHeight):(h=r.document.body.clientWidth,u=r.document.body.clientHeight),h-=v,u-=20,p=a<l||a>l+u,(m=i<s||i>s+h)||p&&(0!=i||0!=a)){i>s+h&&(i=(i+s)/2),a>l+u&&(a=(a+l)/2);n&&(n=!1),r.scrollTo(m?i:s,p?a:l);!1}}catch(e){}}rw_getScreenOffsetLeft(e){return void 0===e&&(e=window),e.pageXOffset&&e.pageXOffset>0?e.pageXOffset:e.document.body.scrollLeft&&e.document.body.scrollLeft>0?e.document.body.scrollLeft:e.document.documentElement.scrollLeft&&e.document.documentElement.scrollLeft>0?e.document.documentElement.scrollLeft:0}rw_getScreenOffsetTop(e){return void 0===e&&(e=window),e.pageYOffset&&e.pageYOffset>0?e.pageYOffset:e.document.body.scrollTop&&e.document.body.scrollTop>0?e.document.body.scrollTop:e.document.documentElement.scrollTop&&e.document.documentElement.scrollTop>0?e.document.documentElement.scrollTop:0}rw_getScreenOffsetLeftAlt(e){return void 0===e&&(e=window),"CSS1Compat"==e.document.compatMode&&e.document.body.parentNode&&e.document.body.parentNode.scrollLeft?e.document.body.parentNode.scrollLeft:e.pageXOffset?e.pageXOffset:e.scrollX?e.scrollX:e.document.body.scrollLeft?e.document.body.scrollLeft:e.document.documentElement.scrollLeft?e.document.documentElement.scrollLeft:0}rw_scrollToObjectDivCheck(e,t,n){for(var r=t.clientHeight,i=t.clientWidth,a=e.getBoundingClientRect().right-e.getBoundingClientRect().left,o=0,s=0,l=e;l!=t&&null!=l;)o+=l.offsetTop,s+=l.offsetLeft,l=this.rw_safeOffsetParent(l,t);return null==l&&(s-=t.offsetLeft,o-=t.offsetTop),null!=n&&(o+=n.y,s+=n.x),(t.scrollTop>o||t.scrollTop+r<o)&&(r>6*e.offsetHeight?t.scrollTop=o-e.offsetHeight:t.scrollTop=o),a<200&&(t.scrollLeft>s||t.scrollLeft+i<s+e.offsetWidth)&&(t.scrollLeft=s),{x:s-t.scrollLeft,y:o-t.scrollTop}}rw_safeOffsetParent(e,t){var n=e,r=n.offsetParent;if(null==r)return null;if(null==t)return r;for(;null!=n&&n!=r;){if(n==t)return null;n=n.parentNode}return r}rw_isDivScrollable(e){var t=new _,n=e.clientHeight,r=e.clientWidth,i=t.getComputedStyle(e),a=!1;return null!=i&&"visible"!=i.overflow&&"inline"!=i.display&&(e.scrollHeight>n&&"visible"!=i.overflowY&&(a=!0),e.scrollWidth>r&&"visible"!=i.overflowX&&(a=!0)),a}}class R{constructor(){this.node=null,this.offset=0}}class P{constructor(){this.style=null,this.fg=null,this.bg=null,this.lastSpanId=0}}class M{constructor(){this.count=1,this.list=[]}pushToList(e){this.list.push(e)}getList(){return this.list}}class I{constructor(){}isTokenType(e){return"entity"==e||"char"==e||"entities"==e||"chars"==e}looper(e,t,n){if(null!=e){var r=e.spanID?e.spanID:e.CHTMLnodeID;if(null!=(r=null!=r&&null!=r?r:e.PHTMLspanID)&&r==t)return n.pushToList(e),++n.count,!0;if(null!=e.data)for(var i=0;i<e.data.length;i++){var a=this.looper(e.data[i],t,n);if(a)return a}}return!1}getList(e,t){var n=new M;return this.looper(e,t,n),n.getList()}}class F{constructor(e){this.highlightDataStore={},this.highlightJaxRoot=e.root,this.highlightClearLast=!0,this.elementHelper=new I}setClearLastHighlight(e){this.highlightClearLast=e}setHighlightStyle(e,t,n){if("string"!=typeof e)return!1;if(this.highlightDataStore[e]&&this.highlightDataStore.hasOwnProperty(e)){var r=this.highlightDataStore[e];r&&r.lastSpanId>0&&this.clearHighlightNodesImpl(e,r.style,r.lastSpanId)}return null===t?(delete this.highlightDataStore[e],!0):"string"==typeof t&&(""===(t=t.toLowerCase())||"none"===t?(delete this.highlightDataStore[e],!0):(this.highlightDataStore[e]&&this.highlightDataStore.hasOwnProperty(e)?"highlight"!==(i=this.highlightDataStore[e]).style&&(i.fg=null,i.bg=null):i=new P,"fg"===t?(i.style="highlight",i.fg=n):"bg"===t?(i.style="highlight",i.bg=n):("outline"===t||"underline"===t)&&(i.style=t,i.fg=n,i.bg=null),this.highlightDataStore[e]=i,!0));var i}highlightNodes(e,t){var n;if(this.highlightDataStore[e]&&this.highlightDataStore.hasOwnProperty(e)&&null!==(n=this.highlightDataStore[e]).style){n.lastSpanId>0&&this.highlightClearLast&&this.clearHighlightNodesImpl(e,n.style,n.lastSpanId),n.lastSpanId=t;var r=this.elementHelper.getList(this.highlightJaxRoot,t);this.highlightImpl(r,e,n.style,n.fg,n.bg)}}clearHighlights(){for(var e in this.highlightDataStore)if(this.highlightDataStore.hasOwnProperty(e)){var t=this.highlightDataStore[e];this.clearHighlightNodesImpl(e,"",t.lastSpanId),t.lastSpanId=0}}clearHighlightNodes(e,t){this.clearHighlightNodesImpl(e,"",t)}parseColor(e){var t;if("string"==typeof e)t=parseInt(e,10);else{if("number"!=typeof e)throw"invalid";t=e}if(t<0||t>255)throw"invalid";return t}clearHighlightNodesImpl(e,t,n){for(var r=this.elementHelper.getList(this.highlightJaxRoot,n),i=0,a=r.length;i<a;i++){var o=r[i];if(""!==t&&"outline"!==t||delete o.mathoutline,""===t||"underline"===t)if(o.previousline){this.removeFromPrevious(o.previousline,e);var s=o.previousline.length;o.mathunderline=s>0?o.previousline[s-1].val:""}else o.mathunderline="";if(""===t||"highlight"===t){if(o.previouscolor){this.removeFromPrevious(o.previouscolor,e);s=o.previouscolor.length;o.mathcolor=s>0?o.previouscolor[s-1].val:""}else o.mathcolor=" ";delete o.mathbackground}var l=null;try{l=o.HTMLspanElement()}catch(e){}if(null==l)try{l=o.CHTMLnodeElement()}catch(e){}if(null==l)return;var h=!0;if(null!=o.HTMLremoveColor&&(h=this.setupPostFix(l,e,!0)),h)try{o.HTMLhandleColor(l)}catch(e){o.PHTMLhandleColor(l)}this.setdownPostFix(l);h=!0;if(null!=o.HTMLremoveColor&&(h=this.setupPostFix(l,e,!1)),h)if(null!=o.HTMLremoveColor)o.HTMLremoveColor();else{try{u=o.HTMLspanElement()}catch(e){u=o.CHTMLnodeElement()}null!=u&&(u.style.background="",u.style.color="")}if(this.setdownPostFix(l),null!=o.HTMLremoveColor){var u;try{u=o.HTMLspanElement()}catch(e){u=o.CHTMLnodeElement()}null!=u&&(u.style.background="",u.style.color="")}}}highlightImpl(e,t,n,r,i){for(var a=0,o=e.length;a<o;a++){var s=e[a];if("function"==typeof(s.HTMLhandleColor?s.HTMLhandleColor:s.CHTMLhandleColor)){var l=null;try{l=s.CHTMLnodeElement()}catch(e){}if(null==l)try{l=s.HTMLspanElement()}catch(e){}if(null==l)return;if("highlight"===n){if(null!=i&&(s.mathbackground=i),null!=r){if(s.previouscolor)this.removeFromPrevious(s.previouscolor,t);else if(s.previouscolor=[],s.mathcolor)s.previouscolor.push({key:"",val:s.mathcolor});else(new _).getComputedStyle(l).color;s.previouscolor.push({key:t,val:r}),s.mathcolor=r}}else"outline"===n?s.mathoutline=r+"thin solid":"underline"===n&&(s.previousline?this.removeFromPrevious(s.previousline,t):(s.previousline=[],s.textDecoration&&s.previousline.push({key:"",val:s.textDecoration})),s.previousline.push({key:t,val:"underline"}),s.mathunderline="underline");if(this.setupPostFix(l,t,!0))try{s.HTMLhandleColor(l)}catch(e){s.PHTMLhandleColor(l)}this.setdownPostFix(l)}}}removeFromPrevious(e,t){for(var n=0;n<e.length;n++)if(e[n].key===t)return void e.splice(n,1)}setupPostFix(e,t,n){try{var r=e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]?e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]:e.ownerDocument.defaultView.MathJax.OutputJax.CommonHTML,i="-"+t;if(n){var a=e.id+r.idPostfix+i;if(null!=document.getElementById(a))return!1}"string"==typeof r.idPostfix?(this.m_strTmpPostFix=r.idPostfix,r.idPostfix+=i):(this.m_strTmpPostFix="",r.idPostfix=i)}catch(e){return!1}return!0}setdownPostFix(e){try{var t=e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]?e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]:e.ownerDocument.defaultView.MathJax.OutputJax.CommonHTML;""==this.m_strTmpPostFix&&(t.idPostfix=null,delete t.idPostfix),null!=this.m_strTmpPostFix&&(t.idPostfix=this.m_strTmpPostFix,this.m_strTmpPostFix=null)}catch(e){}}}class L{constructor(e,t){this.highlightSettings=t,this.m_setupHash={},this.m_defaultContextBg={r:255,g:255,b:0},this.m_defaultContextFg={r:0,g:0,b:0},this.m_defaultWordBg={r:0,g:0,b:255},this.m_defaultWordFg={r:255,g:255,b:255},this.m_contextBg={r:255,g:255,b:0},this.m_contextFg={r:0,g:0,b:0},this.m_wordBg={r:0,g:0,b:255},this.m_wordFg={r:255,g:255,b:255},this.m_strContextStyle="highlight",this.m_strWordStyle="highlight",this.sentence=e,this.lastMathId=null}cssToObj(e){for(var t={},n=e.toLowerCase().replace(/-(.)/g,(function(e,t){return t.toUpperCase()})).replace(/;\s?$/g,"").split(/:|;/g),r=0;r<n.length;r+=2)t[n[r].replace(/\s/g,"")]=n[r+1].replace(/^\s+|\s+$/g,"");return t}setupHighlighter(e){try{e=e;this.h=new F(e);var t=this.cssToObj(this.highlightSettings.speechRangeColour),n=this.cssToObj(this.highlightSettings.speechWordColour);"highlight"===this.m_strContextStyle?(this.h.setHighlightStyle("context","bg",t.background),this.h.setHighlightStyle("context","fg",t.color)):"outline"===this.m_strContextStyle?this.h.setHighlightStyle("context","outline",t.color):"underline"===this.m_strContextStyle&&this.h.setHighlightStyle("context","underline",t.color),"highlight"===this.m_strWordStyle?(this.h.setHighlightStyle("word","bg",n.background),this.h.setHighlightStyle("word","fg",n.color)):"outline"===this.m_strWordStyle?this.h.setHighlightStyle("word","outline",n.color):"underline"===this.m_strWordStyle&&this.h.setHighlightStyle("word","underline",n.color)}catch(e){console.log(e)}}highlightRange(e,t){var n,r="context";null!=t&&(r=t),n=null!=e?e:this.sentence.getSpanId();try{this.lastMathId&&this.clearHighlights(),this.lastMathId=n;var i=this.sentence.m_range.body.ownerDocument.getElementById(n),a=this.getJaxFor(i),o=a.root.spanID?a.root.spanID:a.root.CHTMLnodeID;o=null!=o&&null!=o?o:a.root.PHTMLspanID,this.m_setupHash[n]||(this.setupHighlighter(a),this.m_setupHash[n]=!0),this.h.highlightNodes(r,o,a)}catch(e){}}unHighlightRange(e){null!=e||this.sentence.getSpanId();try{if(7==this.sentence.getWord(0).m_type){let e=this.sentence.getContents()[0];6==e.m_type&&null!=e.m_strPronunciation&&e.unhighlight("highlight")}}catch(e){console.logE(e)}}highlightWord(e){var t=e.getMathParentElementId(),n=e.getSpanId(),r=e.getJaxId();try{var i=e.m_range.body.ownerDocument.getElementById(n),a=this.getJaxFor(i);this.m_setupHash[t]||(this.setupHighlighter(a),this.m_setupHash[t]=!0),this.h.highlightNodes("word",r,a)}catch(e){console.log(e)}}setHighlightStyle(e,t,n,r){if(this.m_setupHash=[],"string"==typeof e){void 0===t&&(t="word");var i="undefined"==typeof p_rgb;"context"===t?(this.m_strContextStyle=e,"highlight"===e?(this.m_contextBg=i?this.m_defaultContextBg:r,this.m_contextFg=i?this.m_defaultContextFg:n):"outline"!==e&&"underline"!==e||(this.m_contextFg=i?this.m_defaultContextBg:n)):"word"===t&&(this.m_strWordStyle=e,"highlight"===this.m_strWordStyle?(this.m_wordBg=i?this.m_defaultWordBg:r,this.m_wordFg=i?this.m_defaultWordFg:n):"outline"!==e&&"underline"!==e||(this.m_wordFg=i?this.m_defaultWordBg:n))}}getJaxFor(e){return e.ownerDocument.defaultView.MathJax.Hub.getJaxFor(e)}checkText(e){for(var t=e.indexOf("<mtext>");t>-1&&(n=e.indexOf("</mtext>",t))>t;)t=0==e.substring(t+7,n).trimTH().length?(e=e.substr(0,t)+e.substr(n+8)).indexOf("<mtext>",t):e.indexOf("<mtext>",n+8);for(t=e.indexOf("<mn>");t>-1&&(n=e.indexOf("</mn>",t))>t;)t=0==e.substring(t+4,n).trimTH().length?(e=e.substr(0,t)+e.substr(n+5)).indexOf("<mn>",t):e.indexOf("<mn>",n+5);var n;for(t=e.indexOf("<mover>");t>-1&&(n=e.indexOf("</mover>",t))>t;)t=0==e.substring(t+7,n).trimTH().length?(e=e.substr(0,t)+e.substr(n+8)).indexOf("<mover>",t):e.indexOf("<mover>",n+8);return e}}class H{constructor(e,t){this.highlightSettings=t,this.sentence=e,this.mathJaxHighlighter=new L(e,t)}highlightRange(){}unHighlightRange(){}rw_setNodeBackground(e,t,n,r,i){var a=new _,l=new s,h=new S,u=new R;if(u.node=e,u.offset=t,3!=e.nodeType){if(1==e.nodeType&&a.isSpecialCaseHighlightable(e)){if("math"==e.tagName.toLowerCase()){var g=e.parentNode;u=this.rw_setNodeBackgroundImpl(g,e,t,n,r,"")}else if(e.isMathJax){g=e.parentNode;u=this.rw_setNodeBackgroundImpl(g,e,t,n,r,"")}else{var c=h.getFirstChildTextNode(e,!1),f=h.getLastChildTextNode(e,!1);null!=c&&3==c.nodeType&&null!=f&&3==f.nodeType&&(this.rw_setSpeechRangeImpl(c,0,f,f.nodeValue.length,r),u.node=c,u.offset=0)}return u}return u}if(3==e.nodeType){var m=e.nodeValue,p=new o;if(0==(m=p.trim(m)).length){var v=e.parentNode;if(null!=v){var w=p.trim(v.tagName).toLowerCase();if("tr"==w||"table"==w)return u}}}var b=null;if((g=e.parentNode).tagName.toLowerCase()==d&&(b=l.rw_getAttribute(g,"rwstate")),"spell"==r){if(null!=b&&""!=b)return u;u=this.rw_setNodeBackgroundImpl(g,e,t,n,r,i)}else if("hom"==r){if(null!=b&&""!=b)return u;u=this.rw_setNodeBackgroundImpl(g,e,t,n,r,i)}else if("grammar"==r){if(null!=b&&""!=b)return u;u=this.rw_setNodeBackgroundImpl(g,e,t,n,r,i)}else if("ss"==r){if(null!=b&&""!=b)return u;u=this.rw_setNodeBackgroundImpl(g,e,t,n,r,i)}else if("sp"==r){if("csp"==b)return u;if("sp"==b)return u;u=this.rw_setNodeBackgroundImpl(g,e,t,n,r,"")}else if("csp"==r){if("csp"==b)return u;"sp"==b&&(u=this.rw_setNodeBackgroundImpl(g,e,t,n,r,""))}return u}rw_setNodeBackgroundImpl(e,t,n,r,i,a){new _;var o,l=new s,h="sp"===i||"csp"===i,u="";if(1==t.nodeType&&(u=t.tagName.toLowerCase()),3==t.nodeType&&(-1==r||r>n)||"math"==u||t.isMathJax)if(o="ss"==i?"strikethrough"==a?"text-decoration:line-through":"background:"+a:"sp"==i?this.highlightSettings.speechRangeColour:"csp"==i?this.highlightSettings.speechWordColour:"spell"==i||"hom"==i||"grammar"==i?"":"color:#ff000; background:#00ff00","math"==u||t.isMathJax){if(h){new L(this.sentence,this.highlightSettings).highlightRange(t.id)}}else{var g,c=t.nodeValue.length;if(1==c&&("\n"==t.nodeValue||"\r"==t.nodeValue)||2==c&&"\r\n"==t.nodeValue)return(g=new R).node=t,g.offset=n<0?0:n,g;var f=e.ownerDocument,m=!1;-1==n&&-1==r?m=!0:-1==r&&(r=c),0==n&&r>=c&&(m=!0);var p=f.createElement(d);if("spell"==i&&(l.rw_setAttribute(p,"spellnum",a),p.className="thspell"),"grammar"==i){l.rw_setAttribute(p,"grammarnum",a),p.className="thgrammar"}if(m)p.setAttribute("style",o),l.rw_setAttribute(p,"rwstate",i),h&&l.rw_setAttribute(p,"started","1"),e.replaceChild(p,t),p.appendChild(t);else{var v,S,w,b=t.nodeValue;"span"==e.tagName.toLowerCase()&&null!=l.rw_getAttribute(e,"pron")?(v="",S=b,w=""):(v=b.substring(0,n),S=b.substring(n,r),w=b.substring(r)),p.setAttribute("style",o),l.rw_setAttribute(p,"rwstate",i),h&&l.rw_setAttribute(p,"started","1");var y,T=null,x=null;v.length>0&&(T=f.createTextNode(v)),y=f.createTextNode(S),w.length>0&&(x=f.createTextNode(w)),p.appendChild(y),e.replaceChild(p,t),null!=T&&e.insertBefore(T,p),null!=x&&(null==p.nextSibling?e.insertBefore(x,null):e.insertBefore(x,p.nextSibling)),t=y}}return(g=new R).node=t,g.offset=n<0?0:n,g}rw_highlightMathJaxElement(e,t){new L(this.sentence,this.highlightSettings).highlightRange(e.m_strSpanId,t)}rw_unHHighlightMathJaxElement(e){new L(this.sentence,this.highlightSettings).unHighlightRange(e.id)}rw_highlightMathElement(e,t,n,r){new _;var i=new s;if(null!=e)for(var a=e.firstChild;null!=a;)1==a.nodeType&&(r?null!=i.rw_getAttribute(a,"started")?(a.setAttribute("style",n),i.rw_setAttribute(a,"rwstate",t)):null==i.rw_getAttribute(a,"style")&&(a.setAttribute("style",n),i.rw_setAttribute(a,"rwstate",t),i.rw_setAttribute(a,"started","1")):null!=i.rw_getAttribute(a,"started")&&(a.removeAttribute("style"),i.rw_removeAttribute(a,"started"),i.rw_removeAttribute(a,"rwstate"))),a=a.nextSibling}getListOfHighlightableNodes(e,t){new _;var n=new S,r=new Array;try{var i=e.node,a=t.node;if(3!=i.nodeType)if(1==i.nodeType&&"math"==i.tagName.toLowerCase()){if(r.push(i),i==a)return r;i=n.getNextTextNode(i,!1,a)}else if(1==i.nodeType&&i.isMathJax){if(r.push(i),i==a)return r;i=n.getNextTextNode(i,!1,a)}else if(null==(i=n.getFirstChildTextNode(i,!1)))return r;if(i==a){if(3==i.nodeType)(s=i.nodeValue).length>0&&e.offset<s.length&&t.offset>0&&t.offset>e.offset&&r.push(i)}else{if(3==i.nodeType)(s=i.nodeValue).length>0&&e.offset<s.length&&r.push(i);else(1==i.nodeType&&"math"==i.tagName.toLowerCase()||1==i.nodeType&&i.isMathJax)&&r.push(i);for(var o=n.getNextTextNodeNoImg(i,!1,a,!0);null!=o;){if(o==a){var s;if(3==a.nodeType)(s=a.nodeValue).length>0&&t.offset>0&&r.push(a);else(1==o.nodeType&&"math"==o.tagName.toLowerCase()||1==o.nodeType&&o.isMathJax)&&r.push(o);break}r.push(o),o=n.getNextTextNodeNoImg(o,!1,a,!0)}}}catch(e){console.log("getListOfHighlightableNodes error:"+e.message)}return r}}class O extends H{constructor(e,t){super(e,t),this.sentence=e,this.highlightSettings=t,this.contextStyleObject=this.cssToObj(this.highlightSettings.speechRangeColour),this.wordStyleObject=this.cssToObj(this.highlightSettings.speechWordColour)}cssToObj(e){for(var t={},n=e.toLowerCase().replace(/-(.)/g,(function(e,t){return t.toUpperCase()})).replace(/;\s?$/g,"").split(/:|;/g),r=0;r<n.length;r+=2)t[n[r].replace(/\s/g,"")]=n[r+1].replace(/^\s+|\s+$/g,"");return t}highlightRange(){if(this.sentence.isMathML()){let e=this.sentence.getContents()[0];6==e.m_type&&(e.highlight(this.contextStyleObject.background,this.contextStyleObject.color,"context",!0),r.a.publish("analytics",{event:"SpeechUtils",action:"mathml"}))}else{var e=this.sentence.getRange();new _;try{if(null!=e){var t=new N(e.body,e.startRef.path,e.startRef.offset,e.endRef.path,e.endRef.offset),n=t.leftCaret,i=t.rightCaret;null!=n&&null!=i&&this.rw_setSpeechRangeImpl(n.node,n.offset,i.node,i.offset,"sp")}}catch(e){}}}unHighlightRange(){if(this.sentence.isMathML()){let e=this.sentence.getContents()[0];6==e.m_type&&(e.unhighlight("context"),e.unhighlight("word"))}else{var e=this.sentence.getRange();new _;try{if(null!=e){var t=new N(e.body,e.startRef.path,e.startRef.offset,e.endRef.path,e.endRef.offset),n=t.leftCaret,r=t.rightCaret;null!=n&&null!=r&&this.rw_removeSpeechHighlight(this.getListOfHighlightableNodes(n,r),!1)}}catch(e){}}}highlightWord(e){if(e<this.sentence.getAllWords().length){var t=this.sentence.getWord(e);if(7==t.m_type){let n=this.sentence.getContents()[0];if(6==n.m_type&&null!=n.m_strPronunciation)n.highlight(this.wordStyleObject.background,this.wordStyleObject.color,"word",!1),r.a.publish("analytics",{event:"SpeechUtils",action:"Aria math role label"});else{if(e-1>-1){this.sentence.getWord(e-1).unhighlight("word")}t.highlight(this.wordStyleObject.background,this.wordStyleObject.color,"word")}}else{new _;if(e>0){var n=this.sentence.getWordRange(e-1);if(null!=n){var i=(s=new N(n.body,n.startRef.path,n.startRef.offset,n.endRef.path,n.endRef.offset)).leftCaret,a=s.rightCaret;null!=i&&null!=a&&this.rw_removeSpeechHighlight(this.getListOfHighlightableNodes(i,a),!0)}}var o=this.sentence.getWordRange(e);if(null!=o){var s;i=(s=new N(o.body,o.startRef.path,o.startRef.offset,o.endRef.path,o.endRef.offset)).leftCaret,a=s.rightCaret;if(null!=i&&null!=a){var h=new k(l.no_scroll),u=this.rw_setSpeechRangeImpl(i.node,i.offset,a.node,a.offset,"csp");null!=u&&null!=u.node?h.rw_scrollToObject(u.node):h.rw_scrollToObject(i.node)}}}}}rw_removeSpeechHighlight(e,t){var n=new _;try{if(void 0===t&&(t=!1),null==e||!(e instanceof Array)||0==e.length)return;for(var r=0;r<e.length;r++){var i=e[r];if(this.rw_checkNodeIsSpeechText(i,t)){var a=i.parentNode;if(null!=i.nextSibling||null!=i.previousSibling){var o=n.allTextFromNodeTH(a);i=a.ownerDocument.createTextNode(o)}a.parentNode.replaceChild(i,a),i=n.mergeTextNodes(i),e[r]=i,this.rw_checkNodeIsSpeechText(i,t)&&--r}else{var s="";1==i.nodeType&&(s=i.tagName.toLowerCase()),"math"==s&&this.rw_highlightMathElement(i,null,null,!1),i.isMathJax&&this.rw_unHHighlightMathJaxElement(i)}}}catch(e){}}rw_checkNodeIsSpeechText(e,t){new _;var n=new s;if(3!=e.nodeType||null==e.parentNode||null==e.parentNode.parentNode)return!1;var r=e.parentNode,i=n.rw_getAttribute(r,"rwstate");return r.tagName.toLowerCase()==d&&null!=i&&(!t&&"sp"==i||"csp"==i)}rw_setSpeechRangeImpl(e,t,n,r,i){new _;var a=new S,o=null;try{if(n==e)return o=this.rw_setNodeBackground(e,t,r,i,"");o=t>0?this.rw_setNodeBackground(e,t,e.nodeValue.length,i,""):this.rw_setNodeBackground(e,-1,-1,i,"");for(var s=a.getNextTextNodeNoImg(o.node,!1,n,!0);null!=s;){if(s==n){s=(o=this.rw_setNodeBackground(s,0,r,i,"")).node;break}s=(o=this.rw_setNodeBackground(s,-1,-1,i,"")).node,s=a.getNextTextNodeNoImg(s,!1,n,!0)}}catch(e){console.log("rw_setSpeechRangeImpl error:"+e.message)}return o}}class D{constructor(e,t){this.highlightController=new O(e,t)}highlightRange(){this.highlightController.highlightRange()}unHighlightRange(){this.highlightController.unHighlightRange()}highlightWord(e){this.highlightController.highlightWord(e)}}class B{constructor(e){this.m_range=null,this.m_type=e,this.m_bValid=!0,this.m_contents=null,this.Types={WORD:1,SENTENCE:2,SSML:3,DOCUMENT:4,SILENCE:5,MATHML:6,MATHWORD:7}}getRange(){return this.m_range}setRange(e){e instanceof w&&(this.m_range=e)}getType(){return this.m_type}isValid(){return this.m_bValid}setValid(e){this.m_bValid=e}getContents(){return null==this.m_contents&&(this.m_contents=[]),this.m_contents}setContents(e){this.m_contents=e instanceof Array?e:[e]}addContent(e){null==this.m_contents&&(this.m_contents=[]),this.m_contents.push(e)}isOverridingText(){return!1}getWordCount(){if(this.m_type==this.Types.WORD||this.isOverridingText())return 1;var e=0;if(null==this.m_contents&&(this.m_contents=[]),this.m_contents.length>0){var t,n=this.m_contents.length;for(t=0;t<n;t++)e+=this.m_contents[t].getWordCount()}return e}getWords(){if(this.m_type==this.Types.WORD||this.isOverridingText())return[this];var e=[];if(null==this.m_contents&&(this.m_contents=[]),this.m_contents.length>0){var t,n=this.m_contents.length;for(t=0;t<n;t++)e=e.concat(this.m_contents[t].getWords())}return e}getFirstNode(){var e=new _,t=this.getRange();if(null!=t){var n=e.rw_getCaretFromRefPt(t.body,t.startRef);if(null!=n&&null!=n.node)return n.node}return null}getSpokenText(){return""}}class V{constructor(e){var t=e.getCaretRange(),n=new _;this.sentenceObject=e,this.leftNode=t.leftCaret.node,this.rightNode=t.rightCaret.node,this.body=n.getBody(this.leftNode),this.leftOffset=t.leftCaret.offset,this.rightOffset=t.rightCaret.offset,this.currentNode=this.leftNode,this.storedText="",this.startRefPt=null,this.endRefPt=null}}class W extends B{constructor(e,t){super(1),this.setRange(e),this.m_strWord=t,this.m_strPronunciation=null}getWord(){return this.getSpokenText()}setPronunciation(e){this.m_strPronunciation=e}getPronunciation(){return this.m_strPronunciation}isOverridingText(){return null!=this.m_strPronunciation}getSpokenText(){return null!=this.m_strPronunciation?this.m_strPronunciation:this.m_strWord}}class j extends B{constructor(e,t,n,r,i,a,o,s){super(7),this.setRange(o),this.mathParentElementId=e,this.htmlElem=t,this.spanID=n,this.jaxID=r,this.m_strWord=a,this.mathML=i,this.m_strPronunciation=null,this.jaxItems=s}getMathParentElementId(){return this.mathParentElementId}setMathParentElementId(e){this.mathParentElementId=e}getSpanId(){return this.spanID}setSpanId(e){this.spanID=e}getJaxId(){return this.jaxID}setJaxId(e){this.jaxID=e}getWord(){return this.m_strWord}setPronunciation(e){this.m_strPronunciation=e}getPronunciation(){return this.m_strPronunciation}isOverridingText(){return null!=this.m_strPronunciation}getSpokenText(){return null!=this.m_strPronunciation?this.m_strPronunciation:this.m_strWord}unhighlight(e){if(this.jaxItems.previouscolor){this.removeFromPrevious(this.jaxItems.previouscolor,e);var t=this.jaxItems.previouscolor.length;this.jaxItems.mathcolor=t>0?this.jaxItems.previouscolor[t-1].val:""}else this.jaxItems.mathcolor=" ";delete this.jaxItems.mathbackground;var n=!0;if(null!=this.jaxItems.HTMLremoveColor&&(n=this.setupPostFix(this.htmlElem,e,!0)),n)try{this.jaxItems.HTMLhandleColor(this.htmlElem)}catch(e){this.jaxItems.PHTMLhandleColor(this.htmlElem)}this.setdownPostFix(this.htmlElem);var r;n=!0;(null!=this.jaxItems.HTMLremoveColor&&(n=this.setupPostFix(this.htmlElem,e,!1)),n)&&(null!=this.jaxItems.HTMLremoveColor?this.jaxItems.HTMLremoveColor():null!=(r=this.htmlElem)&&(r.style.background="",r.style.color=""));(this.setdownPostFix(this.htmlElem),null!=this.jaxItems.HTMLremoveColor)&&(null!=(r=this.htmlElem)&&(r.style.background="",r.style.color=""))}highlight(e,t,n){if("function"==typeof(this.jaxItems.HTMLhandleColor?this.jaxItems.HTMLhandleColor:this.jaxItems.CHTMLhandleColor)){if(null==this.htmlElem)return;if(null!=e&&(this.jaxItems.mathbackground=e),null!=t){if(this.jaxItems.previouscolor)this.removeFromPrevious(this.jaxItems.previouscolor,n);else if(this.jaxItems.previouscolor=[],this.jaxItems.mathcolor)this.jaxItems.previouscolor.push({key:"",val:this.jaxItems.mathcolor});else{(new _).getComputedStyle(this.htmlElem).color}this.jaxItems.previouscolor.push({key:n,val:t}),this.jaxItems.mathcolor=t}if(this.setupPostFix(this.htmlElem,n,!0))try{this.jaxItems.HTMLhandleColor(this.htmlElem)}catch(e){this.jaxItems.PHTMLhandleColor(this.htmlElem)}this.setdownPostFix(this.htmlElem)}}setupPostFix(e,t,n){try{var r=e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]?e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]:e.ownerDocument.defaultView.MathJax.OutputJax.CommonHTML,i="-"+t;if(n){var a=e.id+r.idPostfix+i;if(null!=e.ownerDocument.getElementById(a))return!1}"string"==typeof r.idPostfix?(this.m_strTmpPostFix=r.idPostfix,r.idPostfix+=i):(this.m_strTmpPostFix="",r.idPostfix=i)}catch(e){return!1}return!0}setdownPostFix(e){try{var t=e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]?e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]:e.ownerDocument.defaultView.MathJax.OutputJax.CommonHTML;""==this.m_strTmpPostFix&&(t.idPostfix=null,delete t.idPostfix),null!=this.m_strTmpPostFix&&(t.idPostfix=this.m_strTmpPostFix,this.m_strTmpPostFix=null)}catch(e){}}removeFromPrevious(e,t){for(let n=0;n<e.length;n++)if(e[n].key===t)return void e.splice(n,1)}}class G extends B{constructor(e,t,n,r,i,a,o,s,l){super(6),this.setRange(e),this.m_strSpanId=i,this.m_strRawText=t,this.m_strMarkedText=n,this.m_strMathML=r,this.m_strPronunciation=o,this.mathArrayObjects=a,this.jaxElem=s,this.htmlElem=l,this.jaxSpanid=this.jaxElem.spanID?this.jaxElem.spanID:this.jaxElem.CHTMLnodeID,this.elementHelper=new I,this.list=this.elementHelper.getList(this.jaxElem,this.jaxSpanid),this.splitMathIntoWords()}getSpokenText(){let e;return e=null!=this.m_strPronunciation?this.m_strPronunciation:this.m_strMarkedText,e}getMathML(){return this.m_strMathML}setPronunciation(e){this.m_strPronunciation=e}getPronunciation(){return this.m_strPronunciation}isOverridingText(){return null!=this.m_strPronunciation}getMarkedText(){let e;return e=null!=this.m_strPronunciation?this.m_strPronunciation:this.m_strMarkedText,e}getWord(){return this.getSpokenText()}splitMathIntoWords(){if(null!=this.mathArrayObjects){let e=this.mathArrayObjects;for(let t=0;t<e.length;t++)if(this.m_strMarkedText.toLowerCase().search('<mark name="'+e[t].jaxSpanid,"g")>-1){let n=this.m_strMarkedText.toLowerCase().search('<mark name="'+e[t].jaxSpanid,"g")+12,r=this.m_strMarkedText.toLowerCase().indexOf("<mark name=",n),i=this.m_strMarkedText.substring(n,r);i=i.replace(e[t].jaxSpanid+'"/>',""),i=i.replace('<say-as interpret-as="spell">',""),i=i.replace("</say-as>","");let a=e[t].htmlElem,o=new _,s=o.rw_getRefPt(a,0),l=o.rw_getRefPt(a,0),h=new j(this.m_strSpanId,a,"MathJax-Span-"+e[t].jaxSpanid,e[t].jaxSpanid,e[t].span,i,new w(a.ownerDocument.body,s,l),e[t].data);this.addContent(h)}}}unhighlight(e){for(let a=0,o=this.list.length;a<o;a++){let o=this.list[a];if(o.previouscolor){this.removeFromPrevious(o.previouscolor,e);var t=o.previouscolor.length;o.mathcolor=t>0?o.previouscolor[t-1].val:""}else o.mathcolor=" ";delete o.mathbackground;var n=null;try{n=o.HTMLspanElement()}catch(e){}if(null==n)try{n=o.CHTMLnodeElement()}catch(e){}if(null==n)return;var r=!0;if(null!=o.HTMLremoveColor&&(r=this.setupPostFix(n,e,!0)),r)try{o.HTMLhandleColor(n)}catch(e){o.PHTMLhandleColor(n)}this.setdownPostFix(n);r=!0;if(null!=o.HTMLremoveColor&&(r=this.setupPostFix(n,e,!1)),r)if(null!=o.HTMLremoveColor)o.HTMLremoveColor();else{try{i=o.HTMLspanElement()}catch(e){i=o.CHTMLnodeElement()}null!=i&&(i.style.background="",i.style.color="")}if(this.setdownPostFix(n),null!=o.HTMLremoveColor){var i;try{i=o.HTMLspanElement()}catch(e){i=o.CHTMLnodeElement()}null!=i&&(i.style.background="",i.style.color="")}}for(let t=0,n=this.getContents().length;t<n;t++)this.getContents()[t].unhighlight(e);var a=this.htmlElem.ownerDocument.getElementById("currently-highlighting-speech-"+e);null!=a&&this.htmlElem.ownerDocument.head.removeChild(a)}highlight(e,t,n,r){for(let o=0,s=this.list.length;o<s;o++){let s=this.list[o];if("function"==typeof(s.HTMLhandleColor?s.HTMLhandleColor:s.CHTMLhandleColor)){var i=null;try{i=s.CHTMLnodeElement()}catch(e){}if(null==i)try{i=s.HTMLspanElement()}catch(e){}if(null==i)return;if(null!=e&&(s.mathbackground=e),null!=t){if(s.previouscolor)this.removeFromPrevious(s.previouscolor,n);else if(s.previouscolor=[],s.mathcolor)s.previouscolor.push({key:"",val:s.mathcolor});else{(new _).getComputedStyle(i).color}s.previouscolor.push({key:n,val:t}),s.mathcolor=t}if(this.setupPostFix(i,n,!0))try{s.HTMLhandleColor(i)}catch(e){s.PHTMLhandleColor(i)}if(!r){var a=this.htmlElem.ownerDocument.createElement("style");a.type="text/css",a.id="currently-highlighting-speech-"+n,a.innerHTML="#"+this.htmlElem.id+" * {color: "+t+";}",this.htmlElem.ownerDocument.head.appendChild(a)}this.setdownPostFix(i)}}}setupPostFix(e,t,n){try{var r=e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]?e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]:e.ownerDocument.defaultView.MathJax.OutputJax.CommonHTML,i="-"+t;if(n){var a=e.id+r.idPostfix+i;if(null!=e.ownerDocument.getElementById(a))return!1}"string"==typeof r.idPostfix?(this.m_strTmpPostFix=r.idPostfix,r.idPostfix+=i):(this.m_strTmpPostFix="",r.idPostfix=i)}catch(e){return console.logE(e),!1}return!0}setdownPostFix(e){try{var t=e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]?e.ownerDocument.defaultView.MathJax.OutputJax["HTML-CSS"]:e.ownerDocument.defaultView.MathJax.OutputJax.CommonHTML;""==this.m_strTmpPostFix&&(t.idPostfix=null,delete t.idPostfix),null!=this.m_strTmpPostFix&&(t.idPostfix=this.m_strTmpPostFix,this.m_strTmpPostFix=null)}catch(e){}}removeFromPrevious(e,t){for(let n=0;n<e.length;n++)if(e[n].key===t)return void e.splice(n,1)}}class J extends B{constructor(){super(3),this.m_strSsmlType=null,this.m_strAttrText=null,this.m_node=null}getSsmlType(){return this.m_strSsmlType}setSsmlType(e){this.m_strSsmlType=e}getAttr(){return this.m_strAttrText}setAttr(e){this.m_strAttrText=e}getSSMLOpeningTag(e){return'<?xml version="1.0"?>\n            <speak version="1.1" xmlns="http://www.w3.org/2001/10/synthesis"\n                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n                   xsi:schemaLocation="http://www.w3.org/2001/10/synthesis\n                             http://www.w3.org/TR/speech-synthesis11/synthesis.xsd"\n                   xml:lang="'+e+'">'}getSSMLClosingTag(){return"</speak>"}getOpeningTag(){return"<"+this.getSsmlType()+" "+this.getAttr()+">"}getClosingTag(){return"</"+this.getSsmlType()+">"}getTextFromContents(){if(null==this.m_contents)return"";let e,t="",n=this.m_contents.length;for(e=0;e<n;e++)t+=this.m_contents[e].getSpokenText();return t}getTextFromContentsNoTags(){if(null==this.m_contents)return"";let e,t="",n=this.m_contents.length;for(e=0;e<n;e++)this.m_contents[e].getType()==this.Types.WORD?t+=this.m_contents[e].getSpokenText():t+=this.m_contents[e].getTextFromContentsNoTags();return t}setNode(e){this.m_node=e;let t=new w;this.setRange(t.rw_getTHRangeFromElement(e))}getFirstNode(){return this.m_node}getWord(){return this.getSpokenText()}}class U extends J{constructor(e,t){super(),this.m_strAlias=t,this.setNode(e),this.setSsmlType("sub"),this.setAttr('alias="'+t+'" ')}isOverridingText(){return!0}getSpokenText(){return" "+this.m_strAlias+" "}canContainContent(){return!1}}class q extends J{constructor(e,t,n){super(),this.setNode(e),this.setSsmlType("phoneme"),this.setAttr('alphabet="'+t+'" ph="'+n+'"')}isOverridingText(){return!0}getSpokenText(){return this.getOpeningTag()+" "+this.getTextFromContentsNoTags()+" "+this.getClosingTag()}canContainContent(){return!0}}class z extends J{constructor(e,t,n){super(),this.setNode(e),this.setSsmlType("say-as"),"string"==typeof n?this.setAttr('interpret-as="'+t+'" format="'+n+'" '):this.setAttr('interpret-as="'+t+'" ')}isOverridingText(){return!0}getSpokenText(){return this.getOpeningTag()+this.getTextFromContents()+this.getClosingTag()}canContainContent(){return!0}}class X extends J{constructor(e,t){super(),this.setNode(e),this.setSsmlType("emphasis"),"string"==typeof t?this.setAttr('level="'+t+'" '):this.setAttr('level="moderate" ')}isOverridingText(){return!1}getSpokenText(){return this.getOpeningTag()+this.getTextFromContents()+" "+this.getClosingTag()}canContainContent(){return!0}}class $ extends J{constructor(e,t,n){let r;super(),a(this,"isOverridingText",(function(){return!0})),a(this,"getSpokenText",(function(){return"<break "+this.getAttr()+"/>"})),a(this,"canContainContent",(function(){return!1})),this.setNode(e),this.setSsmlType("break"),"string"==typeof t?(r=t.indexOf("ms")>-1?t.substr(0,t.indexOf("ms")):t.indexOf("s")>-1?t.substr(0,t.indexOf("s")):t,this.setAttr('time="'+t+'" ')):"string"==typeof n?(n=n.toLowerCase(),this.setAttr('strength="'+n+'" ')):this.setAttr('strength="medium" ')}}class Y extends J{constructor(e,t,n,r){super(),this.setNode(e),this.setSsmlType("prosody"),"string"==typeof t?this.setAttr('pitch="'+t+'" '):"string"==typeof n?this.setAttr('rate="'+n+'" '):"string"==typeof r&&this.setAttr('volume="'+r+'" ')}isOverridingText(){return!1}getSpokenText(){return this.getOpeningTag()+this.getTextFromContents()+this.getClosingTag()}canContainContent(){return!0}}class K extends B{constructor(e){super(2);new _;this.lang=null,this.SSML_NAMESPACE="ssml",this.SSMS_TYPES={SUB:"sub",PHONEME:"phoneme",SAYAS:"say-as",EMPHASIS:"emphasis",BREAK:"break",PROSODY:"prosody"},this.SSMS_ATTRIBUTES={ALPHABET:"alphabet",PH:"ph",ALIAS:"alias",INTERPRETAS:"interpret-as",FORMAT:"format",LEVEL:"level",STRENGTH:"strength",TIME:"time",PITCH:"pitch",RATE:"rate",VOLUME:"volume"},this.m_range=new C(e.leftCaret.node,e.leftCaret.offset,e.rightCaret.node,e.rightCaret.offset),this.m_caretRange=e,this.m_strRawText=e.getTextOverCaretRange(),this.setLangTagWithRange(e),this.math=!1,this.image=e.checkIfImage(),this.m_strMarkedText,this.jumpId,this.allowContinuous=!0}setVoice(e){this.m_strVoice=e}setLangTagWithRange(e){let t=e.rightCaret.node;for(;null!=t;){if(1==t.nodeType){let e=t.lang;if(null!=e&&e.length>0){this.lang=t.lang;break}}t=t.parentNode}}setLangTag(e){this.lang=e}getLangTag(){return this.lang}getVoice(){return this.m_strVoice}getSpanId(){return this.sentenceSpanId}setMathSymbolControl(e,t){this.mathSymbolControl=e,this.mathWithContext=t}setCaretRange(e){this.m_caretRange=e,this.m_range=new C(e.leftCaret.node,e.leftCaret.offset,e.rightCaret.node,e.rightCaret.offset)}getCaretRange(){return this.m_caretRange}getWords(){for(var e=new Array,t=this.getContents(),n=0;n<t.length;n++)e.push(t[n].getWord());return e}getAllWords(){var e=new Array,t=this.getContents();for(let n=0;n<t.length;n++)switch(t[n].m_type){case 6:let r=t[n].getContents();for(let t=0;t<r.length;t++)e.push(r[t]);break;case 1:e.push(t[n]);break;default:e.push(t[n])}return e}getWordRange(e){let t=this.getContents(),n=new Array;for(let e=0;e<t.length;e++)switch(t[e].m_type){case 6:let r=t[e].getContents();for(let e=0;e<r.length;e++)n.push(r[e]);break;case 1:n.push(t[e]);break;default:n.push(t[e])}return e<n.length?n[e].getRange():null}getWord(e){let t=this.getContents(),n=new Array;for(let e=0;e<t.length;e++)switch(t[e].m_type){case 6:let r=t[e].getContents();for(let e=0;e<r.length;e++)n.push(r[e]);break;case 1:n.push(t[e]);break;default:n.push(t[e])}return e<n.length?n[e]:null}isMathML(){return this.math}isImage(){return this.image}getRawText(){return this.m_strRawText}setRawText(e){this.m_strRawText=e}getMarkedText(){return this.m_strMarkedText}setMarkedText(e){this.m_strMarkedText=e}clone(){var e=new K(this.m_caretRange);return e.setContents(this.getContents()),e.setValid(this.isValid()),e.setLangTag(this.lang),e.setRawText(this.m_strRawText),e.setMarkedText(this.m_strMarkedText),e}processTextToSpeakInSentenceObject(e){this.processTextToSpeakInSentenceObjectImpl(e),l.strAnnounceLinksAsWords&&this.handleLinkToAnnounceAsWord(e);for(var t=this.getContents(),n=0;n<t.length;n++){var r=t[n];if(this.mathSymbolControl&&this.mathWithContext&&r.m_strWord){let e,i;null!=t[n-1]&&null!=t[n-1].m_strWord&&(e=t[n-1].m_strWord),null!=t[n+1]&&null!=t[n+1].m_strWord&&(i=t[n+1].m_strWord);let a=this.mathSymbolControl.mathsSymbolReplacementWithContext(r.m_strWord,e,i);a!=r.m_strWord&&r.setPronunciation(a)}var i=r.getFirstNode();null!=i&&this.isNestedSsml(i)&&this.insertInWrappingSsml(t,n,i)}}isNestedSsml(e){for(var t=e.ownerDocument.body,n=e;n!=t&&null!=n;){if(null!=this.checkForSsmlAttribute(n))return!0;n=n.parentNode}return!1}insertInWrappingSsml(e,t,n){let r=n.ownerDocument.body,i=n,a=new _;for(;i!=r&&null!=i;)if(i=i.parentNode,null!=this.checkForSsmlAttribute(i)){let n=this.checkForSsmlAttribute(i);if(n.canContainContent()){let r=e[t];e[t]=n,n.setContents([r]);for(let o=t+1;o<e.length;o++){let t=e[o].getFirstNode();if(!a.checkIfElementInsideElement(t,i))break;r=e[o],n.addContent(r),e.splice(o,1),o--}}else{e[t]=n;for(let n=t+1;n<e.length;n++){let t=e[n].getFirstNode();if(!a.checkIfElementInsideElement(t,i))break;e.splice(n,1),n--}}}return!1}processTextToSpeakInSentenceObjectImpl(e){var t=new _;try{var n=new V(e);for(this.setupCheck(n),n.startRefPt=t.rw_getRefPt(n.leftNode,n.leftOffset),n.endRefPt=null;null!=n.currentNode;){if(this.checkIfTooLong(n))return;var r=n.currentNode;r.isMathJax?this.handleMathJax(n):t.isSpecialCase(r)?this.handleSpecialCase(n):1==r.nodeType?this.handleElement(n):3==r.nodeType?this.handleTextNode(n):this.moveToNextNode(n)}}catch(e){this.setValid(!1)}}handleTextNode(e){var t=new _,n=new S,r=e.currentNode,i=n.getTextFromNode(r);null==i&&(i="");var a=0;if(e.rightNode==r&&e.rightOffset>-1&&(i=i.substring(0,e.rightOffset)),e.leftNode==r&&e.leftOffset>0&&(i=i.substring(e.leftOffset),a=e.leftOffset),0==i.length&&0==e.storedText.length)e.startRefPt=null;else{null!=e.startRefPt&&0!=e.storedText.length||(e.startRefPt=t.rw_getRefPt(r,a));for(var o=t.rw_getBreakInCurrentWord(i);o>-1;){var s=e.storedText+i.substring(0,o+1);if(e.storedText=this.filterWordToSpeak(s),null!=e.endRefPt&&0==o||(e.endRefPt=t.rw_getRefPt(r,o+a)),t.extractProbablePostcode(s)?this.moveStoredTextToSSMLPostCodeObject(e):t.extractProbablePhoneNumbers(s)?this.moveStoredTextToSSMLPhoneNumberObject(e):this.moveStoredTextToWordObject(e),this.checkIfTooLong(e))return void(e.currentNode=null);a+=o+1,i=i.substring(o+1),e.startRefPt=t.rw_getRefPt(r,a),e.endRefPt=null,o=t.rw_getBreakInCurrentWord(i)}if(i.length>0&&(e.storedText+=i,e.endRefPt=t.rw_getRefPt(r,i.length+a),null==e.endRefPt&&(e.storedText="")),r==e.rightNode)return this.moveStoredTextToWordObject(e),void(e.currentNode=null)}this.moveToNextNode(e)}filterWordToSpeak(e){var t=new _;return"*"==(new o).trim(e)&&(l.bMathsSymbols&&t.mathsSymbolCheck("*")||(e="")),e}handleElement(e){let t=e.currentNode,n=this.checkForSsmlAttribute(t);if(null!=n){this.moveStoredTextToWordObject(e);let s=new S;if(t.childNodes.length>0){var r=new i(t.firstChild,0,!0),a=new i(t.lastChild,3==t.lastChild.nodeType?t.lastChild.nodeValue.length:-1,!1);let s=new N;s.setCaretRange(r,a);var o=new K(s);this.processTextToSpeakInSentenceObjectImpl(o),o.isValid()&&(n.setContents(o.getContents()),e.sentenceObject.addContent(n))}else n instanceof $&&e.sentenceObject.addContent(n);e.currentNode=s.getNextNodeIgnoreChildren(t,!1,e.rightNode)}else this.moveToNextNode(e)}moveToNextNode(e){new _;var t=new S,n=e.currentNode,r=t.getNextNode(n,!0,e.rightNode);null==r?(e.storedText=this.getTextOverRangeToSpeakAddFullStop(e.storedText),this.moveStoredTextToWordObject(e),e.currentNode=t.getNextNode(n,!1,e.rightNode)):e.currentNode=r}getTextOverRangeToSpeakAddFullStop(e){var t=new _,n=e.length;if(n>1&&". "==e.substr(n-2,2))return e;if(n>0&&"."==e.substr(n-1,1))return e+" ";var r=(new o).trimEndTH(e),i=r.charCodeAt(r.length-1);return t.rw_isLetter(i)||i>127?e+". ":e}handleMathJax(e){var t=new _,n=new S,r=new u;let i=e.currentNode;e.rawText=r.getRawTextFromMathJax(i),e.markedText=r.getSpeechWithBookmarksFromElement(i),e.mathML=r.getMathMLText(i),e.mathArrayObjects=r.mathObjectArray,e.jaxElem=r.getMathMLObject(i);var a=n.getFirstChildTextNode(i,!1),o=n.getLastChildTextNode(i,!1);e.startRefPt=t.rw_getRefPt(a,-1),e.endRefPt=t.rw_getRefPt(o,-1),e.ariaLabel=null;var s=t.getAriaRoleMathWithLabel(i);null!=s&&(e.ariaLabel=s),this.moveStoredTextToMathMLObject(e),this.setRawText(e.rawText),e.currentNode=n.getNextNodeIgnoreChildren(i,!1,e.rightNode)}handleSpecialCase(e){var t=new _,n=new S;this.moveStoredTextToWordObject(e);var r=e.currentNode;if(e.storedText=n.getTextFromNode(r),t.isSpecialCaseHighlightable(r)){var i=n.getFirstChildTextNode(r,!1),a=n.getLastChildTextNode(r,!1);null!=i&&null!=a?3==i.nodeType&&3==a.nodeType?(e.startRefPt=t.rw_getRefPt(i,0),e.endRefPt=t.rw_getRefPt(a,a.nodeValue.length)):(e.startRefPt=t.rw_getRefPt(i,-1),e.endRefPt=t.rw_getRefPt(a,-1)):(e.startRefPt=t.rw_getRefPt(r,-1),e.endRefPt=e.startRefPt)}else e.startRefPt=t.rw_getRefPt(r,-1),e.endRefPt=e.startRefPt;this.moveStoredTextToWordObject(e),e.currentNode=n.getNextNodeIgnoreChildren(r,!1,e.rightNode)}checkForQuestionMark(e){if(e.indexOf("?")>-1)for(var t=e.indexOf("?");t>-1;){var n,r;n=(n=t-1)<0?0:n,r=(r=t+2)>e.length?e.length:r;var i=e.substring(n,r);"?"==(i=i.trim())&&(e=e.substr(0,t)+" "+e.substr(t+1)),t=e.indexOf("?",t+1)}return e}checkForEllipsis(e){var t=e.isOverridingText()?e.getPronunciation():e.getWord();if(1==(t=t.trim()).length&&"8230"==t.charCodeAt()){var n=new $(e.currentNode,616);n.setRange(e.m_range),e=n}return e}moveStoredTextToMathMLObject(e){if((new _).rw_isWordSpeakable(e.markedText)&&null!=e.startRefPt&&null!=e.endRefPt){var t=new G(new w(e.body,e.startRefPt,e.endRefPt),e.rawText,e.markedText,e.mathML,e.currentNode.id,e.mathArrayObjects,e.ariaLabel,e.jaxElem,e.currentNode);e.sentenceObject.addContent(t)}this.math=!0,this.clearState(e)}moveStoredTextToWordObject(e){if((new _).rw_isWordSpeakable(e.storedText)&&null!=e.startRefPt&&null!=e.endRefPt){var t;if(1==e.storedText.length&&(e.storedText.charCodeAt()>=65&&e.storedText.charCodeAt()<=90||e.storedText.charCodeAt()>=97&&e.storedText.charCodeAt()<=122)){t=new z(e.currentNode,"spell");var n=new W(new w(e.body,e.startRefPt,e.endRefPt),e.storedText);n.setPronunciation(e.storedText.toLowerCase()),t.addContent(n)}else t=new W(new w(e.body,e.startRefPt,e.endRefPt),e.storedText);this.mathSymbolControl&&this.mathSymbolControl.mathsSymbolCheck(e.storedText)&&t.setPronunciation(this.mathSymbolControl.mathsSymbolReplacement(e.storedText));var r=this.checkForQuestionMark(e.storedText);if(r!=e.storedText&&t.setPronunciation(r),t.m_type==t.Types.WORD){var i=this.checkForEllipsis(t);t!=i&&(t=i)}e.sentenceObject.addContent(t)}this.clearState(e)}moveStoredTextToSSMLPostCodeObject(e){if((new _).rw_isWordSpeakable(e.storedText)&&null!=e.startRefPt&&null!=e.endRefPt){var t=new W(new w(e.body,e.startRefPt,e.endRefPt),e.storedText),n=new z(e.currentNode,"zip");n.setRange(new w(e.body,e.startRefPt,e.endRefPt)),n.addContent(t),e.sentenceObject.addContent(n)}this.clearState(e)}moveStoredTextToSSMLPhoneNumberObject(e){if((new _).rw_isWordSpeakable(e.storedText)&&null!=e.startRefPt&&null!=e.endRefPt){var t=new W(new w(e.body,e.startRefPt,e.endRefPt),e.storedText),n=new z(e.currentNode,"phone");n.setRange(new w(e.body,e.startRefPt,e.endRefPt)),n.addContent(t),e.sentenceObject.addContent(n)}this.clearState(e)}clearState(e){e.startRefPt=null,e.endRefPt=null,e.storedText=""}checkIfTooLong(e){return e.sentenceObject.getWordCount()>500}setupCheck(e){var t=new _,n=new S;1==e.leftNode.nodeType&&(t.isSpecialCase(e.leftNode)||null!=this.checkForSsmlAttribute(e.leftNode)||(e.leftNode=n.getNextNodeAllowMoveToChild(e.currentNode,!1,e.rightNode),e.leftOffset=0))}checkForSsmlAttribute(e){if(1==e.nodeType){let t=this.checkForSsmlNoNamespace(e);if(null!=t)return t;if(t=this.checkForSsmlNamespace(e),null!=t)return t}return null}checkForSsmlNamespace(e){let t=e.ownerDocument.body.parentNode,n=new s;if(n.rw_getAttribute(t,"xmlns:ssml")){let r=n.rw_getAttribute(t,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.ALPHABET);if(n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.PH)){let t=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.ALPHABET),i=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.PH);if(null==t&&(t=r),null!=t&&null!=i)return new q(e,t,i)}if(n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.ALIAS)){let t=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.ALIAS);if(null!=t)return new U(e,t)}if(n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.INTERPRETAS)){let t=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.INTERPRETAS),r=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.FORMAT);if(null!=t)return new z(e,t,r)}if(n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_TYPES.EMPHASIS)){let t=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.LEVEL);if(null!=t)return new X(e,t)}if(n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_TYPES.BREAK)){let t=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.TIME),r=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.STRENGTH);if(null!=t)return new $(e,t,r)}if(n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_TYPES.PROSODY)){let t=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.PITCH),r=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.RATE),i=n.rw_getAttribute(e,this.SSML_NAMESPACE+":"+this.SSMS_ATTRIBUTES.VOLUME);if(null!=strTime)return new Y(e,t,r,i)}}return null}checkForSsmlNoNamespace(e){let t=new s;if(t.rw_getAttribute(e,this.SSML_NAMESPACE)){let n=t.rw_getAttribute(e,this.SSML_NAMESPACE);if(null!=n&&"sub"!=n.toLowerCase()){if(n.indexOf('ph":"')>0){let e=n.substring(n.indexOf('ph":"')+5);e=e.substring(0,e.indexOf('",')),n=n.replace(e,encodeURIComponent(e))}n=JSON.parse(n);let t=new Array;for(let e in n)t.push(e);for(let r=t.length-1;r>=0;r--){let i=t[r];if(i==this.SSMS_TYPES.PHONEME){let t="ipa";null!==n[i][this.SSMS_ATTRIBUTES.ALPHABET]&&(t=n[i][this.SSMS_ATTRIBUTES.ALPHABET]);let r=new o;return new q(e,t,r.encodeForXML(decodeURIComponent(n[i][this.SSMS_ATTRIBUTES.PH])))}if(i==this.SSMS_TYPES.SUB&&n[i][this.SSMS_ATTRIBUTES.ALIAS])return new U(e,n[i][this.SSMS_ATTRIBUTES.ALIAS]);if(i==this.SSMS_TYPES.SAYAS&&n[i][this.SSMS_ATTRIBUTES.INTERPRETAS])return new z(e,n[i][this.SSMS_ATTRIBUTES.INTERPRETAS],n[i][this.SSMS_ATTRIBUTES.FORMAT]);if(i==this.SSMS_TYPES.EMPHASIS)return new X(e,n[i][this.SSMS_ATTRIBUTES.LEVEL]);if(i==this.SSMS_TYPES.BREAK)return new $(e,n[i][this.SSMS_ATTRIBUTES.TIME],n[i][this.SSMS_ATTRIBUTES.STRENGTH]);if(i==this.SSMS_TYPES.PROSODY)return new Y(e,n[i][this.SSMS_ATTRIBUTES.PITCH],n[i][this.SSMS_ATTRIBUTES.RATE],n[i][this.SSMS_ATTRIBUTES.VOLUME])}}else if("sub"==n.toLowerCase()&&t.rw_getAttribute(e,this.SSMS_ATTRIBUTES.ALIAS))return new U(e,t.rw_getAttribute(e,this.SSMS_ATTRIBUTES.ALIAS));return null}}handleLinkToAnnounceAsWord(e){let t=e.getContents(),n=t.length,r=!1;for(let e=0;e<n;e++){let n=t[e];if(n.getType()==n.Types.WORD){let e=n.isOverridingText()?n.getPronunciation():n.getWord();"a"!=n.m_range.getAsRange().startContainer.parentNode.tagName.toLowerCase()||r||(n.setPronunciation(l.strAnnounceLinksAsWords+": "+e),r=!0)}}}}class Q extends B{constructor(){super(3),this.m_bBatch=!1,this.inlineImages=l.inlineImages,this.sentenceNo=0}setSentences(e){this.setContents(e)}setInlineImages(e){this.inlineImages=e}getSentences(){return this.getContents()}setBatch(e){this.m_bBatch=e}isBatch(){return this.m_bBatch}setMathSymbolControl(e,t){this.mathSymbolControl=e,this.mathWithContext=t}getNextSentence(e){this.sentenceNo++;var t=this.getSentences();if(this.sentenceNo<t.length)return 0==t[this.sentenceNo].getWords().length||t[this.sentenceNo].isImage()&&!this.inlineImages?this.getNextSentence(e):t[this.sentenceNo];if(e){var n=t[t.length-1];let s;if(n.allowContinuous){if(n.jumpId){let e=new E;this.processRange(e.getElementRangeById(n.jumpId),!1),s=this.getSentences()}else{var r=n.getCaretRange();n.m_range.refresh();var i=new N(n.m_range.body,n.m_range.startRef.path,n.m_range.startRef.offset,n.m_range.endRef.path,n.m_range.endRef.offset),a=new y,o=(r=a.getSentenceFromPoint(i.leftCaret),a.getNextSentence(r,null));s=this.processSentence(o)}return null==s||void 0===s||0==s.length?null:(this.setSentences(...s),this.sentenceNo=0,0==s[this.sentenceNo].getWords().length||s[this.sentenceNo].isImage()&&!this.inlineImages?this.getNextSentence(e):s[0])}}return null}getCurrentSentence(){var e=this.getSentences();return this.sentenceNo<e.length?e[this.sentenceNo]:e[e.length-1]}getFirstSentence(){return this.sentenceNo=0,this.getSentences().length>0?this.getSentences()[0]:null}processRange(e,t){this.setSentences([]),this.sentenceNo=0;var n=new N(e.body,e.startRef.path,e.startRef.offset,e.endRef.path,e.endRef.offset);if(!e.startCaret.node.tagName||"textarea"!=e.startCaret.node.tagName.toLowerCase()&&"input"!=e.startCaret.node.tagName.toLowerCase()){var r=new y,i=r.getSentenceFromPoint(n.leftCaret),a=new Array,o=this.processSentence(i);if(a.push(...o),!t){var s=!0;do{var l=r.getNextSentence(i,n.rightCaret.node);null!=l&&(l.leftCaret.node!=n.rightCaret.node||l.leftCaret.offset<n.rightCaret.offset)?(null!=(o=this.processSentence(l))&&a.push(...o),i=l):s=!1}while(s);1==a.length&&i.rightCaret.offset>n.rightCaret.offset&&n.rightCaret.offset!=n.leftCaret.offset&&(a=this.processSentence(n))}this.setSentences(a)}else{let t=new K(n);this.mathSymbolControl&&t.setMathSymbolControl(this.mathSymbolControl,this.mathWithContext);let r="";r=e.startCaret.node.selectionStart!=e.startCaret.node.selectionEnd?e.startCaret.node.value.substring(e.startCaret.node.selectionStart,e.startCaret.node.selectionEnd):e.startCaret.node.value;var h=new W(new w(e.body,e.startRef.offset,e.endRef.offset),r);t.setContents(h),t.m_strRawText=r,t.allowContinuous=!1,this.setSentences(t)}this.checkForCommands()}processSentence(e){try{this.checkRange(e)||this.setValid(!1),this.setSentences([]);var t=new K(e);this.mathSymbolControl&&t.setMathSymbolControl(this.mathSymbolControl,this.mathWithContext);var n=this.splitSentenceByLanguage(t);0==n.length&&this.setValid(!1),this.setSentences(n);for(var r=n.length,i=0;i<r;i++){let e=this.getSentences()[i];e.isMathML()||e.processTextToSpeakInSentenceObject(e)}return n}catch(e){this.setValid(!1)}return null}splitSentenceByLanguage(e){var t=e.getCaretRange(),n=t.leftCaret,r=t.rightCaret,i=!1;if(!l.voiceFromLangFlag)for(var a,o,s=n.node;null!=s;){if(1==s.nodeType){if(a=s.getAttribute("id"),null!=(o=s.getAttribute("class"))&&o.indexOf("contentTranslate")>-1){i=!0;break}if(null!=a&&a.length>0){if("rwpopuptrans"==a){i=!0;break}if(0!=a.indexOf("rwMeaning")&&0!=a.indexOf("rwHeadWord"))break}}s=s.parentNode}if(l.voiceFromLangFlag||i){var h=new S,u=h.getLangAttr(n.node);null!=u&&e.setLangTag(u);var d=h.checkForVoiceChange(n.node,r.node,u);if(null!=d){var g=d.clone();g.forwardBias=!0;var c=new _;g=c.moveCaret(g,0,!1);var f=new N;f.setCaretRange(n,d);var m=new N;m.setCaretRange(g,r);var p=new K(m);e.setCaretRange(f);var v=f.toString();if(0!=v.length&&c.rw_isWordSpeakable(v)){var w=[];return w.push(e),w=w.concat(this.splitSentenceByLanguage(p))}return this.splitSentenceByLanguage(p)}}return[e]}checkRange(e){var t=new _;if(null==e||null==e.leftCaret||null==e.rightCaret||null==e.leftCaret.node||null==e.rightCaret.node)return!1;var n=e.leftCaret,r=e.rightCaret,i=t.checkForSpecialParent(n.node);return null!=i&&(n.node=i,n.setSpecialCase(!0),e.leftCaret=n),null!=(i=t.checkForSpecialParent(r.node))&&(r.node=i,r.setSpecialCase(!0),e.rightCaret=r),!0}checkForCommands(){if(l.useCommands){var e,t,n=this.getSentences(),r=new _,i=new S;for(t=0;t<n.length;t++){var a=(e=n[t]).getCaretRange().leftCaret,o=e.getCaretRange().rightCaret,s=i.findCommandNode(a.node),h=i.checkForCommandChange(a.node,o.node,s);if(null!=h){var u=e.clone(),d=e.clone(),g=new N(a,h),c=h.clone();c.forwardBias=!0,c=r.moveCaret(c,0,!1);var f=new N(c,o);u.setCaretRange(g),d.setCaretRange(f),n.splice(t,1,u,d)}}this.setSentences(n)}}findCommandsInRange(e){var t=new _;let n=new S;for(var r=t.getListOfNodes(e.leftCaret,e.rightCaret),i=r.length,a=null,o=0;o<i;o++)if(null!=(a=n.findCommands(r[o]))&&a.length>0){for(var s=0;s<a.length;s++){var l=a[s],h=l.command;let t=l.element;t==r[o]||h!=l.CMD_JUMP&&h!=l.CMD_EXECAFTER&&h!=l.CMD_STOPAFTER?t==r[o]||h!=l.CMD_JUMPBACK&&h!=l.CMD_EXEC||0==this.checkIsFirstSentenceInCommandElement(t,e)&&(a.splice(s,1),s--):0==this.checkIsLastSentenceInCommandElement(t,e)&&(a.splice(s,1),s--)}return a}return[]}actOnCommand(e){if(l.useCommands&&e){var t=e.getCaretRange();if(null!=t){var n=this.findCommandsInRange(t);if(n.length>0){for(var i=!1,a=0;a<n.length;a++){var o=n[a];o.command==o.CMD_STOP?(i=!0,r.a.publish("speechStopped",[])):o.command==o.CMD_STOPAFTER?e.allowContinuous=!1:o.command==o.CMD_JUMP?e.jumpId=o.param:o.command==o.CMD_VOICE?r.a.publish("setTempVoice",o.param):o.command==o.CMD_PAGEID?r.a.publish("setPageID",o.param):o.command==o.CMD_BOOKID&&r.a.publish("setBookID",o.param)}i&&(e.valid=!1)}}}}checkIsFirstSentenceInCommandElement(e,t){return null==this.getPreviousSentence(t,e)}checkIsLastSentenceInCommandElement(e,t){return void 0===t&&(t=null),null==(new S).getNextNodeIgnoreChildren(t,!1,e)}}class Z extends A{constructor(){super(),this.event={},this.timerEvent=null,this.callback=null,this.caretRange=null,r.a.subscribe("pauseHover",this.clearTimer.bind(this)),document.addEventListener("mouseout",()=>this.clearTimer()),this.sentence,this.readRange=null,this.orgElement=null,this.targetElement=null}mouseMoved(e,t){clearTimeout(this.timerEvent),this.event=e,this.callback=t,this.timerEvent=setTimeout(()=>this.startSpeech(),1e3)}clearTimer(){clearTimeout(this.timerEvent)}clearHoverSpeak(){clearTimeout(this.timerEvent),this.sentence}startSpeech(){var e;if(this.targetElement=this.event.target,null!=this.targetElement&&("html"==this.targetElement.tagName.toLowerCase()||"body"==this.targetElement.tagName.toLowerCase()))return null;var t=new _;if(t.isIgnored(this.targetElement)||t.isAriaHidden(this.targetElement)&&!this.targetElement.parentNode.isMathJax)return null;if(null==this.targetElement||"img"!=this.targetElement.tagName.toLowerCase()&&"textarea"!=this.targetElement.tagName.toLowerCase()&&"input"!=this.targetElement.tagName.toLowerCase()){let t=this.targetElement.getRootNode();if(t.mode&&"open"==t.mode)e=new C(this.targetElement,0,this.targetElement,0);else if(void 0!==document.caretRangeFromPoint){var n=this.event.target.ownerDocument.caretRangeFromPoint(this.event.clientX,this.event.clientY);e=new C(n.startContainer,n.startOffset,n.endContainer,n.endOffset)}else if(void 0!==document.caretPositionFromPoint){n=this.event.target.ownerDocument.caretPositionFromPoint(this.event.clientX,this.event.clientY);e=new C(n.offsetNode,n.offset,n.offsetNode,n.offset)}else{if(this.orgElement=this.targetElement.cloneNode(!0),"TEXTHELP-WRAPPER-SPAN"!=this.targetElement.tagName&&"TEXTHELP-HIGHLIGHT-SPAN"!=this.targetElement.tagName)(new y).tagSentences(this.targetElement);var r=this.targetElement.ownerDocument.elementFromPoint(this.event.clientX,this.event.clientY);e=new C(r,0,r,0)}}else e=new C(this.targetElement,0,this.targetElement,0);var i=new Q;i.processRange(e,!0);var a=i.getFirstSentence(),o="",s="";this.sentence&&this.sentence.getRawText()&&(o=this.sentence.getRawText()),a.getRawText()&&(s=a.getRawText()),null!=this.sentence&&-1!=o.indexOf(s)||(this.sentence=a,this.readRange=e,this.callback())}getSelectionRange(){return this.readRange}clearHoverTags(){this.sentence=null}}class ee extends H{constructor(){super(),this.g_aTextRange=new Array,this.g_aHighlightColour=new Array}fetchWords(){for(var e=new Array,t=new Array,n=this.g_aTextRange.length,r=0;r<n;r++){-1==this.g_aTextRange[r].toString().trimTH().indexOf(" ")?t.push(this.g_aTextRange.slice(r,r+1).pop()):this.m_bSentenceSelection=!0}t.sort(this.sortBySFF);for(var i,a=t.length,o=0;o<a;o++){i=(i=t[o].toString()).trim();var s=".,?!";s=s.replace(/[\[\](){}?*+\^$\\.|\-]/g,"\\$&"),i=i.replace(new RegExp("^["+s+"]+|["+s+"]+$","g"),""),e.push(i)}return e}studySkillsCollateForColour(e){for(var t=new _,n=new Array,r=this.g_aTextRange.length,i=0;i<r;i++){this.g_aHighlightColour[i]==e&&n.push(this.g_aTextRange.slice(i,i+1).pop())}d?n.sort(this.sortBy):n.sort(this.sortBySFF);var a,s=n.length,l=new o,h=new Array;for(i=0;i<s;i++){var u,d=!1;if(d){var g=n.slice(i,i+1).pop();u=t.rw_getTextRangeAsTHRange(g.parentElement().ownerDocument.body,g).rw_getTHCaretRangeFromTHRange()}else u=n[i].rw_getTHCaretRangeFromTHDomRange();(a=u.getTextOverCaretRange()).length>0&&(a=l.rw_filterForHtml(a),h.push({color:e,text:a}))}return h}studySkillsCollateForColour(e){new _;for(var t=new Array,n=(new Array,[]),r=this.g_aTextRange.length,i=0;i<r;i++){var a=this.g_aHighlightColour[i];if(-1!=e.indexOf(a)){var s=this.g_aTextRange.slice(i,i+1).pop();s.color=a,t.push(s)}}t.sort(this.sortBySFF);var l,h=t.length,u=new o;for(i=0;i<h;i++){var d=t[i].color;(l=t[i].rw_getTHCaretRangeFromTHDomRange().getTextOverCaretRange()).length>0&&(l=u.rw_filterForHtml(l),n.push({text:l,color:d}))}return n}sortBy(e,t){try{return e.compareEndPoints("EndToEnd",t)}catch(e){return 0}}sortBySFF(e,t){try{if(e.equals(t))return 0;e.refresh(),t.refresh();var n=e.getEndAsRange(),r=t.getEndAsRange();return n.compareBoundaryPoints("END_TO_END",r)}catch(e){return 0}}studySkillsHTMLHighlightRange(e,t){var n=new _;try{if(null==t||null==t.range||t.range instanceof String)return!1;var r=t.range;if(null==(r=this.rw_checkTHRangeForValidHighlight(r)))return!1;n.rw_collapseSelection(),this.studySkillsHTMLHighlightRangeImpl(r,e);var i=SpeechStream.analytics;return i.report(i.categories.HIGHLIGHT,e),!0}catch(e){return!1}}studySkillsHTMLHighlightRangeImpl(e,t){try{var n=new _,r=!1,i=null,a=null,o=!0;if(null==e||e instanceof String)return;var s=0,l=!1;if(!e.toString)return;if(null==e||null==e.toString()||""==e.toString())return;for(var h=0;h<this.g_aTextRange.length;h++){var u=this.g_aTextRange[h];if(e.body.ownerDocument==u.body.ownerDocument){var d=e.compareRange(u);switch(d){case-1:window.status="Error occurred when trying to add a highlight.";break;case 0:case 3:u.refresh(),this.rw_removeHighlight(this.getListOfHighlightableNodes(u.startCaret,u.endCaret)),this.g_aTextRange.splice(h,1),this.g_aHighlightColour.splice(h,1),--h,e.refresh(),l=!0;break;case 4:case 7:case 8:this.g_aHighlightColour[h]==t?o=!1:(this.case1SFF(h,e,d),++h,l=!0);break;case 6:this.case2SFF(h,e),l=!0;break;case 5:this.case3SFF(h,e),l=!0}}l&&++s<100&&(h=-1)}if(o){if(e.execCommand)this.studySkillsClearRangeIE(e),this.rw_ieSpecificCallToSetHighlight(e,t);else{var g=e.startCaret,c=e.endCaret;this.rw_setHighlight(g.node,g.offset,c.node,c.offset,t)}this.g_aTextRange.push(e),e.toString(),this.g_aHighlightColour.push(t)}return n.rw_collapseSelection(),r&&(i.style.display=a),!0}catch(e){return!1}}rw_setHighlight(e,t,n,r,i){var a=e,o=n,s=(new _,new S);try{var l=null;if(n==e)a=(l=this.rw_setNodeBackground(e,t,r,"ss",i)).node,o=l.node;else{a=(l=t>0?this.rw_setNodeBackground(e,t,e.nodeValue.length,"ss",i):this.rw_setNodeBackground(e,-1,-1,"ss",i)).node;for(var h=s.getNextTextNodeNoImg(l.node,!1,n,!0);null!=h;){if(h==n){o=h=(l=this.rw_setNodeBackground(h,0,r,"ss",i)).node;break}o=h=(l=this.rw_setNodeBackground(h,-1,-1,"ss",i)).node,h=s.getNextTextNodeNoImg(h,!1,n,!0)}}}catch(e){}return{start:a,end:o}}rw_ieSpecificCallToSetHighlight(e,t){"strikethrough"==t?e.execCommand("strikethrough",!1,null):e.execCommand("backcolor",!1,t)}studySkillsClearRangeIE(e){e.execCommand("backcolor",!1,"clear"),(g_nIcons&strike_icon)==strike_icon&&e.execCommand("RemoveFormat",!1,null)}rw_removeHighlight(e){var t=new _,n=new s;try{if(null==e||!(e instanceof Array)||0==e.length)return;for(var r=0;r<e.length;r++){var i=e[r];if(this.rw_checkNodeIsHighlightedText(i)){var a=i.parentNode;if(null!=i.nextSibling||null!=i.previousSibling){var o=t.allTextFromNodeTH(a);i=a.ownerDocument.createTextNode(o)}a.parentNode.replaceChild(i,a),i=t.mergeTextNodes(i),e[r]=i}else{var l=this.rw_getNestedNodeForHighlightedText(i);null!=l&&(n.rw_removeAttribute(l,"rwstate"),l.removeAttribute("style"))}}}catch(e){}}rw_getNestedNodeForHighlightedText(e){new _;var t=new s;if(3!=e.nodeType||null==e.parentNode||null==e.parentNode.parentNode)return null;var n=d,r=e.parentNode,i=t.rw_getAttribute(r,"rwstate");if(r.tagName.toLowerCase()!=n||null==i||"ss"!=i){if(null!=t.rw_getAttribute(r,"rwthgen")){var a=r;for(i="1";null!=i;){if(a=a.parentNode,"ss"==t.rw_getAttribute(a,"rwState")&&a.tagName.toLowerCase()==n)return a;i=t.rw_getAttribute(a,"rwthgen")}}return null}return r}rw_checkNodeIsHighlightedText(e){new _;var t=new s;if(null==e.parentNode||null==e.parentNode.parentNode)return!1;var n=e.parentNode,r=t.rw_getAttribute(n,"rwstate");return n.tagName.toLowerCase()==d&&null!=r&&"csp"!=r&&"sp"!=r||("thspell"==n.className||"thhom"==n.className||"thgrammar"==n.className)}rw_checkTHRangeForValidHighlight(e){var t=new _,n=new S,r=e.startCaret,i=e.endCaret,a=!1;if(t.isInvalidNode(r.node)){if(r.node==i.node)return;if(null==(s=n.getNextTextNodeNoImg(r.node,!1,i.node,!1))||t.isInvalidNode(s))return;r.node=s,r.offset=0,a=!0}var o=3!=r.node.nodeType||3==r.node.nodeType&&0==r.node.nodeValue.trimTH().length;if(o){for(a=!0;o;){if(r.node==i.node)return null;if(r.node=n.getNextTextNodeNoBlank(r.node,!1,i.node),null==r.node)return null;o=3!=r.node.nodeType||3==r.node.nodeType&&0==r.node.nodeValue.trimTH().length}r.offset=0}if(t.isInvalidNode(i.node)){if(r.node==i.node)return;var s;if(null==(s=n.getPreviousTextNodeNoImg(i.node,!1,r.node,!1))||t.isInvalidNode(s))return;i.node=s,i.offset=s.nodeValue.length,a=!0}if(o=3!=i.node.nodeType||3==i.node.nodeType&&0==i.node.nodeValue.trimTH().length){for(a=!0;o;){if(r.node==i.node)return null;if(i.node=n.getPreviousTextNodeNoImg(i.node,!1,r.node,!1),null==i.node)return null;o=3!=i.node.nodeType||3==i.node.nodeType&&0==i.node.nodeValue.trimTH().length}3==i.node.nodeType&&(i.offset=i.node.nodeValue.length)}return null==r.node||null==i.node?null:(a&&(e=new C(r.node,r.offset,i.node,i.offset)),e)}//*!
studySkillsClearHighlights(e,t){try{var n=null;if(null!=t&&null!=t.range&&(n=t.range,t.frame),null!=n&&n instanceof String){var r=!1;if(null!=r&&(r.selectionStart=0,r.selectionEnd=0),r=null,!e)return;n=null}if(null==n||e){if(!e)if(!!1)return;var i=this.g_aTextRange;this.g_aTextRange=new Array,this.g_aHighlightColour=new Array;for(var a=new _,o=0;o<i.length;o++){var s;(s=i[o]).refresh(),this.rw_removeHighlight(this.getListOfHighlightableNodes(s.startCaret,s.endCaret))}}else{n.refresh();for(var l=0;l<this.g_aTextRange.length;l++){var h=this.g_aTextRange[l];if(n.body==h.body){var u=n.compareRange(h);switch(u){case-1:window.status="Error occurred when trying to remove a highlight.";break;case 0:case 3:h.refresh(),this.rw_removeHighlight(this.getListOfHighlightableNodes(h.startCaret,h.endCaret)),this.g_aTextRange.splice(l,1),this.g_aHighlightColour.splice(l,1),--l,n.refresh();break;case 4:case 7:case 8:this.case1SFF(l,n,u),++l;break;case 6:this.case2SFF(l,n);break;case 5:this.case3SFF(l,n)}}}}a.rw_collapseSelection()}catch(e){}}//*!
studySkillsHTMLRefreshRanges(){try{var e=null,t=!1,n=0;for(n=0;n<this.g_aTextRange.length;n++){e=this.g_aTextRange[n];try{null!=e.text&&""!=e.text||(e=null)}catch(t){e=null}null==e&&(this.g_aTextRange.splice(n,1),this.g_aHighlightColour.splice(n,1),t=!0,n--)}return t}catch(e){return!1}}case1SFF(e,t,n){new _;var r=this.g_aHighlightColour[e],i=this.g_aTextRange[e];i.refresh();var a,o,s,l,h=i.startRef,u=t.startRef,d=t.endRef,g=i.endRef;if(this.rw_removeHighlight(this.getListOfHighlightableNodes(i.startCaret,i.endCaret)),this.g_aTextRange.splice(e,1),this.g_aHighlightColour.splice(e,1),7!=n){var c=new N(t.body,h.path,h.offset,u.path,u.offset);a=c.leftCaret,o=c.rightCaret,s=this.rw_setHighlight(a.node,a.offset,o.node,o.offset,r),l=new C(s.start,0,s.end,s.end.nodeValue.length),this.g_aTextRange.push(l),this.g_aHighlightColour.push(r)}8!=n&&(a=(c=new N(t.body,d.path,d.offset,g.path,g.offset)).leftCaret,o=c.rightCaret,s=this.rw_setHighlight(a.node,a.offset,o.node,o.offset,r),l=new C(s.start,0,s.end,s.end.nodeValue.length),this.g_aTextRange.push(l),this.g_aHighlightColour.push(r)),t.refresh()}case2SFF(e,t){new _;var n=this.g_aHighlightColour[e],r=this.g_aTextRange[e];r.refresh();var i=t.endRef,a=r.endRef;this.rw_removeHighlight(this.getListOfHighlightableNodes(r.startCaret,r.endCaret)),this.g_aTextRange.splice(e,1),this.g_aHighlightColour.splice(e,1);var o=new N(t.body,i.path,i.offset,a.path,a.offset),s=o.leftCaret,l=o.rightCaret,h=this.rw_setHighlight(s.node,s.offset,l.node,l.offset,n),u=new C(h.start,0,h.end,h.end.nodeValue.length);this.g_aTextRange.push(u),this.g_aHighlightColour.push(n),t.refresh()}case3SFF(e,t){new _;var n=this.g_aHighlightColour[e],r=this.g_aTextRange[e];r.refresh();var i=r.startRef,a=t.startRef;this.rw_removeHighlight(this.getListOfHighlightableNodes(r.startCaret,r.endCaret)),this.g_aTextRange.splice(e,1),this.g_aHighlightColour.splice(e,1);var o=new N(t.body,i.path,i.offset,a.path,a.offset),s=o.leftCaret,l=o.rightCaret,h=this.rw_setHighlight(s.node,s.offset,l.node,l.offset,n),u=new C(h.start,0,h.end,h.end.nodeValue.length);this.g_aTextRange.push(u),this.g_aHighlightColour.push(n),t.refresh()}}class te{constructor(){this.curser=0,this.controlEdit=null,this.curser=0,this.currentChar=null,this.properties=["boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"]}setEditControl(e){this.controlEdit=e}isEditable(){return!1}getPositionOfPopup(){return{top:-100,left:-100}}}class ne{constructor(){this.properties=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],this.isBrowser="undefined"!=typeof window,this.isFirefox=this.isBrowser&&null!=window.mozInnerScreenX}getCaretCoordinates(e,t,n){if(!this.isBrowser)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var r=n&&n.debug||!1;if(r){var i=document.querySelector("#input-textarea-caret-position-mirror-div");i&&i.parentNode.removeChild(i)}var a=document.createElement("div");a.id="input-textarea-caret-position-mirror-div",document.body.appendChild(a);var o=a.style,s=window.getComputedStyle?getComputedStyle(e):e.currentStyle;o.whiteSpace="pre-wrap","INPUT"!==e.nodeName&&(o.wordWrap="break-word"),o.position="absolute",r||(o.visibility="hidden"),this.properties.forEach((function(e){o[e]=s[e]})),this.isFirefox?e.scrollHeight>parseInt(s.height)&&(o.overflowY="scroll"):o.overflowY="auto",a.textContent=e.value.substring(0,t),"INPUT"===e.nodeName&&(a.textContent=a.textContent.replace(/\s/g," "));var l=document.createElement("span");l.textContent=e.value.substring(t)||".",a.appendChild(l);var h={top:l.offsetTop+parseInt(s.borderTopWidth),left:l.offsetLeft+parseInt(s.borderLeftWidth)};return r?l.style.backgroundColor="#aaa":document.body.removeChild(a),h}}class re extends te{constructor(){super()}setEditControl(e){("TEXTAREA"==e.nodeName||"INPUT"==e.nodeName&&"text"==e.type.toLowerCase())&&(this.controlEdit=e,this.curser=e.selectionEnd,this.startSelection=e.selectionStart,this.currentChar=this.getCurrentCharacter(),e.setSelectionRange(this.startSelection,this.curser))}isEditable(){return void 0!==this.controlEdit&&(("TEXTAREA"==this.controlEdit.nodeName||"INPUT"==this.controlEdit.nodeName&&"text"==this.controlEdit.type.toLowerCase())&&this.curser==this.startSelection)}getSentence(){try{this.curser=this.controlEdit.selectionEnd,this.startSelection=this.controlEdit.selectionStart}catch(e){}var e,t="";if(window.getSelection&&(e=window.getSelection()).modify){this.controlEdit.focus(),this.controlEdit.setSelectionRange(this.startSelection,this.startSelection);var n=e.getRangeAt(0);32==this.currentChar.charCodeAt(0)||this.currentChar.charCodeAt(0),e.modify("extend","backward","sentenceboundary"),t=e.toString(),new RegExp("[.?!]").test(t.slice(-1))&&(t=t.slice(0,t.length-1)),e.removeAllRanges(),e.addRange(n)}else if((e=document.selection)&&"Control"!=e.type){var r=e.createRange();r.collapse(!0),r.expand("sentence"),t=r.text}return this.controlEdit.setSelectionRange(this.startSelection,this.curser),t}getPositionOfPopup(){var e=this.controlEdit;if(void 0===e)return{top:-100,left:-100};var t=getComputedStyle(e).getPropertyValue("font-size");if("TEXTAREA"==this.controlEdit.nodeName||"INPUT"==this.controlEdit.nodeName&&"text"==this.controlEdit.type.toLowerCase()){let r=(new ne).getCaretCoordinates(e,e.selectionEnd);this.curser=e.selectionEnd;var n={x:0,y:0};return this.GetOffset(e,n),{top:n.y-e.scrollTop+r.top+parseInt(t)+4+"px",left:n.x-e.scrollLeft+r.left+10+"px"}}return{top:-100,left:-100}}GetOffset(e,t){e&&(t.x+=e.offsetLeft,t.y+=e.offsetTop,this.GetOffset(e.offsetParent,t))}setSelectionRange(e,t,n){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,n);else if(e.createTextRange){var r=e.createTextRange();r.collapse(!0),r.moveEnd("character",n),r.moveStart("character",t),r.select()}else e.focus()}setCaretPosition(e,t){if(null!=e)if(e.createTextRange){var n=e.createTextRange();n.move("character",t),n.select()}else e.selectionStart?(e.focus(),e.setSelectionRange(t,t)):e.focus()}insertText(e){var t=this.controlEdit;if("DIV"==t.tagName){t.focus();var n=document.getElementById("rwPredictionPosition");this.setCaretPositionDiv(currentContextControlID),this.setSelectionRange(t,n.value,n.value),this.currentChar=this.getCurrentCharacter(),this.replaceSelectedText(e)}else this.CurrentPosition=t.selectionStart,this.setSelectionRange(t,this.CurrentPosition,this.CurrentPosition),this.currentChar=this.getCurrentCharacter(),this.setSelectionRange(t,this.CurrentPosition,this.CurrentPosition),this.replaceSelectedText(e),this.setSelectionRange(t,this.CurrentPosition,this.CurrentPosition),this.setCaretPosition(t,this.CurrentPosition);return!1}getCurrentCharacter(){var e,t="";if(window.getSelection&&(e=window.getSelection()).modify){var n=e.getRangeAt(0);e.modify("move","backward","character"),e.modify("extend","forward","character"),t=e.toString(),e.removeAllRanges(),e.addRange(n)}else if((e=document.selection)&&"Control"!=e.type){var r=e.createRange();r.collapse(!0),r.expand("word"),t=r.text}return t}replaceSelectedText(e){var t;e+=" ";var n=0;if(window.getSelection){l=window.getSelection();var r=document.activeElement;if("TEXTAREA"==r.nodeName||"INPUT"==r.nodeName&&"text"==r.type.toLowerCase()){if(this.curser>0)switch(this.currentChar.charCodeAt(0)){case 32:case 160:e=e;break;case 46:case 33:case 63:e=e.trim()+this.currentChar+" ",l.modify("move","backward","character"),l.modify("move","backward","character"),l.modify("extend","forward","character")," "==(i=l.toString())?(l.modify("move","forward","character"),l.modify("extend","forward","character")):(l.modify("move","backward","word"),l.modify("extend","forward","word"),l.modify("extend","forward","character"));break;case 10:e=e.trim()+" ";var i=l.toString();break;case 38:l.modify("move","backward","character"),l.modify("move","backward","character"),l.modify("extend","forward","character")," "==(i=l.toString())?(l.modify("move","forward","character"),l.modify("extend","forward","character")):(l.modify("move","backward","word"),l.modify("extend","forward","word"));break;case 45:l.modify("move","backward","word"),l.modify("extend","forward","word"),l.modify("extend","forward","word");break;default:if(l.modify("move","backward","word"),l.modify("move","backward","character"),l.modify("extend","forward","character"),"-"==(i=l.toString())?(l.modify("extend","backward","character"),l.modify("move","forward","character"),l.modify("move","backward","word"),l.modify("extend","forward","word"),l.modify("extend","forward","word")):32==i.charCodeAt(0)&&l.modify("move","forward","character"),l.modify("extend","forward","word"),"-"==(i=l.toString()).substr(i.length-1,1)&&l.modify("extend","forward","word"),i=l.toString(),-1!=navigator.appVersion.indexOf("Win")){" "==i.substr(i.length-1,1)&&(l.modify("extend","backward","character"),e=e.trim(),n++);(i=l.toString()).substr(i.length-1,1).match(/^[0-9a-zA-Z]+$/)||(l.modify("extend","backward","character"),e=e.trim(),n++)}}var a=r.value,o=r.selectionStart,s=r.selectionEnd;if(-1!=navigator.appVersion.indexOf("Win"));else switch(a.slice(s).substr(0,1)){case" ":e=e.trim(),n++;break;case";":case":":case"!":case".":e=e.trim(),n++,n++}r.value=a.slice(0,o)+e+a.slice(s),this.CurrentPosition=o+e.length+n}else{var l=window.getSelection();if(this.setCaretPositionDiv(r),32==this.currentChar.charCodeAt(0)||160==this.currentChar.charCodeAt(0));else l.modify("move","backward","word"),l.modify("move","backward","character"),l.modify("extend","forward","character"),"-"==(i=l.toString())?(l.modify("extend","backward","character"),l.modify("move","forward","character"),l.modify("move","backward","word"),l.modify("extend","forward","word"),l.modify("extend","forward","word")):32==i.charCodeAt(0)&&l.modify("move","forward","character"),l.modify("extend","forward","word");l.rangeCount?((t=l.getRangeAt(0)).deleteContents(),t.insertNode(document.createTextNode(e))):l.deleteFromDocument();a=r.value,o=r.selectionStart,s=r.selectionEnd;r.value=a.slice(0,o)+e+a.slice(s),setCaretPositionDiv(r,o+e.length)}}else document.selection&&document.selection.createRange&&((t=document.selection.createRange()).text=e)}getSelection(){var e,t=this.controlEdit;if(null!=document.selection)t.focus(),e=document.selection.createRange().text;else if(null!=t.selectionStart){var n=t.selectionStart,r=t.selectionEnd;e=t.value.substring(n,r)}return e}}class ie extends te{constructor(){super()}setEditControl(e){this.controlEdit=e,this.sel=window.getSelection(),this.curser=this.getCaretPosition(e),this.currentChar=this.getCurrentCharacter()}getCaretPosition(e){var t,n,r=0;if(window.getSelection)(t=window.getSelection()).rangeCount&&(n=t.getRangeAt(0)).commonAncestorContainer.parentNode==e&&(r=n.endOffset);else if(document.selection&&document.selection.createRange&&(n=document.selection.createRange()).parentElement()==e){var i=document.createElement("span");e.insertBefore(i,e.firstChild);var a=n.duplicate();a.moveToElementText(i),a.setEndPoint("EndToEnd",n),r=a.text.length}return r}isEditable(){return void 0!==this.controlEdit&&(void 0!==this.controlEdit.contentEditable&&("true"==this.controlEdit.contentEditable||1==this.controlEdit.contentEditable))}getSentence(){return this._getSentence().textBeforeSelection}_getSentence(){if(null==this.controlEdit)return{selectedText:"",textBeforeSelection:"",textAfterSelection:""};var e="",t="",n="",r=window.getSelection();e=r.getRangeAt(0).toString();var i=r.getRangeAt(0),a=this._getTextNodesInRange(i);if(1==a.length)e=a[0].textContent.substring(i.startOffset,i.endOffset);else if(a.length<1)e="";else if(2==a.length)e=a[0].textContent.substring(i.startOffset)+" ",e+=a[1].textContent.substring(0,i.endOffset);else{e=a[0].textContent.substring(i.startOffset)+" ";for(var o=1;o<a.length-1;o++)e+=a[o].textContent+" ";e+=a[a.length-1].textContent.substring(0,i.endOffset)}var s=null,l=0,h=r.anchorNode.compareDocumentPosition(r.focusNode);h&Node.DOCUMENT_POSITION_PRECEDING?(s=r.focusNode,l=r.focusOffset):0==h?(s=r.anchorNode,l=r.focusOffset,r.anchorOffset<r.focusOffset&&(l=r.anchorOffset)):(s=r.anchorNode,l=r.anchorOffset),t=s.textContent.substring(0,l),n=s.textContent.substring(l+e.length);for(var u=this._getPrevTextNode(s);null!==u;)t=u.textContent+t,u=this._getPrevTextNode(u);for(var d=this._getNextTextNode(s);null!==d;)n+=d.textContent,d=this._getNextTextNode(d);return{selectedText:e,textBeforeSelection:t,textAfterSelection:n}}_getNextTextNode(e){var t=e.nextSibling;return null!==t?t:null===e.parentNode||null===e.parentNode.nextSibling||3!==e.parentNode.nextSibling.nodeType?null:e.parentNode.nextSibling}_getPrevTextNode(e){var t=e.previousSibling;return null!==t?t:null===e.parentNode||null===e.parentNode.previousSibling||3!==e.parentNode.previousSibling.nodeType?null:e.parentNode.previousSibling}_getTextNodesInRange(e){var t,n=e.startContainer,r=e.endContainer,i=e.commonAncestorContainer,a=[];function o(e){if(e.firstChild)return e.firstChild;for(;e;){if(e.nextSibling)return e.nextSibling;e=e.parentNode}}for(t=n.parentNode;t&&(3===t.nodeType&&a.push(t),t!=i);t=t.parentNode);for(a.reverse(),t=n;t&&(3===t.nodeType&&a.push(t),t!=r);t=o(t));return a}getPositionOfPopup(){var e=this.controlEdit;return void 0===e?{top:-100,left:-100}:this.getCaretCoordinates(e,this.curser)}getCaretCoordinates(e,t){var n,r,i,a=!(null==window.mozInnerScreenX);(n=document.getElementById(e.nodeName+"--texthelp-mirror-div"))||((n=document.createElement("div")).id=e.nodeName+"--texthelp-mirror-div",document.body.appendChild(n)),i=n.style,r=getComputedStyle(e),i.whiteSpace="pre-wrap","INPUT"!==e.nodeName&&(i.wordWrap="break-word"),i.position="absolute",i.top=e.offsetTop+parseInt(r.borderTopWidth)+"px",i.left="400px",i.visibility="hidden",["boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"].forEach((function(e){i[e]=r[e]})),a?(i.width=parseInt(r.width)-2+"px",e.scrollHeight>parseInt(r.height)&&(i.overflowY="scroll")):i.overflow="hidden",n.textContent=e.value.substring(0,t),"INPUT"===e.nodeName&&(n.textContent=n.textContent.replace(/\s/g," "));var o=document.createElement("span");return o.textContent=e.value.substring(t)||".",o.style.backgroundColor="lightgrey",n.appendChild(o),{top:o.offsetTop+parseInt(r.borderTopWidth),left:o.offsetLeft+parseInt(r.borderLeftWidth),height:parseInt(r.fontSize.substr(r.fontSize,r.fontSize.length-2))}}setSelectionRange(e,t,n){"#text"!=e.nodeName&&(e=e.childNodes[0]);var r=document.createRange();r.setStart(e,t),r.setEnd(e,n);var i=window.getSelection();i.removeAllRanges(),i.addRange(r)}setCaretPosition(e,t){if(null!=e)if(e.createTextRange){var n=e.createTextRange();n.move("character",t),n.select()}else e.selectionStart?(e.focus(),e.setSelectionRange(t,t)):e.focus()}insertText(e){var t=this._getSentence();if(null!=t){if(null==this.controlEdit)return null;var n=t.textBeforeSelection.split(/\W+/);n=n[n.length-1].trim();var r=t.textAfterSelection.split(/\W+/)[0].trim(),i=window.getSelection().getRangeAt(0);n.length>0?(i.setStart(i.startContainer,i.startOffset-n.length),i.setEnd(i.endContainer,i.endOffset+r.length)):e+=" ",document.execCommand("insertText",!1,e)}}getCurrentCharacter(){return this.controlEdit.innerHTML.charAt(this.curser-1)}getSelection(){var e,t=this.controlEdit;if(null!=document.selection)t.focus(),e=document.selection.createRange().text;else if(null!=t.selectionStart){var n=t.selectionStart,r=t.selectionEnd;e=t.value.substring(n,r)}return e}}class ae{constructor(){this.predictionManager=null}getPredictionCoordinates(){return null!=this.predictionManager?this.predictionManager.getPositionOfPopup():{top:-1e3,left:-1e3}}getPredictionSentence(){return null!=this.predictionManager?this.predictionManager.getSentence():null}predictionInsertText(e){null!=this.predictionManager&&this.predictionManager.insertText(e)}setSelectionRange(e,t,n){this.onMouseDown({target:e}),null!=this.predictionManager&&this.predictionManager.setSelectionRange(e,t,n)}isEditable(){return null!=this.predictionManager&&this.predictionManager.isEditable()}onMouseDown(e){this.predictionFactory(e),null!=this.predictionManager&&this.predictionManager.setEditControl(e.target)}onKeyDown(e){this.predictionFactory(e),null!=this.predictionManager&&this.predictionManager.setEditControl(e.target)}predictionFactory(e){let t=e.target;"TEXTAREA"==t.nodeName||"INPUT"==t.nodeName&&"text"==t.type.toLowerCase()?this.predictionManager=new re:void 0===t.contentEditable||"true"!=t.contentEditable&&1!=t.contentEditable||(this.predictionManager=new ie)}}class oe{constructor(){this.speechRangeColour="colour:#rrggbb; background:#FFFF00",this.speechWordColour="color:#FFFFFF; background:#0000FF; padding: 2px; margin: -2px; border-radius: 4px; text-shadow: 0 3px 8px #2A2A2A;position:relative"}get speechRangeColour(){return this._speechRangeColour}set speechRangeColour(e){this._speechRangeColour=e}get speechWordColour(){return this._speechWordColour}set speechWordColour(e){this._speechWordColour=e}}class se extends A{constructor(){super(),this.timerEvent=null,this.callback=null,this.caretRange=null,this.sentence,this.readRange=null,this.orgElement=null,this.targetElement=null}clearTimer(){clearTimeout(this.timerEvent)}clearHoverSpeak(){clearTimeout(this.timerEvent),this.sentence}mouseClick(e,t){var n;if(this.targetElement=e.target,null!=this.targetElement&&("html"==this.targetElement.tagName.toLowerCase()||"body"==this.targetElement.tagName.toLowerCase()))return null;var r=new _;if(r.isIgnored(this.targetElement)||r.isAriaHidden(this.targetElement)&&!this.targetElement.parentNode.isMathJax)return null;if(null==this.targetElement||"img"!=this.targetElement.tagName.toLowerCase()&&"textarea"!=this.targetElement.tagName.toLowerCase()&&"input"!=this.targetElement.tagName.toLowerCase()){let t=e.target.getRootNode();if(t.mode&&"open"==t.mode)n=new C(this.targetElement,0,this.targetElement,0);else if(void 0!==document.caretRangeFromPoint){var i=e.target.ownerDocument.caretRangeFromPoint(e.clientX,e.clientY);n=new C(i.startContainer,i.startOffset,i.endContainer,i.endOffset)}else if(void 0!==document.caretPositionFromPoint){i=e.target.ownerDocument.caretPositionFromPoint(e.clientX,e.clientY);n=new C(i.offsetNode,i.offset,i.offsetNode,i.offset)}else{if(this.orgElement=this.targetElement.cloneNode(!0),"TEXTHELP-WRAPPER-SPAN"!=this.targetElement.tagName&&"TEXTHELP-HIGHLIGHT-SPAN"!=this.targetElement.tagName)(new y).tagSentences(this.targetElement);var a=this.targetElement.ownerDocument.elementFromPoint(e.clientX,e.clientY);n=new C(a,0,a,0)}}else n=new C(this.targetElement,0,this.targetElement,0);var o=new Q;o.processRange(n,!0);var s=o.getFirstSentence();this.sentence=s,this.readRange=n,t()}getSelectionRange(){return this.readRange}clearHoverTags(){this.sentence=null}}class le{constructor(){this.ignoreFrames=!0,l.styleHacks=!1,l.g_bPersistAnnotations=!0,this.g_bInlineImg=!1,this.g_bIgnoreButtons=!0}tagSentencesWithFramesImpl(e){if(void 0===e&&(e=window),e.document&&e.document.body&&this.tagSentencesImpl(e.document.body),!this.ignoreFrames&&e.frames.length>0){var t,n=e.frames.length;for(t=0;t<n;t++)try{var r=e.frames[t];r.frames.length>0?this.tagSentencesWithFramesImpl(r.frames):r.document&&r.document.body&&this.tagSentencesImpl(r.document.body)}catch(e){}}}tagSentencesImpl(e){let t=new _,n=new s,r=new S;"undefinded"!=typeof e&&null!=e||(e=document.body);try{for(var i=!1,a=e;null!=a;)if(3==a.nodeType){var o=a.parentNode.tagName.toLowerCase();if("textarea"==o){a=r.getNextNode(a,!1,null);continue}var h=a.nodeValue,u=h.trimSpaceTH(),d=u.length>0;if(l.styleHacks&&"a"==o&&(d=!1),d){if(!l.styleHacks&&(l.g_bPersistAnnotations||l.g_bSpeechCacheFlag&&l.g_bAlterBrowserForConsistency)){if(u.length<h.length){var g=!1;u=h.trimSpaceStartTH(),h.length-u.length>0&&(h=i?" "+u:u,g=!0),u=h.trimSpaceEndTH(),h.length-u.length>1&&(h=u+" ",i=!1,g=!0),g&&(a.nodeValue=h)}(u=h.replace(p," ")).length<h.length&&(h=u,g=!0)}//*!
var c;c=h.search("[\\x21\\x2E\\x3F\\x3A]");var f=null!=n.rw_getAttribute(a.parentNode,"texthelpSkip"),m=a;if(c>-1&&c<h.length-1){for(var v=!0;;){if(t.rw_isFullStop(h,c,a))break;var w=h.substring(c+1).search("[\\x21\\x2E\\x3F\\x3A]");if(!(w>-1)){v=!1;break}c=c+1+w}if(v){var b=h.substring(0,c+1),y=h.substring(c+1),T=t.createWrapperElement();n.rw_setAttribute(T,"rwTHpgen","1");var x=document.createTextNode(b),C=document.createTextNode(y);(N=a.parentNode).insertBefore(C,a),N.insertBefore(T,C),T.appendChild(x),N.removeChild(a),a=C,m=x}else{if(null!=a.previousSibling||null!=a.nextSibling||f){T=t.createWrapperElement();n.rw_setAttribute(T,"rwTHpgen","1");x=document.createTextNode(h);(N=a.parentNode).insertBefore(T,a),T.appendChild(x),N.removeChild(a),a=x}m=a,a=r.getNextNode(a,!1,null)}}else{if(null!=a.previousSibling||null!=a.nextSibling||f){T=t.createWrapperElement();n.rw_setAttribute(T,"rwTHpgen","1");var N;x=document.createTextNode(h);(N=a.parentNode).insertBefore(T,a),T.appendChild(x),N.removeChild(a),a=x}m=a,a=r.getNextNode(a,!1,null)}//!*
if(l.g_bPersistAnnotations||l.g_bSpeechCacheFlag&&l.g_bAlterBrowserForConsistency){var A=m.nodeValue,E=m.nodeValue.length;i=!(E>0&&32==A.charCodeAt(E-1))}//*!
}else if(l.g_bPersistAnnotations||l.g_bSpeechCacheFlag&&l.g_bAlterBrowserForConsistency)if(i)l.styleHacks||(a.nodeValue=" "),i=!1,a=r.getNextNode(a,!1,null);else{var k=a;a=r.getNextNode(a,!1,null),l.styleHacks||k.parentNode.removeChild(k)}else a=r.getNextNode(a,!1,null)}else if(1==a.nodeType){if(l.g_bPersistAnnotations&&t.isStyleNode(a)&&"img"==a.tagName.toLowerCase()&&(i=!0),this.g_bInlineImg&&"img"==a.tagName.toLowerCase()){var R=n.rw_getAttribute(a,"msg");null!=R&&R.length>0||(null!=(R=a.getAttribute("title"))&&R.length>0||null!=(R=a.getAttribute("alt"))&&R.length>0)&&n.rw_setAttribute(a,"msg",R)}var P=n.rw_getAttribute(a,"rwTHcomp"),M=n.rw_getAttribute(a,"rwDontAlter");a="pre"==a.tagName.toLowerCase()||"button"==a.tagName.toLowerCase()&&this.g_bIgnoreButtons||null!=P&&P.length>0||null!=M&&M.length>0?r.getNextNodeIgnoreChildren(a,!1,null):r.getNextNode(a,!1,null)}else a=r.getNextNode(a,!1,null);//!*
if(l.g_bPersistAnnotations)for(a=e;null!=a;)if(3==a.nodeType){if(d=a.nodeValue.trimTH().length>0){var I,F=a.parentNode,L=F.getAttribute("id");if(null==L||0==L.length)l.DynamicAnnotations?null!=(I=t.rw_getUniqueIdForTextNode(a))&&(F.id=I):(F.id="rwTHnoteMarker"+l.notesIdCounter,++l.notesIdCounter)}a=r.getNextNode(a,!1,null)}else if(1==a.nodeType){if(t.rw_checkIfCanHaveStickys(a)){var H=a.getAttribute("id");null!=H&&0!=H.length||(a.id="rwTHnoteMarker"+l.notesIdCounter,++l.notesIdCounter)}P=n.rw_getAttribute(a,"rwTHcomp"),M=n.rw_getAttribute(a,"rwDontAlter");a="pre"==a.tagName.toLowerCase()||"button"==a.tagName.toLowerCase()&&this.g_bIgnoreButtons||null!=P&&P.length>0||null!=M&&M.length>0?r.getNextNodeIgnoreChildren(a,!1,null):r.getNextNode(a,!1,null)}else a=r.getNextNode(a,!1,null);//*!
}catch(e){console.error("Error in $rw_tagSentences: "+e)}l.IELoadedFlag=!0}}class he extends ee{constructor(){super(),this.g_bStoreHighlightText=!0}rw_retrieveHighlightDataForPKTReplyImpl(e,t){var n=l.ignoreHidden;try{var r;"[e2020-nomatch]"==e?rw_setNotUsingAnnotations():l.g_bAnnotationGlobalCheck&&l.g_bAnnotationGlobalUnknown&&rw_setUsingAnnotations(),2==l.g_nHighlightNotSyncedState&&(r=l.g_strStoredHighlightUnprocessedData),l.g_strStoredHighlightUnprocessedData=null,l.g_elemStoredHighlightLimitArea=t,this.rw_restoreHighlights(e),l.g_strStoredHighlightData=e,2==l.g_nHighlightNotSyncedState&&(r!=l.g_strStoredHighlightUnprocessedData&&rw_storeHighlightData(),null==l.g_strStoredHighlightUnprocessedData?l.g_nHighlightNotSyncedState=0:l.g_nHighlightNotSyncedState=1)}catch(e){console.log(e.message)}"boolean"!=typeof eba_ignore_hidden||eba_ignore_hidden||(g_bIgnoreHidden=n)}rw_restoreHighlights(e){let t=new _;var n,r,i,a,o,s,h,u,d=!1;if(e.length>4){var g=e.substr(e.length-4);if("*"==g.charAt(0))parseInt(g.substr(g.length-3),10)>=188&&(d=!0)}for(var c=e.indexOf("|"),f=e.indexOf("|",c+1),m=e.indexOf("|",f+1),p=e.indexOf("|",m+1),v=e.indexOf("|",p+1),S=e.indexOf("|",v+1);c>-1&&f>-1&&m>-1&&p>-1&&v>-1&&S>-1;){u=!0,n=e.substring(c+1,f),r=e.substring(f+1,m),i=e.substring(m+1,p),o=e.substring(p+1,v),s=e.substring(v+1,S),a=parseInt(i,10),h=parseInt(s,10);var w,b,y=document.body,T=!1;if(r.length>3&&"idx"==r.substring(0,3))if(null==(w=t.rw_getElementById(r.substr(3))))u=!1;else if(null==l.g_elemStoredHighlightLimitArea||t.checkIfElementInsideElement(w,l.g_elemStoredHighlightLimitArea))y=w.ownerDocument.body,null==(b=this.rw_convertFromPermCaretPosition(w,a,d))?u=!1:(r=b.path,a=b.offset);else T=!0;if(o.length>3&&"idx"==o.substring(0,3))if(null==(w=t.rw_getElementById(o.substr(3))))u=!1;else if(null==l.g_elemStoredHighlightLimitArea||t.checkIfElementInsideElement(w,l.g_elemStoredHighlightLimitArea))y=w.ownerDocument.body,null==(b=this.rw_convertFromPermCaretPosition(w,h,d))?u=!1:(o=b.path,h=b.offset);else T=!0;if(u&&!T){var x=null;if(l.g_bIEOld)x=rw_getAsTextRange(y,r,a,o,h);else{var A=new N;A.getCaretPairFromDomPosition(y,r,a,o,h);var E=A.leftCaret,k=A.rightCaret;null!=E&&null!=k&&(x=new C(E.node,E.offset,k.node,k.offset))}null!=x?this.studySkillsHTMLHighlightRangeImpl(x,n):u=!1}u||(null==g_strStoredHighlightUnprocessedData&&(g_strStoredHighlightUnprocessedData=""),g_strStoredHighlightUnprocessedData+=e.substring(c,S)),c=S,f=e.indexOf("|",c+1),m=e.indexOf("|",f+1),p=e.indexOf("|",m+1),v=e.indexOf("|",p+1),S=e.indexOf("|",v+1)}}rw_convertFromPermCaretPosition(e,t,n){let r=new _,i=new S;var a=r.getPositionInDom(e),o=0;if(n&&null!=e.firstChild){var s=i.getFirstChildTextNode(e,!1);if(null==s)return null;if(3==s.nodeType)for(var l=s.nodeValue;l.length>o&&32==l.charCodeAt(o);)++o}return new b(a,t+o)}studySkillsHTMLHighlightRange(e){let t=new _;try{var n=t.rw_getSelection();if(null==n||null==n.range||n.range instanceof String)return!1;var r=n.range;if(l.g_bIEOld){var i=r.parentElement().ownerDocument.body,a=rw_getTextRangeAsTHRange(i,r);if(null==a)return!1;var o=new N;o.getCaretPairFromDomPosition(i,a.startRef.path,a.startRef.offset,a.endRef.path,a.endRef.offset);var s=o.leftCaret,h=o.rightCaret;if(null==s||null==h)return!1;var u=new C(s.node,s.offset,h.node,h.offset);if(null==u)return null;if(null==(u=this.rw_checkTHRangeForValidHighlight(u)))return null;r=t.rw_getAsTextRange(i,u.startRef.path,u.startRef.offset,u.endRef.path,u.endRef.offset)}else r=this.rw_checkTHRangeForValidHighlight(r);return null==r?(rw_alert("Failed to do the highlight, possibly due to selection going into a non textual part of the page."),!1):(t.rw_collapseSelection(),this.studySkillsHTMLHighlightRangeImpl(r,e),l.g_bPersistAnnotations&&l.g_bPersistHighlights&&"undefined"!=typeof rw_storeHighlightData&&this.rw_storeHighlightData(),this.rw_getStudySkillsPositionData())}catch(e){return!1}}rw_storeHighlightData(){l.g_bAnnotationGlobalCheck&&rw_forceUseAnnotations();var e=this.rw_getStudySkillsPositionData();null!=l.g_strStoredHighlightUnprocessedData?(e[0]=l.g_strStoredHighlightUnprocessedData+e[0],l.g_bStoreHighlightText&&(l.g_nHighlightNotSyncedState=1)):l.g_nHighlightNotSyncedState=0,l.g_strStoredHighlightData=null,l.g_bIE&&!l.g_controllerFactory.doesSupportHtml5()?rw_submitViaFlash(e):l.g_bStoreHighlightText?rw_submitSSDataWithPost(e):rw_submitSSDataWithGet(e)}rw_getStudySkillsPositionData(){let e=new _;var t=this.g_aTextRange.length,n="",r=null;this.g_bStoreHighlightText&&(r="|");try{for(var i=0;i<t;i++){n+="|",n+=this.g_aHighlightColour[i]+"|";var a,o,s,h=this.g_aTextRange[i];if(l.g_bIEOld){this.g_bStoreHighlightText&&(s=h.text);var u=e.rw_getTextRangeAsTHRange(h.body,h);a=u.startRef,o=u.endRef}else{h.refresh(),this.g_bStoreHighlightText&&(s=h.toString());var d=h.startCaret.node,g=h.startCaret.offset,c=h.endCaret.node,f=h.endCaret.offset;if(3==d.nodeType&&0==d.nodeValue.trimTH().length){for(d=e.getNextNode(d,!1,c),g=0;null!=d&&3==d.nodeType&&0==d.nodeValue.trimTH().length;)d=e.getNextNode(d,!1,c);null==d&&(d=c)}var m=e.rw_getRefPt(d,g);if(3==c.nodeType&&0==c.nodeValue.trimTH().length){for(f=0;d!=c&&null!=c&&3==c.nodeType&&0==c.nodeValue.trimTH().length;)c=e.getPreviousNode(c,!1,d);null!=c&&3==c.nodeType&&c.nodeValue.trimTH().length>0&&(f=c.nodeValue.length)}var p=e.rw_getRefPt(c,f);a=m,o=p}if(null!=a&&null!=o){var v=new N;v.getCaretPairFromDomPosition(h.body,a.path,a.offset,o.path,o.offset);var S=v.leftCaret,w=v.rightCaret;n+=this.rw_convertToPermCaretPosition(S)+"|"+this.rw_convertToPermCaretPosition(w),this.g_bStoreHighlightText&&(s=e.rw_replaceAll(s,"|","&#124;"),r+=encodeURIComponent(s)+"|")}}n.length>0&&(n+="|*188")}catch(e){console.log(e)}return new Array(n,r)}rw_convertToPermCaretPosition(e){let t=new _,n=new S;var r,i=e.node.ownerDocument.body,a=e.node,o=e.offset;o+=t.rw_getNodeOffset(a);for(var s=a.parentNode,l=s.getAttribute("id");(null==l||0==l.length)&&s!=i;)o+=t.rw_getNodeOffset(s),l=(s=s.parentNode).getAttribute("id");if(null!=l&&l.length>0){if(r="idx"+l,null!=s&&null!=s.firstChild){var h=n.getFirstChildTextNode(s,!1);if(3==h.nodeType){for(var u=0,d=h.nodeValue;d.length>u&&32==d.charCodeAt(u);)++u;o-=u}}}else{var g=t.rw_getRefPt(e.node,e.offset);r=g.path,o=g.offset}return r+"|"+o}studySkillsClearHighlights(e,t="Remove all highlights?"){let n=new _;try{var r=n.rw_getSelection(),i=null;if(null!=r&&null!=r.range&&(i=r.range,r.frame),null!=i&&i instanceof String){if(null!=g_lastInputSelectSFF&&(g_lastInputSelectSFF.selectionStart=0,g_lastInputSelectSFF.selectionEnd=0),g_lastInputSelectSFF=null,!e)return;i=null}if(l.bOverrideIgnore=!0,l.bOverrideAriaHidden=!0,l.g_bIEOld){if(null==i||0==i.length||0==i.text.length||e){if(!e){if(!(!l.g_bAllowPopupAlertsFlag||confirm(t)))return l.bOverrideIgnore=!1,void(l.OverrideAriaHidden=!1)}l.g_bPersistAnnotations&&(l.g_strStoredHighlightData=null,l.g_strStoredHighlightUnprocessedData=null);for(var a=this.g_aTextRange.length,o=0;o<a;o++){var s=this.g_aTextRange[o];studySkillsClearRangeIE(s),this.g_aTextRange[o]=null,this.g_aHighlightColour[o]=null}if(this.g_aTextRange=new Array,this.g_aHighlightColour=new Array,!document.compatMode.equalsTH("CSS1Compat"))if(!g_bIgnoreFrames&&top.frames.length>0){var h=0,u=top.frames.length;for(h=0;h<u;h++)try{(i=top.frames[h].document.selection.createRange()).expand("textedit"),studySkillsClearRangeIE(i)}catch(e){}}else(i=document.selection.createRange()).expand("textedit"),studySkillsClearRangeIE(i);return l.g_bPersistAnnotations&&l.g_bPersistHighlights&&"undefined"!=typeof rw_storeHighlightData&&rw_storeHighlightData(),l.bOverrideIgnore=!1,void(l.bOverrideAriaHidden=!1)}studySkillsClearRangeIE(i),studySkillsHTMLRefreshRanges();a=this.g_aTextRange.length,o=0;var d=null,g=null;for(o=0;o<a;o++)if(null!=(d=this.g_aTextRange[o])){if(i.inRange(d)){d=null,this.g_aTextRange.splice(o,1),this.g_aHighlightColour.splice(o,1),o--;continue}if((g=d.duplicate()).collapse(!0),i.inRange(g)){for((f=d.duplicate()).collapse(!1);f.compareEndPoints("StartToEnd",i)>0;)f.moveStart("character",-1);studySkillsClearRangeIE(g_aTextRange[o]),g_aTextRange[o]=f,rw_ieSpecificCallToSetHighlight(g_aTextRange[o],g_aHighlightColour[o])}else if((g=d.duplicate()).collapse(!1),i.inRange(g)){for((c=d.duplicate()).collapse(!0);c.compareEndPoints("EndToStart",i)<0;)c.moveEnd("character",1);studySkillsClearRangeIE(g_aTextRange[o]),g_aTextRange[o]=c,rw_ieSpecificCallToSetHighlight(g_aTextRange[o],g_aHighlightColour[o])}if(d.inRange(i)){studySkillsClearRangeIE(d);var c=d.duplicate(),f=d.duplicate();for(c.collapse(!0),f.collapse(!1);c.compareEndPoints("EndToStart",i)<0;)c.moveEnd("character",1);for(;f.compareEndPoints("StartToEnd",i)>0;)f.moveStart("character",-1);studySkillsClearRangeIE(this.g_aTextRange[o]),this.g_aTextRange[o]=c,this.g_aTextRange.push(f),this.g_aHighlightColour.push(this.g_aHighlightColour[o]),rw_ieSpecificCallToSetHighlight(c,this.g_aHighlightColour[o]),rw_ieSpecificCallToSetHighlight(f,this.g_aHighlightColour[o])}}i.execCommand("UnSelect",!1,null)}else{if(null==i||e){if(!e){if(!(!l.g_bAllowPopupAlertsFlag||confirm(t)))return l.bOverrideIgnore=!1,void(l.bOverrideAriaHidden=!1)}l.g_bPersistAnnotations&&(l.g_strStoredHighlightData=null,l.g_strStoredHighlightUnprocessedData=null);var m=this.g_aTextRange;this.g_aTextRange=new Array,this.g_aHighlightColour=new Array;for(h=0;h<m.length;h++){(d=m[h]).refresh(),this.rw_removeHighlight(this.getListOfHighlightableNodes(d.startCaret,d.endCaret))}}else{i.refresh();for(o=0;o<this.g_aTextRange.length;o++){var p=this.g_aTextRange[o];if(i.body==p.body){var v=i.compareRange(p);switch(v){case-1:window.status="Error occurred when trying to remove a highlight.";break;case 0:case 3:p.refresh(),this.rw_removeHighlight(this.getListOfHighlightableNodes(p.startCaret,p.endCaret)),this.g_aTextRange.splice(o,1),this.g_aHighlightColour.splice(o,1),--o,i.refresh();break;case 4:case 7:case 8:this.case1SFF(o,i,v),++o;break;case 6:this.case2SFF(o,i);break;case 5:this.case3SFF(o,i)}}}}n.rw_collapseSelection()}l.g_bPersistAnnotations&&l.g_bPersistHighlights&&"undefined"!=typeof rw_storeHighlightData&&rw_storeHighlightData()}catch(e){console.log("Error in method: "+e.name+" "+e.message+" "+e.description+" "+e.toString())}return l.bOverrideIgnore=!1,l.bOverrideAriaHidden=!1,this.rw_getStudySkillsPositionData()}}class ue{constructor(){this.g_nStickyNoteCount=0,this.g_nStickyNoteOpened=-1,this.g_strStickyNoteOrigText,this.openNoteCallback=null,this.closeNoteCallback=null}rw_createStickyNote(e){const t=e.target;if(null!=t.firstChild&&3==t.firstChild.nodeType&&"textarea"!=t.tagName.toLowerCase()){var n=(new _).getClickPoint(e);this.rw_createStickyNoteImpl(n,-1,null,!0)}}notesCallbacks(e,t){this.openNoteCallback=e,this.closeNoteCallback=t}loadNotes(e){this.rw_unserialiseStickyNotesInternalImpl(e,null)}rw_unserialiseStickyNotesInternalImpl(e,t){let n=new _;if(null!=e.notes&&e.notes.length>0)for(var r="",i="",a="",o=0;o<e.notes.length;o++){r=e.notes[o].id,i=e.notes[o].position,a=e.notes[o].text;var s=i.lastIndexOf("-");if(s>-1&&s<i.length-1){var l=i.substr(s+1),h=parseInt(l,10),u=null;if((s=(i=i.substring(0,s)).indexOf("^^"))>-1)for(;s>-1;)s=(i=i.substr(0,s)+i.substr(s+1)).indexOf("^^",s+1);if("idx"==i.substr(0,3)){var d=i.substr(3),g=document.getElementById(d);null!=g&&(-1==h&&rw_isSpan(g.tagName.toLowerCase())&&null!=g.firstChild&&1==g.firstChild.nodeType&&"img"==g.firstChild.tagName.toLowerCase()&&null==g.firstChild.nextSibling&&(g=g.firstChild),u=n.getCaretFromDomPosition(document.body,n.getPositionInDom(g),h,!0))}else u=n.getCaretFromDomPosition(document.body,i,h,!1);if(null!=u){if((s=a.indexOf("^^"))>-1)for(;s>-1;)s=(a=a.substr(0,s)+a.substr(s+1)).indexOf("^^",s+1);a=this.rw_custUnescape(a),(null==t||n.isElementContainedByElement(u.node,t))&&this.rw_createStickyNoteImpl(u,parseInt(r,10),a,!1)}}}}checkIfInsideHighlight(e){let t=new s;if(null==e||null==e.node)return e;var n=e.node;3==n.nodeType&&(n=n.parentNode);var r=t.rw_getAttribute(n,"rwstate"),a=t.rw_getAttribute(n,"rwTHgen");if(null!=r){for(;null!=r||null!=a;){if(null==(n=n.parentNode))return e;if(n==document.body)break;r=t.rw_getAttribute(n,"rwstate"),a=t.rw_getAttribute(n,"rwTHgen")}e=new i(n,0,!0)}return e}rw_createNoteImg(e,t){var n=null;if(l.g_bIEOld)try{n=document.createElement("<thStickyNote name='texthelpnote'>")}catch(e){n=null}null==n&&((n=document.createElement("thStickyNote")).name="texthelpnote"),n.setAttribute("alt",""),l.g_bIE&&null==e&&n.setAttribute("data-rwths","0"),null!=e&&n.setAttribute("title",e);let r=new s;return r.rw_setAttribute(n,"rwTHcomp","1"),(new _).addEvent(n,"click",this.$rw_clickOnStickyNote.bind(this)),r.rw_setAttribute(n,"texthelpnoteid",""+t),n.id="texthelpnote"+t,n.className="sticky_icon_unselected stickNotesIcon",n}$rw_clickOnStickyNote(e){var t=(new _).getTargetElement(e);this.openNoteCallback(t)}rw_removeNote(e){let t=new s,n=new _;var r="texthelpnote"+e;try{var i=document.getElementById(r);if(null!=i&&null!=i.parentNode){var a=i.parentNode;if(a.removeChild(i),!0,t.rw_getAttribute(a,"rwTHgen")&&n.rw_isSpan(a.tagName.toLowerCase())){var o=a.firstChild;if(null!=o&&null==o.nextSibling&&(3==o.nodeType||null==t.rw_getAttribute(o,"rwTHgen")&&null==t.rw_getAttribute(o,"rwTHcomp"))){var l=a.parentNode;l.insertBefore(o,a),l.removeChild(a)}}}}catch(e){}}rw_createStickyNoteImpl(e,t,n,r){let a=new _,o=new s;if(null!=e&&null!=e.node&&null!=e.node.parentNode){var l=this.checkIfInsideHighlight(e),h=e!=l;if(h){var u=a.getNextNodeIgnoreChildren(l.node,!1,l.node.parentNode),d=a.getNextTextNodeNoImg(l.node,!1,u,!1);null!=d&&3==d.nodeType&&(l=new i(d,0,!0))}if(a.rw_checkIfCanHaveStickys(e.node)&&(!h||a.rw_checkIfCanHaveStickys(l.node))){var g;if(document.getElementsByName("texthelpnote").length>20)return;-1==t?(++this.g_nStickyNoteCount,g=this.g_nStickyNoteCount):(g=t,this.g_nStickyNoteCount<g&&(this.g_nStickyNoteCount=g+1));var c=this.rw_createNoteImg(n,g);if(h&&(e=l),1==e.node.nodeType){var f=a.createPlainSpan();o.rw_setAttribute(f,"rwTHgen","1"),(m=e.node).parentNode.insertBefore(f,m),f.appendChild(c),f.appendChild(m)}else if(3==e.node.nodeType){var m,p=e.offset,v=(m=e.node).nodeValue;if("boolean"==typeof eba_old_firefox_sticky_handling&&1==eba_old_firefox_sticky_handling||(p=0),0!=p){for(p>0&&p==v.length&&--p;p>0&&32==v.charCodeAt(p);)--p;for(var S;p>0&&((S=v.charCodeAt(p-1))>63&&S<91||S>94&&S<123||S>44&&S<58||34==S||39==S);)--p}if(0==p&&32==v.charCodeAt(0)){for(var w=1;w<v.length&&32==v.charCodeAt(w);)++w;if(w<v.length)p=w;else{var b=m.parentNode.previousSibling;if(null!=b&&1==b.nodeType&&"img"==b.tagName.toLowerCase()&&null!=o.rw_getAttribute(b,"texthelpnoteid"))return;var y=m.parentNode.nextSibling;if(null!=y&&1==y.nodeType&&"img"==y.tagName.toLowerCase()&&null!=o.rw_getAttribute(y,"texthelpnoteid"))return}}var T=a.splitText(m,p),x=T.parentNode.previousSibling;if(null!=x&&1==x.nodeType&&("img"==x.tagName.toLowerCase()||"thstickynote"==x.tagName.toLowerCase())&&null!=o.rw_getAttribute(x,"texthelpnoteid"))return;T.parentNode.parentNode.insertBefore(c,T.parentNode)}r&&this.openNoteCallback(c,!0)}}}rw_custUnescape(e){var t,n,r,i,a=e.length;for(t=0;t<a;t++)if(91==(r=e.charCodeAt(t))){for(n=t+1,i="",r=e.charCodeAt(n);n<a&&93!=r;)i+=e.charAt(n),++n<a&&(r=e.charCodeAt(n));try{r=h2d(i),a=(e=n<a?e.substr(0,t)+String.fromCharCode(r)+e.substr(n+1):e.substr(0,t)+String.fromCharCode(r)).length}catch(e){}}return e}rw_serialiseStickyNotesImpl(e){let t=new s,n=new _;l.g_bAnnotationGlobalCheck&&rw_forceUseAnnotations();var r="texthelpnote"+e,i=document.getElementById(r);if(null!=i.parentNode&&i.parentNode.nodeType&&1==i.parentNode.nodeType||(i=null),null!=i&&"thstickynote"==i.tagName.toLowerCase()&&null!=t.rw_getAttribute(i,"rwTHcomp")){t.rw_getAttribute(i,"texthelpnoteid");if(null!=r){var a,o;i.title;if(null!=i.nextSibling){var h=i.nextSibling;if(1!=h.nodeType||n.rw_isSpan(h.tagName.toLowerCase())){o=0,o+=n.rw_getNodeOffset(i);for(d=(u=i.parentNode).getAttribute("id");(null==d||0==d.length)&&u!=document.body;)o+=n.rw_getNodeOffset(u),d=(u=u.parentNode).getAttribute("id");null!=d&&d.length>0?a="idx"+d:(a=n.getPositionInDom(i.parentNode),o=n.rw_getNodeOffset(i))}else{a=null==(d=h.getAttribute("id"))||0==d.length?n.getPositionInDom(i.parentNode):"idx"+d,o=-1}}else{o=0,o+=n.rw_getNodeOffset(i);for(var u,d=(u=i.parentNode).getAttribute("id");(null==d||0==d.length)&&u!=document.body;)o+=n.rw_getNodeOffset(u),d=(u=u.parentNode).getAttribute("id");null!=d&&d.length>0?a="idx"+d:(a=n.getPositionInDom(i.parentNode),o=n.rw_getNodeOffset(i))}return{position:a+"-"+o}}}}}class de{constructor(){this.strCharacterHash=String.fromCharCode(45),this.strCharacterEnDash=String.fromCharCode(8211),this.strCharacterEmDash=String.fromCharCode(8212),this.strCharacterMinus=String.fromCharCode(8722),this.mathsSymbolArray=new Array,this.mathsMapping=new Object,this.mathsData="-:minus;"+this.strCharacterEnDash+":minus;"+this.strCharacterMinus+":minus;+:plus;/:divided by;*:multiplied by;<:less than;>:greater than;=:, equals;^:raised to the power of;<=:less than or equal to;>=:greater than or equal to;",this.mathsMappingSetup(this.mathsData)}setUsingMath(e){l.bMathsSymbols=e}setSymbolText(e){null!=e&&"string"==typeof e&&e.length>0&&(l.bMathsSymbols=!0,this.mathsSymbolArray=new Array,this.mathsMapping=new Object,this.mathsMappingSetup(this.mathsData),this.mathsMappingSetup(e))}mathsSymbolCheck(e){return this.mathsSymbolArray.indexOf(e.trimTH())>-1}mathsMappingSetup(e){let t,n,r,i,a,o;for(n=0,r=e.indexOf(":"),i=e.indexOf(";",r);n>-1&&r>-1&&(a=e.substring(n,r),o=i>-1?e.substring(r+1,i):e.substring(r+1),0==o.length?(t=this.mathsSymbolArray.indexOf(a),t>-1&&(this.mathsSymbolArray.splice(t,1),delete this.mathsMapping[a])):(t=this.mathsSymbolArray.indexOf(a),t>-1||this.mathsSymbolArray.push(a),this.mathsMapping[a]=o),i>-1);)n=i+1,r=e.indexOf(":",n),i=e.indexOf(";",r)}mathsSymbolReplacement(e){var t,n,r,i=e.length,a=e,o=this.trimTextToMathsSymbols(e);if(null==o)return e;for(t=i-1;t>=0;t--)if(32!=(r=o.charCodeAt(t))){for(n=t;32!=r&&t>=0;)--t,r=o.charCodeAt(t);var s=o.substring(t+1,n+1);null!=this.mathsMapping[s]&&(a=a.substring(0,t+1)+" "+this.mathsMapping[s]+" "+a.substr(n+1))}return a}trimTextToMathsSymbols(e){var t,n,r=!1,i=e.length,a="";for(t=0;t<i;t++){n=e.charCodeAt(t);var s=new o;32==n||s.rw_isTextChar(n)||s.rw_isWhiteSpace(e.charAt(t))?a+=" ":(a+=e.charAt(t),r=!0)}return r?a:null}mathsSymbolReplacementSentenceCheck(e){var t,n,r=!1,i=e.split(" "),a=i.length;for(n=0;n<a;n++)(t=this.mathsSymbolReplacement(i[n]))!=i[n]&&(i[n]=t,r=!0);if(r){var o="";for(n=0;n<a-1;n++)o+=i[n],o+=" ";return o+=i[a-1]}return e}mathsSymbolReplacementWordList(e){var t=!1;if(l.bMathsSymbols&&null!=e){var n,r=e.length;for(n=0;n<r;n++){var i;(i=this.mathsSymbolReplacement(e[n]))!=e[n]&&(e[n]=i,t=!0)}}return t}mathsSymbolReplacementWithContext(e,t,n){let r,i,a,s=e.length,l=e,h=this.trimTextToMathsSymbols(e);if(null==h)return e;var u=new o;for(r=s-1;r>=0;r--)if(a=h.charCodeAt(r),32!=a){i=r;let o=!1;for("(){}[]".indexOf(h.charAt(r))>-1&&(o=!0),--r,a=h.charCodeAt(r);32!=a&&r>=0&&!o;)"(){}[]".indexOf(h.charAt(r))>-1?o=!0:(--r,a=h.charCodeAt(r));let s=h.substring(r+1,i+1);if(s==this.strCharacterHash||s==this.strCharacterEnDash||s==this.strCharacterEmDash){if(s==this.strCharacterEmDash)l=l.substring(0,r+1)+" "+l.substr(i+1);else{var d=e.substring(i-1,i),g=e.substring(i-2,i-1),c=(e.substring(i-3,i-2),e.substring(i+1,i+2)),f=e.substring(i+2,i+3);e.substring(i+3,i+4);if("string"==typeof t){var m=t.length+i;i<1&&m>0&&(d=t.substring(m-1,m)),i<2&&m>1&&(g=t.substring(m-2,m-1)),i<3&&m>2&&t.substring(m-3,m-2)}if("string"==typeof n){let t=e.length-(i+1),r=n.length;t<1&&r>0&&(c=n.substring(0,1)),t<2&&r>1-t&&(f=n.substring(1-t,2-t)),t<3&&r>2-t&&n.substring(2-t,3-t)}l=""!=d&&" "!=d&&"("!=d||!u.isNumber(c)?u.isNumber(d)&&u.isNumber(c)?l.substring(0,r+1)+" to "+l.substr(i+1):u.isAlpha(d)&&u.isAlpha(c)?s==this.strCharacterEnDash?l.substring(0,r+1)+" to "+l.substr(i+1):l.substring(0,r+1)+" "+l.substr(i+1):" "==d&&" "==c&&u.isNumber(g)&&u.isNumber(f)?l.substring(0,r+1)+" minus "+l.substr(i+1):(u.isNumber(d)&&" "==c&&u.isNumber(f),l.substring(0,r+1)+" "+l.substr(i+1)):l.substring(0,r+1)+" negative "+l.substr(i+1)}s=""}null!=this.mathsMapping[s]&&(l=l.substring(0,r+1)+" "+this.mathsMapping[s]+" "+l.substr(i+1)),o&&++r}return l}}class ge{constructor(){a(this,"setIgnorePageDefault",(function(e){this.m_bIgnoreDefault=e})),a(this,"isIgnorePageDefault",(function(){return this.m_bIgnoreDefault})),a(this,"setDocument",(function(e){this.m_doc=e})),a(this,"setIgnoreAll",(function(e){let t=new s,n=t.getIgnoreAttr();e?t.rw_setAttribute(this.m_doc.body,n,"1"):t.rw_removeAttribute(this.m_doc.body,n)})),a(this,"isIgnoreAll",(function(){let e=new s,t=e.getIgnoreAttr();return null!=e.rw_getAttribute(this.m_doc.body,t)})),a(this,"addIgnore",(function(e){let t=(new s).getIgnoreAttr();this.addAttribute(e,t,"1")})),a(this,"addAllow",(function(e){let t=(new s).getAllowAttr();this.addAttribute(e,t,"1")})),a(this,"removeIgnore",(function(e){let t,n=new s,r=n.getIgnoreAttr();t=e instanceof Element?e:this.m_doc.getElementById(e),n.rw_removeAttribute(t,r)})),a(this,"removeAllow",(function(e){let t,n=new s,r=n.getAllowAttr();t=e instanceof Element?e:this.m_doc.getElementById(e),n.rw_removeAttribute(t,r)})),a(this,"addIgnoreList",(function(e){if(null!=e)for(var t=0;t<e.length;t++)this.addIgnore(e[t])})),a(this,"addIgnoreListQuerySelector",(function(e){let t=document.querySelectorAll(e);if(null!=t)for(let e=0;e<t.length;e++)this.addIgnore(t[e])})),a(this,"addAllowList",(function(e){if(e instanceof Array)for(let t=0;t<e.length;t++)this.addAllow(e[t])})),a(this,"addAllowListQuerySelector",(function(e){let t=document.querySelectorAll(e);if(null!=t)for(let e=0;e<t.length;e++)this.addAllow(t[e])})),a(this,"removeIgnoreList",(function(e){if(e instanceof Array)for(let t=0;t<e.length;t++)this.removeIgnore(e[t])})),a(this,"removeIgnoreListQuerySelector",(function(e){var t=document.querySelectorAll(e);if(null!=t)for(let e=0;e<t.length;e++)this.removeIgnore(t[e])})),a(this,"removeAllowList",(function(e){if(e instanceof Array)for(let t=0;t<e.length;t++)this.removeAllow(e[t])})),a(this,"removeAllowListQuerySelector",(function(e){let t=document.querySelectorAll(e);if(null!=t)for(let e=0;e<t.length;e++)this.removeAllow(t[e])})),a(this,"addPronunciation",(function(e,t){this.addPronunciationImpl(this.m_doc.body,e,t)})),a(this,"removePronunciation",(function(e){this.removePronunciationImpl(this.m_doc.body,e)})),a(this,"addPronunciationById",(function(e,t,n){let r=this.m_doc.getElementById(e);null!=r&&this.addPronunciationImpl(r,t,n)})),a(this,"removePronunciationById",(function(e,t){let n=this.m_doc.getElementById(e);null!=n&&this.removePronunciationImpl(n,t)})),a(this,"replaceTextInElement",(function(e,t){let n=(new s).getPronunceAttr();this.addAttribute(e,n,t)})),a(this,"restoreTextInElement",(function(e){let t=new s,n=t.getPronunceAttr();t.rw_removeAttribute(this.m_doc.getElementById(e),n)})),a(this,"addCommand",(function(e,t){if("string"==typeof t){let n=(new s).getCommandAttr();this.addAttribute(e,n,t)}})),a(this,"removeCommand",(function(e){var t=this.m_doc.getElementById(e);null!=t&&this.removeCommands(t)})),a(this,"addCommandQueue",(function(e,t){if(t instanceof Array){let n=(new s).getCommandAttr();this.addAttribute(e,n,"list");for(let r=0;r<t.length;r++)this.addAttribute(e,n+(r+1),t[r])}})),a(this,"checkCommandsForPageID",(function(){let e=new Array,t=document.querySelectorAll('[texthelpcmd^="pageid"]');if(null!=t&&t.length>0)for(let n=0;n<t.length;n++){let r=t[n].attributes.texthelpcmd.value;if(null!=r){let t=r.indexOf(":");t>-1&&e.push(r.substr(t+1))}}return e})),a(this,"setReadingOrder",(function(e){try{if(this.addAllowList(e),e instanceof Array&&e.length>0){for(let t=0;t<e.length-1;t++)this.addCommand(e[t],"jump:"+e[t+1]);this.addCommand(e[e.length-1],"stopafter")}}catch(e){}})),a(this,"setStrictReadingOrder",(function(e){this.clearAllReadingOrders(),this.setIgnoreAll(!0),this.setReadingOrder(e)})),a(this,"clearReadingOrder",(function(e){try{if(this.removeAllowList(e),e instanceof Array&&e.length>0)for(let t=0;t<e.length;t++)this.removeCommand(e[t])}catch(e){}})),a(this,"clearAllReadingOrders",(function(){try{this.clearAllReadingOrderImpl(this.m_doc.body)}catch(e){}})),a(this,"clearAllCommands",(function(){try{this.clearAllCommandsImpl(m_doc.body)}catch(e){}})),this.m_bIgnoreDefault=!1,this.m_doc=document}clearAllReadingOrderImpl(e){let t=e;for(;null!=t;)t.hasChildNodes()&&this.clearAllReadingOrderImpl(t.firstChild),this.removeAllowIgnore(t),this.removeCommands(t),t=t.nextSibling}clearAllCommandsImpl(e){let t=e;for(;null!=t;)t.hasChildNodes()&&this.clearAllCommandsImpl(t.firstChild),this.removeCommands(t),t=t.nextSibling}addAttribute(e,t,n){let r;if(r=e instanceof Element?e:this.m_doc.getElementById(e),null!=r){(new s).rw_setAttribute(r,t,n)}}addPronunciationImpl(e,t,n){let r=e,i=new S,a=i.getFirstChildTextNode(e,!1);for(;a;){let e=this.checkNodeForPronunciation(a,t,n);null!=e?(a=i.getNextNodeIgnoreChildren(e,!1,r),3!=a.nodeType&&(a=i.getNextTextNodeNoBlank(a,!1,r))):a=i.getNextTextNodeNoBlank(a,!1,r)}}removePronunciationImpl(e,t){let n=e,r=new S,i=r.getFirstChildTextNode(e,!1);for(;i;){let e=r.getNextTextNodeNoBlank(i,!1,n);this.checkNodeForRemovingPronunciation(i,t),i=e}}checkNodeForPronunciation(e,t,n){if(3==e.nodeType){let r=e.nodeValue;if(r.indexOf(t)>-1){let i=(new s).getPronunceAttr(),a=r.indexOf(t);return(new _).wrapText(e,a,a+t.length,[i,n])}}return e}checkNodeForRemovingPronunciation(e,t){if(3==e.nodeType&&e.nodeValue==t){let t=new s,n=t.getPronunceAttr();if(null!=e.parentNode&&null!=t.rw_getAttribute(e.parentElement,n)){let t=e.parentNode,n=t.parentNode;null!=n&&n.replaceChild(e,t)}}}removeAllowIgnore(e){if(null!=e){let t=new s,n=t.getAllowAttr();t.rw_removeAttribute(e,n);let r=t.getIgnoreAttr();t.rw_removeAttribute(e,r)}}removeCommands(e){if(null!=e){let t=new s,n=t.getCommandAttr();t.rw_removeAttribute(e,n);let r=1,i=t.rw_getAttribute(e,"texthelpCmd"+r);for(;null!=i;)t.rw_removeAttribute(e,"texthelpCmd"+r),++r,i=t.rw_getAttribute(e,"texthelpCmd"+r)}}}class ce{constructor(...e){if(1===e.length){l.init(e[0]);const{sre:t,tagPage:n,tagClass:r,wrapperTag:i,highlightTag:a,url:o}=e[0];if(this.initialise({url:o,sre:t}),l.tagPage){void 0!==r&&(c=r),void 0!==i&&(g=i),void 0!==a&&function(e){d=e}(wraphighlightTagperTag),(new le).tagSentencesWithFramesImpl(window)}}else{const[,t]=e;this.initialise({url:t})}}initialise(e){var t;if(this.mathLoaded=!1,e.sre&&(t=e.sre,h=t,this.mathLoaded=!0),this.selectionController=new E,this.highlightSettings=new oe,this.speechHighlightManager=null,this.hoverSpeak=new Z,this.clickToSpeak=new se,this.speechObject=new Q,l.tagPage?this.studySkills=new he:this.studySkills=new ee,this.notes=new ue,l.bMathsSymbols&&(this.mathSymbolControl=new de,this.mathWithContext=!1,l.mathSymbolMapping&&this.mathSymbolControl.mathsMappingSetup(l.mathSymbolMapping),l.mathWithContext&&(this.mathWithContext=!0),this.speechObject.setMathSymbolControl(this.mathSymbolControl,this.mathWithContext)),this.hoverSpeakOn=!1,this.url=e.url,null!=e.url&&"undefined"!=typeof MathJax&&MathJax.version&&"function"==typeof MathJax.Ajax.Load){var n=window.MathJax;delete window.MathJax,window.MathJax=n;let t=!1;for(var i in MathJax.Ajax.loaded)if(i.indexOf("toMathML")>-1){t=!0;break}t||MathJax.Ajax.Load(e.url+"toMathML.js"),this.load_script(e.url+"sre_browser.js"),this.mathLoaded=!0}this.predictionOn=!1,this.predictionManager=new ae,r.a.subscribe("pauseHover",this.pauseHover.bind(this)),this.isHoverSpeakEnabled=!1,this.setUpiframes()}getDocumentLanguage(e){return null!=e?frames.document.documentElement.lang:document.documentElement.lang}setUpIFrameObserver(){this.targetElement=document.body;this.observer=new MutationObserver(this.observerFunction.bind(this)),this.observer.observe(this.targetElement,{childList:!0,subtree:!0})}observerFunction(e){e.forEach(function(e){[].filter.call(e.addedNodes,function(e){return"IFRAME"==e.nodeName}.bind(this)).forEach(function(e){e.addEventListener("load",function(t){this.addEventsToFrame(e).bind(this)}.bind(this))}.bind(this))}.bind(this))}addEventsToFrame(e){try{var t;e.document?t=e:e.contentWindow&&(t=e.contentWindow),null!=t&&(t.document.body.addEventListener("mouseover",this.iframeCallback.bind(this)),t.document.body.addEventListener("mouseclick",this.iframeCallback.bind(this)),this.checkForChildFrames(t),this.observer=new MutationObserver(this.observerFunction.bind(this)),this.observer.observe(t.document.body,{childList:!0,subtree:!0}),void 0!==t.MathJax&&(t.MathJax.Ajax.Load(this.url+"toMathML.js"),this.mathLoaded||(this.load_script(this.url+"sre_browser.js"),this.mathLoaded=!0)))}catch(e){}}checkForChildFrames(e){var t;if(e.frames.length>0)for(t=0;t<e.frames.length;t++)this.addEventsToFrame(e.frames[t])}setUpiframes(){if(window.frames.length>0)for(let e=0;e<window.frames.length;e++)try{this.addEventsToFrame(window.frames[e])}catch(e){}}iframeCallback(e){this.hoverSpeakOn&&this.speechCallback&&this.hoverSpeak.mouseMoved(e,this.speechCallback),this.clickToSpeakOn&&this.speechCallback&&this.clickToSpeak.mouseClick(e,this.speechCallback)}forceLoadMath(e){if(MathJax.version&&"function"==typeof MathJax.Ajax.Load){var t=window.MathJax;if(delete window.MathJax,window.MathJax=t,e){if(e.MathJax.version,"function"==typeof e.MathJax.Ajax.Load){t=e.MathJax;delete e.MathJax,e.MathJax=t;let r=!1;for(var n in e.MathJax.Ajax.loaded)if(n.indexOf("toMathML")>-1){r=!0;break}r||e.MathJax.Ajax.Load(this.url+"toMathML.js"),this.mathLoaded||(this.load_script(this.url+"sre_browser.js"),this.mathLoaded=!0)}}else if(!this.mathLoaded&&MathJax.version&&"function"==typeof MathJax.Ajax.Load){t=window.MathJax;delete window.MathJax,window.MathJax=t;let e=!1;for(var n in MathJax.Ajax.loaded)if(n.indexOf("toMathML")>-1){e=!0;break}e||MathJax.Ajax.Load(this.url+"toMathML.js"),this.load_script(this.url+"sre_browser.js"),this.mathLoaded=!0}}}pauseHover(){this.hoverSpeakOn||this.isHoverSpeakEnabled?(this.hoverSpeakOn=!1,this.isHoverSpeakEnabled=!0,this.pauseHoverTimer=setTimeout(()=>this.unPauseHover(),300)):this.isHoverSpeakEnabled=!1}unPauseHover(){this.isHoverSpeakEnabled&&(this.hoverSpeakOn=!0)}clearHoverSpeak(){this.hoverSpeak.clearHoverSpeak()}load_script(e){var t=document.createElement("script");t.type="text/javascript",t.src=e,t.className="MyInjectedScript",document.getElementsByTagName("head")[0].appendChild(t)}predictionEnabled(e){this.predictionOn=e}getPredictionCoordinates(){return this.predictionManager.getPredictionCoordinates()}getPredictionSentence(){return this.predictionManager.getPredictionSentence()}predictionInsertText(e){this.predictionManager.predictionInsertText(e)}isEditable(){return this.predictionManager.isEditable()}predictionElement(e){let t={target:e};this.predictionManager.onMouseDown(t)}predictionSetSelectionRange(e,t,n){this.predictionManager.setSelectionRange(e,t,n)}hoverSpeakEnabled(e){this.hoverSpeakOn=e,this.isHoverSpeakEnabled=e,e||clearTimeout(this.pauseHoverTimer)}clickToSpeakEnabled(e){this.clickToSpeakOn=e}mouseOverEvent(e,t){this.speechCallback=t,this.hoverSpeakOn?this.hoverSpeak.mouseMoved(e,this.speechCallback):clearTimeout(this.pauseHoverTimer)}mouseClickEvent(e,t){this.clickToSpeakEnabled&&this.clickToSpeak.mouseClick(e,t)}hasSelection(){return this.selectionController.hasSelection()}getWord(){var e=new Array,t=this.selectionController.getSelectionRange();if(t&&(e=t.toString().split(/\s/)).length>0)return e.length>2||1==e.length?new Array(e[0]):new Array(e[0],e[1]);return null}getSelection(){return this.selectionController.getSelectionRange().toString().split(/\s/)}getSelectionLocal(){return this.getSelection()}clearSelection_(){this.selectionController.clearSelection_()}clearBrowserSelection(){this.selectionController.clearBrowserSelection()}hiliteSelection(){var e=null;if(this.hasSelection()||this.hoverSpeakOn||this.clickToSpeakOn){if(this.sentenceNo=0,this.hoverSpeakOn){var t=this.hoverSpeak.getSelectionRange();this.speechObject.processRange(t,!0)}else if(this.clickToSpeakOn){t=this.clickToSpeak.getSelectionRange();this.speechObject.processRange(t,!0)}else this.speechObject.processRange(this.selectionController.getSelectionRange(),!1);(e=this.speechObject.getFirstSentence())&&""==e.getRawText()&&(e=this.speechObject.getNextSentence(!0))}else{let n;n=null!=l.playStartPoint&&""!=l.playStartPoint?document.getElementById(playStartPoint):document.body.children[0],t=new C(n,0,n,0),this.speechObject.processRange(t,!0),e=this.speechObject.getNextSentence(!0)}if(this.selectionController.clearBrowserSelection(),null!=e){this.speechObject.actOnCommand(e);var n=e.getWords();return 0==n.length?"":(this.speechHighlightManager=new D(e,this.highlightSettings),this.speechHighlightManager.highlightRange(),n)}return""}highlightElementById(e){let t=null;if(this.speechObject.processRange(this.selectionController.getElementRangeById(e),!1),t=this.speechObject.getFirstSentence(),t&&""==t.getRawText()&&(t=this.speechObject.getNextSentence(!0)),this.selectionController.clearBrowserSelection(),null!=t){let e=t.getWords();return 0==e.length?"":(this.speechHighlightManager=new D(t,this.highlightSettings),this.speechHighlightManager.highlightRange(),e)}return""}hiliteWord(e){this.speechHighlightManager.highlightWord(e)}stop(){null!=this.speechObject.getCurrentSentence()&&null!=this.speechHighlightManager&&this.speechHighlightManager.unHighlightRange(),this.hoverSpeak.clearHoverTags(),this.clickToSpeak.clearHoverTags()}hiliteNextSentence(e){null!=this.speechHighlightManager&&this.speechHighlightManager.unHighlightRange(),null!=this.hoverSpeak&&this.hoverSpeak.clearHoverTags();var t=this.speechObject.getNextSentence(e);this.speechObject.actOnCommand(t);var n=null;return null!=t&&(n=t.getWords(),this.speechHighlightManager=new D(t,this.highlightSettings),this.speechHighlightManager.highlightRange(t)),n}getLanguageForSentence(){return this.speechObject.getCurrentSentence().getLangTag()}loadPersistantHighlightToPage(e){null!=e&&e.highlights&&this.studySkills.rw_retrieveHighlightDataForPKTReplyImpl(e.highlights,null)}removePersistantHighlight(e){return this.studySkills.studySkillsClearHighlights(e)}addPersistantHighlightToPage(e){return this.studySkills.studySkillsHTMLHighlightRange(e)}highlightSelection(e){var t=this.selectionController.getSelectionObject();this.studySkills.studySkillsHTMLHighlightRange(e,t)}clearHighlights(){var e=null;this.hasSelection()&&(e=this.selectionController.getSelectionObject()),this.studySkills.studySkillsClearHighlights(!1,e)}collectHighlights(e,t){var n=new Array;if(2==e)for(var r=0;r<t.length;r++)n.push(...this.studySkills.studySkillsCollateForColour(t[r]));else n.push(...this.studySkills.studySkillsCollateForColour(t));return n}collectVocabWords(e){}notesCallbacks(e,t){this.notes.notesCallbacks(e,t)}loadNotes(e){this.notes.loadNotes(e)}removeNote(e){this.notes.rw_removeNote(e)}getNotePostion(e){return this.notes.rw_serialiseStickyNotesImpl(e)}createStickyNote(e){this.notes.rw_createStickyNote(e)}addVoiceNote(){}collectVocabs(e,t,n){return this.studySkills.fetchWords()}onMouseUp(e){}onMouseDown(e){this.predictionManager.onMouseDown(e)}onKeyDown(e){this.predictionManager.onKeyDown(e)}setWordHighlightStyle(e){this.highlightSettings.speechWordColour=e}setSentenceHighlightStyle(e){this.highlightSettings.speechRangeColour=e}getNewDomControl(){return new ge}setAnnounceLinksAsWords(e){l.strAnnounceLinksAsWords=e}getAnnounceLinksAsWords(){return l.strAnnounceLinksAsWords}setBreakList(e,t){!function(e,t){t?f=e:f.concat(e)}(e,t)}setStyleList(e,t){!function(e,t){t?m=e:m.concat(e)}(e,t)}setMathSreSettings(e){l.mathSre=e}getMathSreSettings(){return l.mathSre}}},177:function(e,t,n){"use strict";function r(e,t,n,r,i,a,o){try{var s=e[a](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){r(o,i,a,s,l,"next",e)}function l(e){r(o,i,a,s,l,"throw",e)}s(void 0)}))}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function l(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}n.d(t,"a",(function(){return _}));var h=Symbol.for("texthelp.EventBus"),u=window[h];function d(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function g(e,t){return e(t={exports:{}},t.exports),t.exports}u||(u={events:{},unSubscribe:function(e,t,n){if(null!=this.events[e])for(var r=0;r<this.events[e].length;r++)this.events[e][r].context==n&&this.events[e].splice(r,1)},subscribe:function(e,t,n){return null==this.events[e]&&(this.events[e]=[]),this.events[e].push({callback:t,context:n}),this.events.length-1},publish:function(e){var t=this.events[e];if(null!=t){for(var n=arguments.length,r=Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var a=0;a<t.length;a++)t[a].callback.apply(this,r)}}},window[h]=u);var c=g((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default={voices:{Ava:"en-US"},lang:{all:{EquatIO:"e-qway-shi-o",Equatio:"e-qway-shi-o",equatio:"e-qway-shi-o",WriQ:"Wry-Q",wriq:"Wry-Q",Wriq:"Wry-Q"},"en-US":{EquatIO:"e-qway-shi-o",Equatio:"e-qway-shi-o",equatio:"e-qway-shi-o",WriQ:"Wry-Q",wriq:"Wry-Q",Wriq:"Wry-Q"}}}}));d(c);var f=g((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Pronunciations=void 0;var n,r=function(){function e(e,t){for(var n,r=0;r<t.length;r++)(n=t[r]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=(n=c)&&n.__esModule?n:{default:n};t.Pronunciations=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.prons={voices:{},lang:{}},void 0!==i.default&&null!=i.default&&(this.prons=i.default)}return r(e,[{key:"loadPronFile",value:function(){}},{key:"setPronunciationsForVoice",value:function(e,t){var n=this.prons.voices[e];this.setPronunciationsForLang(n,t)}},{key:"setPronunciationsForLang",value:function(e,t){var n=this.prons.lang[e],r=this.prons.lang.all,i=Object.assign({},r,n);if(null!=i&&void 0!==i)for(var a in i)for(var o=0;o<t.length;o++)t[o]=t[o].replace(a,i[a])}}]),e}()}));d(f);var m=f.Pronunciations,p=function(){function e(){a(this,e),this.hexcase=0,this.b64pad="",this.chrsz=8}return s(e,[{key:"hex_md5",value:function(e){return this.binl2hex(this.core_md5(this.str2binl(e),e.length*this.chrsz))}},{key:"core_md5",value:function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,r=-271733879,i=-1732584194,a=271733878,o=0;o<e.length;o+=16){var s=n,l=r,h=i,u=a;n=this.md5_ff(n,r,i,a,e[o+0],7,-680876936),a=this.md5_ff(a,n,r,i,e[o+1],12,-389564586),i=this.md5_ff(i,a,n,r,e[o+2],17,606105819),r=this.md5_ff(r,i,a,n,e[o+3],22,-1044525330),n=this.md5_ff(n,r,i,a,e[o+4],7,-176418897),a=this.md5_ff(a,n,r,i,e[o+5],12,1200080426),i=this.md5_ff(i,a,n,r,e[o+6],17,-1473231341),r=this.md5_ff(r,i,a,n,e[o+7],22,-45705983),n=this.md5_ff(n,r,i,a,e[o+8],7,1770035416),a=this.md5_ff(a,n,r,i,e[o+9],12,-1958414417),i=this.md5_ff(i,a,n,r,e[o+10],17,-42063),r=this.md5_ff(r,i,a,n,e[o+11],22,-1990404162),n=this.md5_ff(n,r,i,a,e[o+12],7,1804603682),a=this.md5_ff(a,n,r,i,e[o+13],12,-40341101),i=this.md5_ff(i,a,n,r,e[o+14],17,-1502002290),r=this.md5_ff(r,i,a,n,e[o+15],22,1236535329),n=this.md5_gg(n,r,i,a,e[o+1],5,-165796510),a=this.md5_gg(a,n,r,i,e[o+6],9,-1069501632),i=this.md5_gg(i,a,n,r,e[o+11],14,643717713),r=this.md5_gg(r,i,a,n,e[o+0],20,-373897302),n=this.md5_gg(n,r,i,a,e[o+5],5,-701558691),a=this.md5_gg(a,n,r,i,e[o+10],9,38016083),i=this.md5_gg(i,a,n,r,e[o+15],14,-660478335),r=this.md5_gg(r,i,a,n,e[o+4],20,-405537848),n=this.md5_gg(n,r,i,a,e[o+9],5,568446438),a=this.md5_gg(a,n,r,i,e[o+14],9,-1019803690),i=this.md5_gg(i,a,n,r,e[o+3],14,-187363961),r=this.md5_gg(r,i,a,n,e[o+8],20,1163531501),n=this.md5_gg(n,r,i,a,e[o+13],5,-1444681467),a=this.md5_gg(a,n,r,i,e[o+2],9,-51403784),i=this.md5_gg(i,a,n,r,e[o+7],14,1735328473),r=this.md5_gg(r,i,a,n,e[o+12],20,-1926607734),n=this.md5_hh(n,r,i,a,e[o+5],4,-378558),a=this.md5_hh(a,n,r,i,e[o+8],11,-2022574463),i=this.md5_hh(i,a,n,r,e[o+11],16,1839030562),r=this.md5_hh(r,i,a,n,e[o+14],23,-35309556),n=this.md5_hh(n,r,i,a,e[o+1],4,-1530992060),a=this.md5_hh(a,n,r,i,e[o+4],11,1272893353),i=this.md5_hh(i,a,n,r,e[o+7],16,-155497632),r=this.md5_hh(r,i,a,n,e[o+10],23,-1094730640),n=this.md5_hh(n,r,i,a,e[o+13],4,681279174),a=this.md5_hh(a,n,r,i,e[o+0],11,-358537222),i=this.md5_hh(i,a,n,r,e[o+3],16,-722521979),r=this.md5_hh(r,i,a,n,e[o+6],23,76029189),n=this.md5_hh(n,r,i,a,e[o+9],4,-640364487),a=this.md5_hh(a,n,r,i,e[o+12],11,-421815835),i=this.md5_hh(i,a,n,r,e[o+15],16,530742520),r=this.md5_hh(r,i,a,n,e[o+2],23,-995338651),n=this.md5_ii(n,r,i,a,e[o+0],6,-198630844),a=this.md5_ii(a,n,r,i,e[o+7],10,1126891415),i=this.md5_ii(i,a,n,r,e[o+14],15,-1416354905),r=this.md5_ii(r,i,a,n,e[o+5],21,-57434055),n=this.md5_ii(n,r,i,a,e[o+12],6,1700485571),a=this.md5_ii(a,n,r,i,e[o+3],10,-1894986606),i=this.md5_ii(i,a,n,r,e[o+10],15,-1051523),r=this.md5_ii(r,i,a,n,e[o+1],21,-2054922799),n=this.md5_ii(n,r,i,a,e[o+8],6,1873313359),a=this.md5_ii(a,n,r,i,e[o+15],10,-30611744),i=this.md5_ii(i,a,n,r,e[o+6],15,-1560198380),r=this.md5_ii(r,i,a,n,e[o+13],21,1309151649),n=this.md5_ii(n,r,i,a,e[o+4],6,-145523070),a=this.md5_ii(a,n,r,i,e[o+11],10,-1120210379),i=this.md5_ii(i,a,n,r,e[o+2],15,718787259),r=this.md5_ii(r,i,a,n,e[o+9],21,-343485551),n=this.safe_add(n,s),r=this.safe_add(r,l),i=this.safe_add(i,h),a=this.safe_add(a,u)}return[n,r,i,a]}},{key:"md5_cmn",value:function(e,t,n,r,i,a){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(t,e),this.safe_add(r,a)),i),n)}},{key:"md5_ff",value:function(e,t,n,r,i,a,o){return this.md5_cmn(t&n|~t&r,e,t,i,a,o)}},{key:"md5_gg",value:function(e,t,n,r,i,a,o){return this.md5_cmn(t&r|n&~r,e,t,i,a,o)}},{key:"md5_hh",value:function(e,t,n,r,i,a,o){return this.md5_cmn(t^n^r,e,t,i,a,o)}},{key:"md5_ii",value:function(e,t,n,r,i,a,o){return this.md5_cmn(n^(t|~r),e,t,i,a,o)}},{key:"safe_add",value:function(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}},{key:"bit_rol",value:function(e,t){return e<<t|e>>>32-t}},{key:"str2binl",value:function(e){for(var t=[],n=(1<<this.chrsz)-1,r=0;r<e.length*this.chrsz;r+=this.chrsz)t[r>>5]|=(e.charCodeAt(r/this.chrsz)&n)<<r%32;return t}},{key:"binl2hex",value:function(e){for(var t=this.hexcase?"0123456789ABCDEF":"0123456789abcdef",n="",r=0;r<4*e.length;r++)n+=t.charAt(15&e[r>>2]>>r%4*8+4)+t.charAt(15&e[r>>2]>>r%4*8);return n}},{key:"$rw_hash",value:function(e){return this.hex_md5(e)}}]),e}(),v=[{name:"Tarik",Gender:"Male",language:"ar",description:"Arabic Male Tarik",glang:"ar",vendor:"Nuance"},{name:"Miren",Gender:"Female",language:"eu-es",description:"Basque Female Miren",glang:"eu",vendor:"Nuance"},{name:"Montserrat",Gender:"Female",language:"ca-es",description:"Catalan Female Montserrat",glang:"ca",vendor:"Nuance"},{name:"Tian-Tian",Gender:"Female",language:"zh-cn",description:"Chinese (Mandarin - Simplified) Female Tian-Tian",glang:"zh_cn",vendor:"Nuance"},{name:"Mei-Jia",Gender:"Female",language:"zh-tw",description:"Chinese (Mandarin - Traditional - Tiawanese) Female Mei-Jia",glang:"zh_tw",vendor:"Nuance"},{name:"Zuzana",Gender:"Female",language:"cs-cz",description:"Czech Female Zuzana",glang:"cs",vendor:"Nuance"},{name:"Sara",Gender:"Female",language:"da-dk",description:"Danish Female Sara",glang:"da-dk",vendor:"Nuance"},{name:"Magnus",Gender:"Female",language:"da-dk",description:"Danish Female Magnus",glang:"da-dk",vendor:"Nuance"},{name:"Ellen",Gender:"Female",language:"nl-be",description:"Dutch (Belgium and Flemish) Female Ellen",glang:"nl",vendor:"Nuance"},{name:"Claire",Gender:"Female",language:"nl-nl",description:"Dutch (Netherlands) Female Claire",glang:"nl",vendor:"Nuance"},{name:"Xander",Gender:"Male",language:"nl-nl",description:"Dutch (Netherlands) Male Xander",glang:"nl",vendor:"Nuance"},{name:"Karen",Gender:"Female",language:"en-au",description:"English (Australian) Female Karen",glang:"en",vendor:"Nuance"},{name:"Lee",Gender:"Male",language:"en-au",description:"English (Australian) Male Lee",glang:"en",vendor:"Nuance"},{name:"Veena",Gender:"Female",language:"en-in",description:"English (India) Female Veena",glang:"en",vendor:"Nuance"},{name:"Moira",Gender:"Female",language:"en-ie",description:"English (Irish) Female Moira",glang:"en",vendor:"Nuance"},{name:"Fiona",Gender:"Female",language:"en-sc",description:"English (Scottish) Female Fiona",glang:"en",vendor:"Nuance"},{name:"Tessa",Gender:"Female",language:"en-za",description:"English (South African) Female Tessa",glang:"en",vendor:"Nuance"},{name:"Daniel",Gender:"Male",language:"en-gb",description:"English (UK) Male Daniel",glang:"en",vendor:"Nuance"},{name:"Serena",Gender:"Female",language:"en-gb",description:"English (UK) Female Serena",glang:"en",vendor:"Nuance"},{name:"Allison",Gender:"Female",language:"en-us",description:"English (US) Female Allison",glang:"en",vendor:"Nuance"},{name:"Ava",Gender:"Female",language:"en-us",description:"English (US) Female Ava",glang:"en",vendor:"Nuance"},{name:"Tom",Gender:"Male",language:"en-us",description:"English (US) Male Tom",glang:"en",vendor:"Nuance"},{name:"Samantha",Gender:"Female",language:"en-us",description:"English (US) Female Samantha",glang:"en",vendor:"Nuance"},{name:"Satu",Gender:"Female",language:"fi-fi",description:"Finnish Female Satu",glang:"fi",vendor:"Nuance"},{name:"Amelie",Gender:"Female",language:"fr-ca",description:"French (Candian) Female Amelie",glang:"fr",vendor:"Nuance"},{name:"Audrey",Gender:"Female",language:"fr",description:"French Female Audrey",glang:"fr",vendor:"Nuance"},{name:"Thomas",Gender:"Male",language:"fr",description:"French Male Thomas",glang:"fr",vendor:"Nuance"},{name:"Carmela",Gender:"Female",language:"gl-es",description:"Galician (Spain) Female Carmela",glang:"gl",vendor:"Nuance"},{name:"Anna",Gender:"Female",language:"de-de",description:"German Female Anna",glang:"de",vendor:"Nuance"},{name:"Yannick",Gender:"Male",language:"de-de",description:"German Male Yannick",glang:"de",vendor:"Nuance"},{name:"Petra",Gender:"Female",language:"de-de",description:"German Female Petra",glang:"de",vendor:"Nuance"},{name:"Melina",Gender:"Female",language:"el-gr",description:"Greek Female Melina",glang:"el",vendor:"Nuance"},{name:"Nikos",Gender:"Male",language:"el-gr",description:"Greek Male Nikos",glang:"el",vendor:"Nuance"},{name:"Lekha",Gender:"Female",language:"hi-in",description:"Hindi Female Lekha",glang:"hi",vendor:"Nuance"},{name:"Mariska",Gender:"Female",language:"hu-hu",description:"Hungarian Female Mariska",glang:"hu",vendor:"Nuance"},{name:"Damayanti",Gender:"Female",language:"id-id",description:"Indonesian (Bahasa) Female Damayanti",glang:"id",vendor:"Nuance"},{name:"Alice",Gender:"Female",language:"it-it",description:"Italian Female Alice",glang:"it",vendor:"Nuance"},{name:"Federica",Gender:"Female",language:"it-it",description:"Italian Female Federica",glang:"it",vendor:"Nuance"},{name:"Luca",Gender:"Male",language:"it-it",description:"Italian Male Luca",glang:"it",vendor:"Nuance"},{name:"Paola",Gender:"Female",language:"it-it",description:"Italian Female Paola",glang:"it",vendor:"Nuance"},{name:"Ichiro",Gender:"Male",language:"ja-jp",description:"Japanese Male Ichiro",glang:"ja",vendor:"Nuance"},{name:"Sakura",Gender:"Female",language:"ja-jp",description:"Japanese Female Sakura",glang:"ja",vendor:"Nuance"},{name:"Sora",Gender:"Female",language:"ko-kr",description:"Korean Female Sora",glang:"ko",vendor:"Nuance"},{name:"Nora",Gender:"Female",language:"no-no",description:"Norwegian Female Nora",glang:"no",vendor:"Nuance"},{name:"Henrik",Gender:"Male",language:"no-no",description:"Norwegian Male Henrik",glang:"no",vendor:"Nuance"},{name:"Ewa",Gender:"Female",language:"pl-pl",description:"Polish Female Ewa",glang:"pl",vendor:"Nuance"},{name:"Zosia",Gender:"Female",language:"pl-pl",description:"Polish Female Zosia",glang:"pl",vendor:"Nuance"},{name:"Luciana",Gender:"Female",language:"pt-br",description:"Portuguese (Brazilian) Female Luciana",glang:"pt",vendor:"Nuance"},{name:"Felipe",Gender:"Male",language:"pt-br",description:"Portuguese (Brazilian) Male Felipe",glang:"pt",vendor:"Nuance"},{name:"Joana",Gender:"Female",language:"pt-pt",description:"Portuguese Female Joana",glang:"pt",vendor:"Nuance"},{name:"Catarina",Gender:"Female",language:"pt-pt",description:"Portuguese Female Catarina",glang:"pt",vendor:"Nuance"},{name:"Ioana",Gender:"Female",language:"ro-ro",description:"Romanian Female Ioana",glang:"ro",vendor:"Nuance"},{name:"Milena",Gender:"Female",language:"ru-ru",description:"Russian Female Milena",glang:"ru",vendor:"Nuance"},{name:"Yuri",Gender:"Male",language:"ru-ru",description:"Russian Male Yuri",glang:"ru",vendor:"Nuance"},{name:"Laura",Gender:"Female",language:"sk-sk",description:"Slovakian Female Laura",glang:"sk",vendor:"Nuance"},{name:"Carlos",Gender:"Male",language:"es-co",description:"Spanish (Columbian) Male Carlos",glang:"es",vendor:"Nuance"},{name:"Soledad",Gender:"Female",language:"es-co",description:"Spanish (Columbian) Female Soledad",glang:"es",vendor:"Nuance"},{name:"Paulina",Gender:"Female",language:"es-mx",description:"Spanish (Mexican) Female Paulina",glang:"es",vendor:"Nuance"},{name:"Juan",Gender:"Male",language:"es-mx",description:"Spanish (Mexican) Male Juan",glang:"es",vendor:"Nuance"},{name:"Jorge",Gender:"Male",language:"es-es",description:"Spanish (Castilian) Male Jorge",glang:"es",vendor:"Nuance"},{name:"Monica",Gender:"Female",language:"es-es",description:"Spanish (Castilian) Female Monica",glang:"es",vendor:"Nuance"},{name:"Alva",Gender:"Female",language:"sv-se",description:"Swedish Female Alva",glang:"sv",vendor:"Nuance"},{name:"Oskar",Gender:"Male",language:"sv-se",description:"Swedish Male Oskar",glang:"sv",vendor:"Nuance"},{name:"Kanya",Gender:"Female",language:"th-th",description:"Thai Female Kanya",glang:"th",vendor:"Nuance"},{name:"Cem",Gender:"Male",language:"tr-tr",description:"Turkish Male Cem",glang:"tr",vendor:"Nuance"},{name:"Yelda",Gender:"Female",language:"tr-tr",description:"Turkish Female Yelda",glang:"tr",vendor:"Nuance"}],S=[{name:"Lotte",Gender:"Female",language:"nl-nl",description:"Dutch Female Lotte",glang:"nl",vendor:"Polly"},{name:"Maxim",Gender:"Female",language:"ru-ru",description:"Russian Male Maxim",glang:"ru",vendor:"Polly"},{name:"Salli",Gender:"Female",language:"en-us",description:"US English Female Salli",glang:"en",vendor:"Polly"},{name:"Geraint",Gender:"Female",language:"en-gb-wls",description:"Welsh English Male Geraint",glang:"en",vendor:"Polly"},{name:"Miguel",Gender:"Female",language:"es-us",description:"US Spanish Male Miguel",glang:"es",vendor:"Polly"},{name:"Marlene",Gender:"Female",language:"de-de",description:"German Female Marlene",glang:"de",vendor:"Polly"},{name:"Giorgio",Gender:"Female",language:"it-it",description:"Italian Male Giorgio",glang:"it",vendor:"Polly"},{name:"Ines",Gender:"Female",language:"pt-pt",description:"Portuguese Female Inês",glang:"pt",vendor:"Polly"},{name:"Zeina",Gender:"Female",language:"arb",description:"Arabic Female Zeina",glang:"arb",vendor:"Polly"},{name:"Zhiyu",Gender:"Female",language:"cmn-cn",description:"Chinese Mandarin Female Zhiyu",glang:"cmn",vendor:"Polly"},{name:"Gwyneth",Gender:"Female",language:"cy-gb",description:"Welsh Female Gwyneth",glang:"cy",vendor:"Polly"},{name:"Karl",Gender:"Female",language:"is-is",description:"Icelandic Male Karl",glang:"is",vendor:"Polly"},{name:"Joanna",Gender:"Female",language:"en-us",description:"US English Female Joanna",glang:"en",vendor:"Polly"},{name:"Lucia",Gender:"Female",language:"es-es",description:"Castilian Spanish Female Lucia",glang:"es",vendor:"Polly"},{name:"Cristiano",Gender:"Female",language:"pt-pt",description:"Portuguese Male Cristiano",glang:"pt",vendor:"Polly"},{name:"Astrid",Gender:"Female",language:"sv-se",description:"Swedish Female Astrid",glang:"sv",vendor:"Polly"},{name:"Vicki",Gender:"Female",language:"de-de",description:"German Female Vicki",glang:"de",vendor:"Polly"},{name:"Mia",Gender:"Female",language:"es-mx",description:"Mexican Spanish Female Mia",glang:"es",vendor:"Polly"},{name:"Bianca",Gender:"Female",language:"it-it",description:"Italian Female Bianca",glang:"it",vendor:"Polly"},{name:"Vitoria",Gender:"Female",language:"pt-br",description:"Brazilian Portuguese Female Vitória",glang:"pt",vendor:"Polly"},{name:"Raveena",Gender:"Female",language:"en-in",description:"Indian English Female Raveena",glang:"en",vendor:"Polly"},{name:"Chantal",Gender:"Female",language:"fr-ca",description:"Canadian French Female Chantal",glang:"fr",vendor:"Polly"},{name:"Amy",Gender:"Female",language:"en-gb",description:"British English Female Amy",glang:"en",vendor:"Polly"},{name:"Brian",Gender:"Female",language:"en-gb",description:"British English Male Brian",glang:"en",vendor:"Polly"},{name:"Russell",Gender:"Female",language:"en-au",description:"Australian English Male Russell",glang:"en",vendor:"Polly"},{name:"Aditi",Gender:"Female",language:"en-in",description:"Indian English Female Aditi",glang:"en",vendor:"Polly"},{name:"Matthew",Gender:"Female",language:"en-us",description:"US English Male Matthew",glang:"en",vendor:"Polly"},{name:"Dora",Gender:"Female",language:"is-is",description:"Icelandic Female Dóra",glang:"is",vendor:"Polly"},{name:"Enrique",Gender:"Female",language:"es-es",description:"Castilian Spanish Male Enrique",glang:"es",vendor:"Polly"},{name:"Hans",Gender:"Female",language:"de-de",description:"German Male Hans",glang:"de",vendor:"Polly"},{name:"Carmen",Gender:"Female",language:"ro-ro",description:"Romanian Female Carmen",glang:"ro",vendor:"Polly"},{name:"Ivy",Gender:"Female",language:"en-us",description:"US English Female Ivy",glang:"en",vendor:"Polly"},{name:"p-Ewa",Gender:"Female",language:"pl-pl",description:"Polish Female Ewa",glang:"pl",vendor:"Polly"},{name:"Maja",Gender:"Female",language:"pl-pl",description:"Polish Female Maja",glang:"pl",vendor:"Polly"},{name:"Nicole",Gender:"Female",language:"en-au",description:"Australian English Female Nicole",glang:"en",vendor:"Polly"},{name:"Camila",Gender:"Female",language:"pt-br",description:"Brazilian Portuguese Female Camila",glang:"pt",vendor:"Polly"},{name:"Filiz",Gender:"Female",language:"tr-tr",description:"Turkish Female Filiz",glang:"tr",vendor:"Polly"},{name:"Jacek",Gender:"Female",language:"pl-pl",description:"Polish Male Jacek",glang:"pl",vendor:"Polly"},{name:"Justin",Gender:"Female",language:"en-us",description:"US English Male Justin",glang:"en",vendor:"Polly"},{name:"Celine",Gender:"Female",language:"fr-fr",description:"French Female Céline",glang:"fr",vendor:"Polly"},{name:"Kendra",Gender:"Female",language:"en-us",description:"US English Female Kendra",glang:"en",vendor:"Polly"},{name:"Ricardo",Gender:"Female",language:"pt-br",description:"Brazilian Portuguese Male Ricardo",glang:"pt",vendor:"Polly"},{name:"Mads",Gender:"Female",language:"da-dk",description:"Danish Male Mads",glang:"da",vendor:"Polly"},{name:"Mathieu",Gender:"Female",language:"fr-fr",description:"French Male Mathieu",glang:"fr",vendor:"Polly"},{name:"Lea",Gender:"Female",language:"fr-fr",description:"French Female Léa",glang:"fr",vendor:"Polly"},{name:"Naja",Gender:"Female",language:"da-dk",description:"Danish Female Naja",glang:"da",vendor:"Polly"},{name:"Penelope",Gender:"Female",language:"es-us",description:"US Spanish Female Penélope",glang:"es",vendor:"Polly"},{name:"Tatyana",Gender:"Female",language:"ru-ru",description:"Russian Female Tatyana",glang:"ru",vendor:"Polly"},{name:"Ruben",Gender:"Female",language:"nl-nl",description:"Dutch Male Ruben",glang:"nl",vendor:"Polly"},{name:"Mizuki",Gender:"Female",language:"ja-jp",description:"Japanese Female Mizuki",glang:"ja",vendor:"Polly"},{name:"Takumi",Gender:"Female",language:"ja-jp",description:"Japanese Male Takumi",glang:"ja",vendor:"Polly"},{name:"Conchita",Gender:"Female",language:"es-es",description:"Castilian Spanish Female Conchita",glang:"es",vendor:"Polly"},{name:"Carla",Gender:"Female",language:"it-it",description:"Italian Female Carla",glang:"it",vendor:"Polly"},{name:"Kimberly",Gender:"Female",language:"en-us",description:"US English Female Kimberly",glang:"en",vendor:"Polly"},{name:"Jan",Gender:"Female",language:"pl-pl",description:"Polish Male Jan",glang:"pl",vendor:"Polly"},{name:"Liv",Gender:"Female",language:"nb-no",description:"Norwegian Female Liv",glang:"nb",vendor:"Polly"},{name:"Joey",Gender:"Female",language:"en-us",description:"US English Male Joey",glang:"en",vendor:"Polly"},{name:"Lupe",Gender:"Female",language:"es-us",description:"US Spanish Female Lupe",glang:"es",vendor:"Polly"},{name:"Seoyeon",Gender:"Female",language:"ko-kr",description:"Korean Female Seoyeon",glang:"ko",vendor:"Polly"},{name:"Emma",Gender:"Female",language:"en-gb",description:"British English Female Emma",glang:"en",vendor:"Polly"}],w=[{name:"Ceitidh",Gender:"Female",language:"gd",glang:"gd",description:"Gaelic (Scottish) Female Ceitidh",vendor:"Cereproc"},{name:"Peig",Gender:"Female",language:"ga",glang:"ga",description:"Irish Female Peig",vendor:"Cereproc"}],b=function(){function e(t,n){a(this,e),this.voiceByName={},this.voicesByGenderLang={Male:{},Female:{}},this.voicesByLang={},this.createVoiceMap(t,n)}return s(e,[{key:"createVoiceMap",value:function(e,t){var n=l(v);e&&n.push.apply(n,l(S)),t&&n.push.apply(n,l(w));for(var r=0;r<n.length;r++)this.voiceByName[n[r].name]=n[r],(null==this.voicesByGenderLang[n[r].Gender]||void 0===this.voicesByGenderLang[n[r].Gender])&&(this.voicesByGenderLang[n[r].Gender]={}),(null==this.voicesByGenderLang[n[r].Gender][n[r].language]||void 0===this.voicesByGenderLang[n[r].Gender][n[r].language])&&(this.voicesByGenderLang[n[r].Gender][n[r].language]=[]),this.voicesByGenderLang[n[r].Gender][n[r].language].push(n[r]),-1!=n[r].language.indexOf("-")&&((null==this.voicesByGenderLang[n[r].Gender][n[r].glang]||void 0===this.voicesByGenderLang[n[r].Gender][n[r].glang])&&(this.voicesByGenderLang[n[r].Gender][n[r].glang]=[]),this.voicesByGenderLang[n[r].Gender][n[r].glang].push(n[r]))}},{key:"getVoiceByGenderAndLang",value:function(e,t){t=t||"Female",e=e.toLowerCase().replace("_","-");var n=null,r=this.voicesByGenderLang[t],i=r[e];if(null!=i&&void 0!==i||(t="Female"==t?"Male":"Female",null!=(i=(r=this.voicesByGenderLang[t])[e])&&void 0!==i)){for(var a=0;a<i.length;a++)if("Nuance"==i[a].vendor){n=i[a];break}return null==n&&(n=i[0]),n}}},{key:"getVoiceByName",value:function(e){return this.voiceByName[e]}},{key:"getAllVoicesSortedByName",value:function(){return this.voiceByName}}]),e}();String.prototype.trimTH=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")},String.prototype.trimStartTH=function(){return this.replace(/^[\s\xA0]+/,"")},String.prototype.trimEndTH=function(){return this.replace(/[\s\xA0]+$/,"")},String.prototype.equalsTH=function(e){if(this.length!=e.length)return!1;for(var t=0;t<this.length;t+=1)if(this.charAt(t)!=e.charAt(t))return!1;return!0},String.prototype.trimSpaceTH=function(){return this.replace(/^[\t\r\n ]+/,"").replace(/[\t\r\n ]+$/,"")},String.prototype.trimSpaceStartTH=function(){return this.replace(/^[\t\r\n ]+/,"")},String.prototype.trimSpaceEndTH=function(){return this.replace(/[\t\r\n ]+$/,"")};var y=function(){function e(t,n){a(this,e);try{this.currentVoices=[],this.speechServer=null,this.speechServerUser=null,this.rootLocation=null,this.audioElem=null,this.audioPlaybackTimerID=null,this.currentHighlightWord=-1,this.playbackTimeArray=null,this.session=0,this.boundAudioPlayBackTimer=null,this.speechStop=!1,this.paused=!1,this.eventBus=u,this.speechSettings=t,this.voicePromise=null,this.voicesAvailable=null,this.timeout=null,this.speechServerVoices=n,this.charMap={8217:"'",96:"'",8482:" ",8212:" ",38:"&amp;"},this.setVoices()}catch(e){console.log("Request failed: SpeechServer - constructor: ",e)}}return s(e,[{key:"initialise",value:function(){try{return this.speechServer=this.speechSettings.getSpeechServer(),this.speechServerUser=this.speechSettings.getUser(),this.getVoices()}catch(e){console.log("Request failed: SpeechServer - initialise: ",e),Promise.reject(e)}}},{key:"refreshVoices",value:function(){return this.getVoices()}},{key:"status",value:function(e){return 200<=e.status&&300>e.status?Promise.resolve(e):Promise.reject(new Error(e.statusText))}},{key:"json",value:function(e){return e.json()}},{key:"text",value:function(e){return e.text()}},{key:"blob",value:function(e){return e.blob()}},{key:"buffer",value:function(e){return e.arrayBuffer()}},{key:"getVoices",value:function(){return Promise.resolve(this.currentVoices)}},{key:"speakSelection",value:function(e,t,n){var r=this;null==n&&(n=!0),this.speechStop=!1,this.paused=!1,null===this.audioElem&&(this.audioElem=new Audio,this.audioElem.type="audio/mpeg",this.audioElem.autoplay=!1),this.session=t,this.currentHighlightWord=0;for(var i="https://"+this.speechServer+"/Generator/voice/"+this.speechSettings.currentVoice.name+"?",a=`<?xml version="1.0"?>\n                                <speak version="1.1" xmlns="http://www.w3.org/2001/10/synthesis"\n                                xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n                                xsi:schemaLocation="http://www.w3.org/2001/10/synthesis\n                                http://www.w3.org/TR/speech-synthesis11/synthesis.xsd"\n                                xml:lang="${this.speechSettings.currentVoice.language}"> `,o="",s=0;s<e.length;s++)e[s],-1==e[s].search(/[£$]/)||isNaN(parseInt(e[s].replace(/[£$,]/g,"")))||(e[s]=`<say-as interpret-as="currency">${e[s].trim()}</say-as>`),n?("Serena"==this.speechSettings.currentVoice.name&&(-1!=e[s].indexOf("phone")&&(e[s]=e[s].replace(/[()]/g,"")),e[s]=e[s].replace('<say-as interpret-as="phone" >','<say-as interpret-as="vxml:phone" >')),o+=`<mark name="${s}"/> ${this.encodeChars(e[s].trim())} `):o+=this.encodeChars(e[s]);"ja-jp"==this.speechSettings.currentVoice.language&&(o+="。"),o=(o=(o+=`<mark name="${s}"/> </speak>`).replace(/(\x3cbookmark\x20mark\x3d\x22(\d)+\x22\x2f\x3e)/g,"")).replace(/[\s\xA0]+/g," ");var l=(new p).hex_md5(o);this.getCachedSpeech(l).catch((function(){r.eventBus.publish("onthAPIWord",["start"]);var e=`text=${a}${encodeURIComponent(o)}&username=${r.speechServerUser}&speed=${r.speechSettings.getUserSettings().speechoptions.speed}&requestType=ssml`;r.speechSettings.isCacheEnabled()&&(e+=`&destFilename=${l}&destFolder=${r.getCacheLocation()}`);var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=t.getResponseHeader("TH-TIME"),n=this.response.slice(0,e),i=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(n))),a=new Blob([new Uint8Array(this.response.slice(e))],{type:"audio/mpeg"});r.onResponse(i,a)}else if(4==this.readyState&&400==this.status)i=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(this.response)))},t.open("POST",i,!0),t.responseType="arraybuffer",t.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF8"),t.send(e),u.publish("analytics",{event:"Speech",action:"Speech"})}))}},{key:"getCacheLocation",value:function(){var e=this.speechServerUser,t=this.speechSettings.currentVoice.name,n=this.speechSettings.getUserSettings().speechoptions.speed;return`${e}/${this.speechSettings.getCustId()}/${this.speechSettings.getBookId()}/${this.speechSettings.getPageId()}/${t}${n}`}},{key:"getCachedSpeech",value:function(){var e=i((function*(e){if(!this.speechSettings.isCacheEnabled())throw new Error("cache disabled");var t=`https://${this.speechSettings.getCacheServer()}/SpeechCache/${this.getCacheLocation()}/${e}.mp3`,n=yield fetch(t),r=yield n.arrayBuffer(),i=n.headers.get("TH-TIME"),a=r.slice(0,i),o=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(a))),s=new Blob([new Uint8Array(r.slice(i))],{type:"audio/mpeg"});u.publish("analytics",{event:"Speech",action:"cachedSpeech"}),this.onResponse(o,s)}));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){try{if(clearTimeout(this.timeout),null===this.audioElem||null===this.playbackTimeArray)return;this.speechStop=!0,this.paused=!1,this.playbackTimeArray.length=0;try{this.audioElem.pause(),this.audioElem.currentTime=0,this.audioElem.src=""}catch(e){}}catch(e){console.log("Request failed: SpeechServer - stop: ",e)}}},{key:"pause",value:function(){try{if(null===this.audioElem)return;if(0===this.audioElem.currentTime)return;if(this.paused)return this.audioElem.play(),void(this.paused=!1);this.audioElem.pause(),this.paused=!0}catch(e){console.log("Request failed: SpeechServer - pause: ",e)}}},{key:"audioPlaybackTimer",value:function(){var e=this;try{if(null===this.playbackTimeArray)return;if(this.audioElem.ended)return this.audioElem.pause(),this.audioElem.currentTime=0,this.audioElem.src="",this.length=0,void this.eventBus.publish("onthAPIWordonthAPIStop",[]);if(0<this.playbackTimeArray.length){if(this.playbackTimeArray[this.currentHighlightWord]<this.audioElem.currentTime){var t=[];t.push(this.currentHighlightWord),this.eventBus.publish("onthAPIWord",t),this.currentHighlightWord++}if(this.currentHighlightWord==this.playbackTimeArray.length-1&&this.playbackTimeArray[this.currentHighlightWord]==this.playbackTimeArray[this.currentHighlightWord-1])return;if(this.audioElem.currentTime>this.audioElem.duration&&this.audioElem.currentTime>this.playbackTimeArray[this.playbackTimeArray.length-1]){clearTimeout(this.timeout),this.eventBus.publish("onthAPIStop",[]);try{this.audioElem.pause()}catch(e){}return}}this.timeout=setTimeout((function(){e.audioPlaybackTimer()}),50)}catch(e){}}},{key:"setVoices",value:function(){this.currentVoices=this.speechServerVoices.getAllVoicesSortedByName(),null==this.currentVoices[this.speechSettings.get_Voice()]&&(null==this.currentVoices.Ava?this.speechSettings.set_Voice({name:"Ava"}):this.speechSettings.set_Voice(this.currentVoices.Ava))}},{key:"onResponse",value:function(e,t){var n=this;this.playbackTimeArray=[];for(var r=0,i=0;i<e.bookmarks.length;i++)this.playbackTimeArray[r]=e.bookmarks[i].time/1e3,0<r&&this.playbackTimeArray[r]<=this.playbackTimeArray[r-1]&&(this.playbackTimeArray[r]=this.playbackTimeArray[r-1]+.01),++r;.1>this.playbackTimeArray[this.playbackTimeArray.length-1]&&(this.playbackTimeArray.length=0),this.speechStop||(this.timeout=window.setTimeout((function(){n.audioPlaybackTimer()}),50),this.audioElem.src=window.URL.createObjectURL(t),this.audioElem.play(),u.publish("analytics",{event:"Speech",action:"bandwidth",count:t.size/1024}))}},{key:"encodeChars",value:function(e){try{var t="",n="";if(-1<e.search("<phoneme")||-1<e.search("<sub")||-1<e.search("<say-as")||-1<e.search("<emphasis")||-1<e.search("<break")||-1<e.search("<prosody"))return e;for(var r=0;r<e.length;r++)n=e.charCodeAt(r).toString(),t+=void 0===this.charMap[n]?e.charAt(r):this.charMap[n];return t}catch(e){}}}]),e}(),T=function(){function e(t){a(this,e),this.user=t.user,this.custId=t.custId||null,this.bookId=t.bookId||null,this.pageId=t.pageId||null,this.enableCache=t.enableCache||!1,this.enablePollyVoices=t.enablePollyVoices||!1,this.enableCereprocVoices=t.enableCereprocVoices||!1,this.speechServerDns=t.speechServer||"speech.speechstream.net",this.cacheDns=t.cacheDns||"cache.speechstream.net",this.locale=t.locale||"en-US",this.currentVoice={name:"Ava",Gender:"Female",language:"en-us",description:"English (US) Female Ava",vendor:"Nuance"},this.userSettings={speechoptions:{voice:this.currentVoice,continousreading:!0,speed:50},language:{language:"en_US",services:"en_US"}}}return s(e,[{key:"get_Voice",value:function(){try{return this.currentVoice}catch(e){console.log("SpeechSettings - get_Voice: ",e)}}},{key:"set_Voice",value:function(e){try{this.currentVoice=e,this.userSettings.speechoptions.voice=e}catch(e){console.log("SpeechSettings - set_Voice: ",e)}}},{key:"getVoiceByGenderAndLang",value:function(e,t){t=t.toLowerCase().replace("_","-");for(var n=null,r=this.voices.getVoiceByGenderAndLang(e,t),i=0;i<r.length;i++)if("Nuance"==r[i].vendor){n=r[i];break}return null==n&&(n=r[0]),n}},{key:"addVoices",value:function(){}},{key:"setVoiceByGenderAndLang",value:function(e,t){var n="Female";e&&(n="Male");var r=this.getVoiceByGenderAndLang(n,t);this.currentVoice=r,this.userSettings.speechoptions.voice=r}},{key:"set_Speed",value:function(e){try{this.userSettings.speechoptions.speed=e}catch(e){console.log("SpeechSettings - set_Speed: ",e)}}},{key:"getVoices",value:function(){try{return""}catch(e){console.log("SpeechSettings - getVoices: ",e)}}},{key:"getLocale",value:function(){return this.locale}},{key:"getUserSettings",value:function(){return this.userSettings}},{key:"getUser",value:function(){return this.user}},{key:"getPageId",value:function(){return this.pageId}},{key:"setPageId",value:function(e){this.pageId=e}},{key:"getCustId",value:function(){return this.custId}},{key:"setCustId",value:function(e){this.custId=e}},{key:"getBookId",value:function(){return this.bookId}},{key:"setBookId",value:function(e){this.bookId=e}},{key:"isCacheEnabled",value:function(){return this.enableCache}},{key:"getSpeechServer",value:function(){return this.speechServerDns}},{key:"getCacheServer",value:function(){return this.cacheDns}}]),e}(),x=function(){function e(e){for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];if(null!=r.pronunciations)for(var i in r.pronunciations)if(r.pronunciations.hasOwnProperty(i)){var a=n(i,r.pronunciations[i]);null!=a&&(delete r.pronunciations[i],null==r.wildcards&&(r.wildcards=[]),r.wildcards.push(a))}}}function t(e){var t=e.indexOf("&#");return-1<t&&(e=function(e){return e.replace(/&#([0-9]+);?/gi,(function(e,t){return String.fromCharCode(parseInt(t,10))}))}(e)),-1<(t=e.indexOf("\\u0026#"))&&(e=function(e){return e.replace(/\\u0026#([0-9]+);?/gi,(function(e,t){return String.fromCharCode(parseInt(t,10))}))}(e)),e}function n(e,t){if(2<e.length&&"/"==e.charAt(0)&&"/"==e.charAt(e.length-1)){var n=e.substr(1,e.length-2);try{var r=new RegExp(n);if(null!=r)return{say:r,like:t}}catch(e){}}return null}function r(e,t){if(null==t)return null;var n=e;if(null!=t[n])return t[n];var r=n.toLowerCase();return r!=n&&null!=t[r]?t[r]:(n=(n=(n=e.replace("\\x82\\x91\\x92","'")).replace("\\x93\\x94",'"')).replace(l,""))==e?null:null==t[n]?(r=n.toLowerCase())!=n&&null!=t[r]?t[r]:null:t[n]}function a(e,t){if(null==t)return null;for(var n=0;n<t.length;n++){var r=t[n],i=e.replace(r.say,r.like);if(i!=e)return i}return null}function o(e,t){var n=e.split(/\s+/);if(n.length==t)return n;if(n.length>t){var r=n.length-(t-1),i=[],a=n.splice(0,r).join(" ");return i.push(a),i=i.concat(n)}if(n.length<t){var o;for(o=n.length;o<t;o++)n.push("");return n}return null}var s=this,l=/^[,.?!;:\x27\x22\xa3\x24\u20ac]+|[,.?!;:\x27\x22\xa3\x24\u20ac]+$/g,h=/^[,.?!;:\x27\x22\xa3\x24\u20ac]+/,d=null,g=!1,c=!1,f=null,m=null,p=null,v=null,S=null,w=null,b=null,y=null,T=null,x=null,C=null;this.setVoice=function(e){var t;(T=null,x=null,C=null,w=null,b=null,y=null,"string"==typeof e&&(S=e,null!=f))&&(null!=(t=f.items[S])&&(T=t.pronunciations,x=t.multiPronunciations,C=t.wildcards),function(e){if("string"==typeof e)for(var t,n=0;n<_.length;n++)if(t=_[n],-1<e.indexOf(t))return!0;return!1}(S)&&null!=(t=f.items["English Voices"])&&(w=t.pronunciations,b=t.multiPronunciations,y=t.wildcards))},this.getVoice=function(){return S},this.loadData=function(e,t,n){if(d=e,u.publish("analytics",{event:"Pronunciation",action:"retrieve Global file"}),void 0!==d&&void 0!==t&&void 0!==n){var r="https://"+d+"/global/"+t+"/"+n+".json";s.send(r,s.fileLoaded,s.loadFailed)}else thLog("Global pronunciation failed to load as requested with invalid data.")},this.send=function(){var e=i((function*(e,t,n){try{var r=yield fetch(e);t(yield r.text())}catch(e){n(e)}}));return function(){return e.apply(this,arguments)}}(),this.loadFailed=function(){u.publish("analytics",{event:"Pronunciation",action:"retrieve Global file Failed"}),c=!0,g=!1},this.fileLoaded=function(n){c=!0,u.publish("analytics",{event:"Pronunciation",action:"retrieve Global file success"}),n=t(n);var r=JSON.parse(n);if(null!=r&&null!=r.items&&"object"==typeof r.items){e((f=r).items);var i=f.items.all;null!=i&&(m=i.pronunciations,p=i.multiPronunciations,v=i.wildcards),s.setVoice(S),g=!0}else thLog("Global pronunciation failed to load as no valid data returned."),g=!1},this.checkWords=function(e,t){if(!(g&&1<=e.length))return null;var n=null;null!=t&&t!=S&&(n=S,s.setVoice(t));try{var i,l,u=null,d=!1;if(1<e.length&&(l=(l=(l=(i=e[0].trimTH()).replace("\\x82\\x91\\x92","'")).replace("\\x93\\x94",'"')).replace(h,""),(null!=x&&(-1<x.indexOf(i)||-1<x.indexOf(l))||null!=b&&(-1<b.indexOf(i)||-1<b.indexOf(l))||null!=p&&(-1<p.indexOf(i)||-1<p.indexOf(l)))&&(d=!0)),d){if(3<=e.length&&(null!=(u=r(i=e[0].trimTH()+" "+e[1].trimTH()+" "+e[2].trimTH(),T))||null!=(u=r(i,w))||null!=(u=r(i,m))))return o(u,3);if(2<=e.length&&(null!=(u=r(i=e[0].trimTH()+" "+e[1].trimTH(),T))||null!=(u=r(i,w))||null!=(u=r(i,m))))return o(u,2)}if(1<=e.length){if(null!=(u=r(i=e[0].trimTH(),T))||null!=(u=r(i,w))||null!=(u=r(i,m)))return[u];if(null!=(u=a(i,C))||null!=(u=a(i,y))||null!=(u=a(i,v)))return[u]}}catch(e){thLogE(e)}return null!=n&&s.setVoice(n),null},this.isEnabled=function(){return g},this.isLoaded=function(){return c};var _=["Allison","Ava","Daniel","Emily","Fiona","Jill","Karen","Lee","Moira","Samantha","Sangeeta","Serena","Tessa","Tom"]},C={speechEngines:[],initialised:!1,voices:[],controller:null,voiceToEngineMap:[],speechSettings:null,globalProns:!1,Pronunciation:null,prons:[],speechServerVoices:null,pronunciations:new(function(){function e(){a(this,e),this.rw_qouteRegex="\\x82\\x91\\x92",this.rw_dqouteRegex="\\x93\\x94",this.rw_trimRegex=/^[,.?!;:\x27\x22\xa3\x24\u20ac]+|[,.?!;:\x27\x22\xa3\x24\u20ac]+$/g,this.rw_internalSpaceRegex=/[\n\r\t ]{1,}/g,this.pronsArray=[],this.pronunciations=new m,this.pronunciations.prons.lang.MultiwordPron=[],this.gpData={}}return s(e,[{key:"setGlobalPronunciations",value:function(e){this.gpData=e}},{key:"add",value:function(e,t){this.pronunciations.prons.lang.all[e]=t}},{key:"delete",value:function(e){delete this.pronunciations.prons.lang.all[e]}},{key:"update",value:function(e,t){this.pronunciations.prons.lang.all[e]=t}},{key:"checkWords",value:function(e,t,n){for(var r=n.split(" "),i="",a=t;a<t+r.length&&a<e.length;a++)i+=e[a].trim()+" ";var o={start:-1,end:-1};return(i=i.trim())==n?o={start:t,end:t+r.length}:(i=i.replace(this.rw_internalSpaceRegex," "))==n?o={start:t,end:t+r.length}:(i=i.replace(this.rw_trimRegex,""))==n?o={start:t,end:t+r.length}:o}},{key:"fixWord",value:function(e){return e=(e=e.replace(this.rw_qouteRegex,"'")).replace(this.rw_dqouteRegex,'"')}},{key:"checkPronunciation",value:function(e,t){this.pronsArray;var n,r=!1,i=e.length;for(var a in this.pronunciations.prons.lang.all)for(var o=this.fixWord(a),s=0;s<e.length;s++)if(-1!=this.checkWords(e,s,o).start){var l=a.split(" ");r=!0;for(var h=this.fixWord(this.pronunciations.prons.lang.all[a]).split(" "),u=0;u<l.length;u++)if(1==h.length&&1==l.length)e[s+u]=this.pronunciations.prons.lang.all[a];else if(1==h.length&&1<l.length)e[s+u]=0==u?this.pronunciations.prons.lang.all[a]:" ";else if(1==l.length&&1<h.length){e[s+u]="";for(var d=0;d<h.length;d++)e[s+u]+=h[d]+" "}else e[s+u]=h[u]}for(n=0;n<i;n++)if(void 0!==this.gpData.isEnabled&&this.gpData.isEnabled()){var g;if(null!=(g=this.gpData.checkWords(e.slice(n,n+3),t))){3==g.length?(e[n+2]=g[2]+" ",e[n+1]=g[1]+" ",e[n]=g[0]+" ",r=!0):2==g.length?(e[n+1]=g[1]+" ",e[n]=g[0]+" ",r=!0):1==g.length&&(e[n]=g[0]+" ",r=!0);continue}}return r}},{key:"rw_checkPronunciationFromString",value:function(e,t){var n="";if(this.checkPronunciation(wordList,t)){var r,i=wordList.length;for(r=0;r<i;r++)n+=wordList[r],r<i-1&&(n+=" ");return n}return e}},{key:"setPronunciationsForVoice",value:function(e,t){var n=this.pronunciations.prons.voices[e];this.setPronunciationsForLang(n,t)}},{key:"setPronunciationsForLang",value:function(e,t){var n=this.pronunciations.prons.lang[e],r=this.pronunciations.prons.lang.all,i=Object.assign({},r,n);if(null!=i&&void 0!==i)for(var a in i)for(var o=0;o<t.length;o++)t[o]=t[o].replace(a,i[a])}}]),e}()),initialise:function(e){this.speechSettings=new T(e);try{e.globalPronunciations&&void 0!==e.pronunciationDns&&void 0!==e.user&&void 0!==e.custId&&(this.globalProns=new x(this),this.globalProns.setVoice(this.speechSettings.currentVoice.name),this.globalProns.loadData(e.pronunciationDns,e.user,e.custId),this.pronunciations.setGlobalPronunciations(this.globalProns))}catch(e){this.globalProns=!1}try{return this.initialised?Promise.resolve():(this.speechServerVoices=new b(e.enablePollyVoices,e.enableCereprocVoices),this.speechEngines.speechserver=new y(this.speechSettings,this.speechServerVoices),this.initialised=!0,this.initialiseEnginesVoices())}catch(e){console.log("SpeechManager - intialise: ",e)}},initialiseEnginesVoices:function(){var e=[];for(var t in this.speechEngines)this.speechEngines.hasOwnProperty(t)&&e.push(this.speechEngines[t].initialise());return Promise.all(e)},addPronunciation:function(e,t){this.pronunciations.add(e,t)},updatePronunciation:function(e,t){this.pronunciations.update(e,t)},deletePronunciation:function(e,t){this.pronunciations.delete(e,t)},getVoices:function(e){var t=this;try{if(!this.initialised)return Promise.resolve(null);if(null==e&&(e=!1),e&&(this.voices=[],this.voiceToEngineMap=[]),0<Object.keys(this.voices).length)return Promise.resolve(this.voices);var n=[],r=function(e){if(t.speechEngines.hasOwnProperty(e)){var r=t.speechEngines[e].getVoices().then((function(n){for(var r in n)n.hasOwnProperty(r)&&(t.voices[r]=n[r],t.voiceToEngineMap[r]=t.speechEngines[e])}));n.push(r)}};for(var i in this.speechEngines)r(i);return Promise.all(n).then((function(){return t.voices}))}catch(e){return console.log("SpeechManager - getVoices: ",e),Promise.reject(e)}},speakSelection:function(e,t,n,r,i){var a=this;try{u.publish("WordsToSpeak",e);var o=Promise.resolve();0==Object.keys(this.voices).length&&(o=this.getVoices()),(null!=i||void 0!==i)&&(!(i="Female")&&(i="Male")),o.then((function(){var o=a.voiceToEngineMap[a.speechSettings.get_Voice().name];if(null==r||void 0===r||void 0===a.speechServerVoices.getVoiceByGenderAndLang(r,i))null==a.voiceToEngineMap[a.speechSettings.get_Voice().name]?(o=a.voiceToEngineMap.Ava,a.speechSettings.set_Voice("Ava")):o=a.voiceToEngineMap[a.speechSettings.get_Voice().name],a.pronunciations.checkPronunciation(e,a.speechSettings.get_Voice().name),o.speakSelection(e,t,n);else{var s=a.speechSettings.get_Voice(),l=s.language.split("-"),h=r.split("-");l[0]&&h[0]&&l[0]!=h[0]?(a.speechSettings.set_Voice(a.speechServerVoices.getVoiceByGenderAndLang(r,i)),o=a.voiceToEngineMap[a.speechServerVoices.getVoiceByGenderAndLang(r,i).name],a.pronunciations.checkPronunciation(e,a.speechSettings.get_Voice().name)):(o=a.voiceToEngineMap[s.name],a.pronunciations.checkPronunciation(e,s.name)),o.speakSelection(e,t,n),a.speechSettings.set_Voice(s)}}))}catch(e){console.log("SpeechManager - speakSelection: ",e)}},speakSelectionWithVoice:function(e,t,n,r){var i=this;u.publish("WordsToSpeak",e);var a=Promise.resolve();0==Object.keys(this.voices).length&&(a=this.getVoices()),a.then((function(){var a=i.speechSettings.get_Voice(),o=i.voiceToEngineMap[r],s=i.speechServerVoices.getVoiceByName(r);i.speechSettings.set_Voice(s),null!=o&&(i.pronunciations.checkPronunciation(e,r),o.speakSelection(e,t,n)),i.speechSettings.set_Voice(a)}))},setVoiceByName:function(e){var t=this.speechServerVoices.getVoiceByName(e);(null!=t||void 0!==t)&&this.speechSettings.set_Voice(t)},setVoiceByGenderAndLang:function(e,t){(null!=e||void 0!==e)&&(!(e="Female")&&(e="Male"));var n=this.speechServerVoices.getVoiceByGenderAndLang(t,e);(null!=n||void 0!==n)&&this.speechSettings.set_Voice(n)},setSpeed:function(e){this.speechSettings.set_Speed(e)},stop:function(){try{if(0==Object.keys(this.voiceToEngineMap).length)return;var e=this.voiceToEngineMap[this.speechSettings.get_Voice().name];if(void 0===e){var t=this.speechSettings.getLocale(),n=this.configuration.getConfiguration();this.speechSettings.set_Voice(n[t].speechoptions.voice),e=this.voiceToEngineMap[this.speechSettings.get_Voice().name]}null!==e&&e.stop()}catch(e){console.log("SpeechManager - stop: ",e)}},pause:function(){try{if(0==Object.keys(this.voiceToEngineMap).length)return;var e=this.voiceToEngineMap[this.speechSettings.get_Voice().name];if(void 0===e){var t=this.speechSettings.getLocale(),n=this.configuration.getConfiguration();this.speechSettings.set_Voice(n[t].voice),e=this.voiceToEngineMap[this.speechSettings.get_Voice().name]}null!==e&&e.pause()}catch(t){console.log("SpeechManager - pause: ",t)}},setPageId:function(e){this.speechSettings.setPageId(e)},setBookId:function(e){this.speechSettings.setBookId(e)},setCustId:function(e){this.speechSettings.setCustId(e)}},_=function(){function e(t,n){a(this,e),this.HtmlParser=n;var r={user:t.username,speechServer:t.dns,cacheDns:t.cacheDns,enableCache:t.enableCache,custId:t.custId,bookId:t.bookId,pageId:t.pageId,enablePollyVoices:t.enablePollyVoices,enableCereprocVoices:t.enableCereprocVoices,globalPronunciations:t.globalPronunciations,pronunciationDns:t.pronunciationDns};C.initialise(r),this.clickToSpeakEnabled=t.clickToSpeakEnabled||!1,this.hoverSpeakEnabled=t.hoverSpeakEnabled||!1,this.continuousSpeechEnabled=t.continuousSpeechEnabled||!1,this.useElementLangTags=null==typeof t.useElementLangTag||0!=t.useElementLangTag,this.tempContinuousSpeechEnabled=this.continuousSpeechEnabled,this.addEvents(),this.speechEvents(),this.withOutHighlighting=!1,this.ignoreToolbarId=t.ignoreToolbarId,this.voice=null,this.firstHoverSpeak=!1,this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}return s(e,[{key:"setContinuousSpeechEnabled",value:function(e){this.continuousSpeechEnabled=e,this.tempContinuousSpeechEnabled=this.continuousSpeechEnabled}},{key:"speechEvents",value:function(){var e=this;u.subscribe("onthAPIWord",(function(t){e.onWord(t)})),u.subscribe("onthAPIStop",(function(){e._speechEnded(),e.playNextSentence()})),u.subscribe("onthAPIWordonthAPIStop",(function(){e._speechEnded(),e.playNextSentence()})),u.subscribe("setTempVoice",(function(t){e.setTranslateVoice(t)})),u.subscribe("setPageID",(function(t){e.setPageId(t)})),u.subscribe("setBookID",(function(t){e.setBookId(t)}))}},{key:"addEvents",value:function(){var e=this;window.addEventListener("click",(function(t){var n=t.target.shadowRoot;if(n)for(var r=0;r<n.children.length;r++)if(n.children[r].id==e.ignoreToolbarId)return;e.clickToSpeakEnabled&&e.clickToSpeak(t)})),window.addEventListener("mousemove",(function(t){var n=t.target.shadowRoot;if(n)for(var r=0;r<n.children.length;r++)if(n.children[r].id==e.ignoreToolbarId)return;e.hoverSpeakEnabled&&e.hoverSpeak(t)}))}},{key:"hoverSpeakOnOff",value:function(){this.stop(),this.hoverSpeakEnabled=!this.hoverSpeakEnabled,this.HtmlParser.hoverSpeakEnabled(this.hoverSpeakEnabled),this.hoverSpeakEnabled&&!this.firstHoverSpeak&&this.isSafari&&(this.speakWithOutHighlight([""]),this.firstHoverSpeak=!0,this.stop()),this.hoverSpeakEnabled&&u.publish("analytics",{event:"Speech",action:"hoverSpeakOn"})}},{key:"clickToSpeakOnOff",value:function(){this.stop(),this.clickToSpeakEnabled=!this.clickToSpeakEnabled,this.HtmlParser.clickToSpeakEnabled(this.clickToSpeakEnabled),this.clickToSpeakEnabled&&u.publish("analytics",{event:"Speech",action:"clickToSpeakOn"})}},{key:"hoverSpeak",value:function(e){var t=this;this.hoverSpeakEnabled&&this.HtmlParser.mouseOverEvent(e,(function(){t.stop(),t.play(),u.publish("analytics",{event:"Speech",action:"Hover Sentence"})}))}},{key:"clickToSpeak",value:function(e){var t=this;this.clickToSpeakEnabled&&this.HtmlParser.mouseClickEvent(e,(function(){t.stop(),t.play()}))}},{key:"speakWithOutHighlight",value:function(e,t){this.stop(),this.withOutHighlighting=!0,this.tempContinuousSpeechEnabled=this.continuousSpeechEnabled,this.continuousSpeechEnabled=!1,C.speakSelection(e,1,!0,t),u.publish("speechStarted",[])}},{key:"play",value:function(e){e&&(this.voice=e),u.publish("speechStarted",[]);var t=this.HtmlParser.hiliteSelection();if(this.voice)C.speakSelectionWithVoice(t,1,!0,this.voice);else{var n=null;this.useElementLangTags&&(n=this.HtmlParser.getLanguageForSentence()),C.speakSelection(t,1,!0,n)}}},{key:"setTranslateVoice",value:function(e){this.voice=e}},{key:"playNextSentence",value:function(){var e=this.HtmlParser.hiliteNextSentence(this.continuousSpeechEnabled);if(null!=e){var t=null;this.useElementLangTags&&(t=this.HtmlParser.getLanguageForSentence()),this.voice?C.speakSelectionWithVoice(e,1,!0,this.voice):C.speakSelection(e,1,!0,t),u.publish("analytics",{event:"Speech",action:"Continuous Sentence"}),u.publish("speechStarted",[])}else u.publish("speechStopped",[]),this.voice=null,this.continuousSpeechEnabled=this.tempContinuousSpeechEnabled}},{key:"speakById",value:function(e,t){this.tempContinuousSpeechEnabled=this.continuousSpeechEnabled,this.continuousSpeechEnabled=!1,null!=t&&(this.voice=t);var n=this.HtmlParser.highlightElementById(e),r=null;this.useElementLangTags&&(r=this.HtmlParser.getLanguageForSentence()),null!=n&&(t?(C.speakSelectionWithVoice(n,1,!0,t),u.publish("speechStarted",[])):(C.speakSelection(n,1,!0,r),u.publish("speechStarted",[])))}},{key:"onWord",value:function(e){this.withOutHighlighting||"start"==e[0]||this.HtmlParser.hiliteWord(e[0])}},{key:"stop",value:function(){this.withOutHighlighting=!1,C.stop(),this.HtmlParser.stop(),u.publish("speechStopped",[]),this.voice=null,this.continuousSpeechEnabled=this.tempContinuousSpeechEnabled}},{key:"_speechEnded",value:function(){this.withOutHighlighting=!1,this.HtmlParser.stop()}},{key:"pause",value:function(){C.pause()}},{key:"setVoice",value:function(e){C.setVoice(e)}},{key:"setCustId",value:function(e){C.setCustId(e)}},{key:"setBookId",value:function(e){C.setBookId(e)}},{key:"setPageId",value:function(e){C.setPageId(e)}},{key:"setVoice",value:function(e){C.setVoiceByName(e)}},{key:"setVoiceByGenderAndLanguage",value:function(e,t){C.setVoiceByGenderAndLang(e,t)}},{key:"setVoiceSpeed",value:function(e){C.setSpeed(e)}},{key:"addPronunciations",value:function(e,t){C.addPronunciation(e,t)}},{key:"updatePronunciations",value:function(e,t){C.updatePronunciation(e,t)}},{key:"deletePronunciations",value:function(e,t){C.deletePronunciation(e,t)}}]),e}()},7:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=Symbol.for("texthelp.EventBus"),i=window[r];i||(i={events:{},unSubscribe:function(e,t,n){if(null!=this.events[e])for(var r=0;r<this.events[e].length;r++)this.events[e][r].context==n&&this.events[e].splice(r,1)},subscribe:function(e,t,n){return null==this.events[e]&&(this.events[e]=[]),this.events[e].push({callback:t,context:n}),this.events.length-1},publish:function(e){var t=this.events[e];if(null!=t){for(var n=arguments.length,r=Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var a=0;a<t.length;a++)t[a].callback.apply(this,r)}}},window[r]=i)}}]);